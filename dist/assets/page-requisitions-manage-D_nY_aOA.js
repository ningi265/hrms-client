import{r as e,u as s,j as t,H as r,ak as a,_ as n,am as l,ac as i,p as d,ag as c,an as o,ap as x,ao as m,o as u,D as p,I as g,X as h,at as b,v as y,au as j,av as f,t as N,n as v,a5 as w,bK as D,m as C,bL as k,ad as S,br as A,aC as M,K as z,aR as T,aE as q,a4 as R,f as F,aP as $,aQ as E,N as B,A as P,bq as I,aB as L,B as U,q as O,g as _,bM as K,x as W,ah as J,z as H,ay as V,a8 as G,bN as Y,bO as Q,be as X,aq as Z,h as ee,l as se,a0 as te,i as re,aK as ae,s as ne,S as le,aD as ie,y as de,bp as ce,ax as oe,bk as xe,aw as me,J as ue,ar as pe,bP as ge}from"./react-core-DKrnZdd7.js";import{u as he,w as be,r as ye}from"./vendor-xlsx-DInLSob0.js";import{m as je,A as fe}from"./vendor-framer-motion-DCU7qowG.js";import{g as Ne,a as ve}from"./utils-app-Drkqrh9Q.js";import{f as we,p as De,d as Ce}from"./date-fns-CUr-g5D8.js";import{E as ke}from"./vendor-jspdf-CCnS5Eue.js";import"./vendor-jspdf-autotable-Dge4SOWT.js";import{a as Se}from"./axios-A2APuswD.js";import{u as Ae}from"./vendor-notistack-DOLgeAla.js";import{R as Me,P as ze,c as Te,d as qe,T as Re,B as Fe,C as $e,X as Ee,Y as Be,b as Pe}from"./vendor-recharts-BfOGTqeh.js";import{u as Ie}from"./context-k3FZ8Vno.js";const Le=({isVisible:e,message:s="Processing..."})=>e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl p-6 flex items-center gap-3",children:[t.jsx(b,{className:"animate-spin w-6 h-6 text-blue-500"}),t.jsx("span",{className:"font-medium",children:s})]})}):null,Ue=({title:e,value:s,icon:r,color:a,trend:n,subtitle:l,prefix:i="",suffix:d="",size:c="normal"})=>{const o="large"===c?"col-span-2":"",x="large"===c?"text-4xl":"text-2xl";return t.jsxs("div",{className:`bg-white rounded-2xl border border-gray-200 p-1.5 hover:shadow-sm transition-shadow ${o}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("div",{className:"p-1.5 rounded-xl "+("blue"===a?"bg-blue-50":"green"===a?"bg-emerald-50":"purple"===a?"bg-purple-50":"orange"===a?"bg-orange-50":"amber"===a?"bg-amber-50":"red"===a?"bg-red-50":"bg-gray-50"),children:t.jsx(r,{size:16,className:"blue"===a?"text-blue-600":"green"===a?"text-emerald-600":"purple"===a?"text-purple-600":"orange"===a?"text-orange-600":"amber"===a?"text-amber-600":"red"===a?"text-red-600":"text-gray-600"})}),n&&t.jsxs("div",{className:"flex items-center gap-1",children:[n>0?t.jsx(y,{size:12,className:"text-emerald-500"}):t.jsx(j,{size:12,className:"text-red-500"}),t.jsxs("span",{className:"text-xs font-medium "+(n>0?"text-emerald-500":"text-red-500"),children:[n>0?"+":"",n,"%"]})]})]}),t.jsxs("div",{className:`${x} font-bold text-gray-900 mb-1`,children:[i,s,d]}),t.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:e}),l&&t.jsx("div",{className:"text-xs text-gray-400",children:l})]})},Oe=({requisition:e,onMenuClick:s,showMenuId:r,onAction:a,onView:n,onDownload:i,getUrgencyColor:d,getUrgencyIcon:c,formatDate:o})=>t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-2 hover:shadow-sm transition-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"p-1.5 bg-blue-50 rounded-xl",children:t.jsx(l,{className:"w-4 h-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-sm text-gray-900",children:e.itemName||"N/A"}),t.jsx("p",{className:"text-xs text-gray-500",children:e.employee?.firstName||"Unknown Employee"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${d(e.urgency)}`,children:[c(e.urgency),t.jsx("span",{className:"ml-1 capitalize",children:e.urgency||"N/A"})]}),t.jsx("button",{"data-requisition-id":e._id,onClick:()=>s(e._id),className:"p-1 text-gray-400 hover:text-blue-600 rounded-xl",children:t.jsx(f,{size:16})})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1.5 mb-1.5",children:[t.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded-xl",children:[t.jsx("div",{className:"text-base font-bold text-gray-900",children:e.quantity||0}),t.jsx("div",{className:"text-xs text-gray-500",children:"Quantity"})]}),t.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded-xl",children:[t.jsxs("div",{className:"text-base font-bold text-gray-900 flex items-center justify-center gap-1",children:[t.jsx(N,{className:"w-4 h-4 text-green-500"}),e.budgetCode?.slice(-4)||"N/A"]}),t.jsx("div",{className:"text-xs text-gray-500",children:"Budget Code"})]})]}),t.jsxs("div",{className:"space-y-0.5 mb-1.5",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Employee"}),t.jsx("span",{className:"text-xs font-medium truncate",children:e.employee?.email||"N/A"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Submitted"}),t.jsx("span",{className:"text-xs font-medium",children:e.createdAt?o(e.createdAt):"N/A"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Budget Code"}),t.jsx("span",{className:"text-xs font-medium",children:e.budgetCode||"N/A"})]})]}),e.description&&t.jsxs("div",{className:"mb-2",children:[t.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Description"}),t.jsx("div",{className:"text-xs text-gray-800 bg-gray-50 p-2 rounded line-clamp-2",children:e.description})]}),t.jsxs("div",{className:"flex justify-between items-center pt-1.5 border-t border-gray-100",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>a(e._id,"approve"),className:"flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium hover:bg-green-200 transition-colors",children:[t.jsx(g,{size:12}),"Approve"]}),t.jsxs("button",{onClick:()=>a(e._id,"reject"),className:"flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium hover:bg-red-200 transition-colors",children:[t.jsx(h,{size:12}),"Reject"]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>n(e._id),className:"p-1 text-gray-400 hover:text-blue-600 rounded-xl",children:t.jsx(u,{size:14})}),t.jsx("button",{onClick:()=>i(e._id),className:"p-1 text-gray-400 hover:text-blue-600 rounded-xl",children:t.jsx(p,{size:14})})]})]})]});function _e(){const[b,y]=e.useState([]),[j,f]=e.useState(!0),[N,v]=e.useState(null),[w,D]=e.useState(""),[C,k]=e.useState("all"),[S,A]=e.useState(!1),[M,z]=e.useState(""),[T,q]=e.useState("success"),[R,F]=e.useState(null),$=s(),E=e.useRef(null),B="https://backend.nexusmwi.com";e.useEffect(()=>{(async()=>{try{f(!0);const e=localStorage.getItem("token"),s=await fetch(`${B}/api/requisitions/pending`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch requisitions");const t=await s.json();t.success&&Array.isArray(t.data)?y(t.data):y([]),v(null)}catch(e){v(e.message),y([])}finally{f(!1)}})()},[B]);const P=b.filter(e=>{const s=(e.itemName?.toLowerCase()||"").includes(w.toLowerCase())||(e.employee?.firstName?.toLowerCase()||"").includes(w.toLowerCase())||(e.employee?.email?.toLowerCase()||"").includes(w.toLowerCase()),t="all"===C||e.urgency===C;return s&&t}),I=b.length,L=b.filter(e=>"high"===e.urgency).length,U=b.filter(e=>"medium"===e.urgency).length,O=b.filter(e=>"low"===e.urgency).length,_=async(e,s)=>{try{const t=localStorage.getItem("token"),r=await fetch(`${B}/api/requisitions/${e}/${s}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`}}),a=await r.json();r.ok?(y(s=>s.filter(s=>s._id!==e)),J(`Requisition ${"approve"===s?"approved":"rejected"} successfully!`,"success")):v(a.message||"Failed to update requisition")}catch(t){J("Failed to update requisition","error")}F(null)},K=e=>{$(`/requisitions/${e}`),F(null)},W=async e=>{try{const s=localStorage.getItem("token"),t=await fetch(`${B}/api/requisitions/${e}/pdf`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const s=await t.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`requisition-${e}.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(r),document.body.removeChild(a),J("PDF downloaded successfully!","success")}else J("Failed to download PDF","error")}catch(s){J("Failed to download PDF","error")}F(null)},J=(e,s="success")=>{z(e),q(s),A(!0),setTimeout(()=>A(!1),5e3)},H=e=>{switch(e?.toLowerCase()){case"high":return"text-red-700 bg-red-50 border-red-200";case"medium":return"text-amber-700 bg-amber-50 border-amber-200";case"low":return"text-green-700 bg-green-50 border-green-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}},V=e=>{switch(e?.toLowerCase()){case"high":return t.jsx(r,{size:12});case"medium":default:return t.jsx(i,{size:12});case"low":return t.jsx(d,{size:12})}},G=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Y=()=>{f(!0),setTimeout(()=>f(!1),1e3),window.location.reload()};return N?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs(je.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:t.jsx(r,{size:32,className:"text-red-600"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),t.jsx("p",{className:"text-gray-600 mb-6",children:N}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors",children:"Try Again"})]})}):t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(Le,{isVisible:j,message:"Loading requisitions..."}),t.jsx("input",{ref:E,type:"file",accept:".xlsx, .xls",className:"hidden",onChange:async e=>{const s=e.target.files[0];if(s)try{const e=await s.arrayBuffer(),t=ye(e),r=t.Sheets[t.SheetNames[0]],a=he.sheet_to_json(r),n=localStorage.getItem("token");for(const s of a){const e={itemName:s["Item Name"]||"",quantity:Number(s.Quantity)||0,budgetCode:s["Budget Code"]||"",urgency:s.Urgency?.toLowerCase()||"medium",description:s.Description||"",department:s.Department||"",projectCode:s["Project Code"]||""};await fetch(`${B}/api/requisitions`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(e)})}J("Excel import completed successfully!","success"),Y()}catch(t){J("Excel import failed!","error")}}}),t.jsxs("main",{className:"p-4 space-y-4 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(a,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search requisitions...",value:w,onChange:e=>D(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white"})]}),t.jsxs("select",{value:C,onChange:e=>k(e.target.value),className:"px-3 py-2 border border-gray-200 rounded-2xl text-sm bg-white",children:[t.jsx("option",{value:"all",children:"All Urgency"}),t.jsx("option",{value:"high",children:"High Urgency"}),t.jsx("option",{value:"medium",children:"Medium Urgency"}),t.jsx("option",{value:"low",children:"Low Urgency"})]}),t.jsxs("button",{onClick:Y,disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-2xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(n,{size:16,className:j?"animate-spin":""}),"Refresh"]})]}),t.jsx("div",{className:"flex items-center gap-2"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(Ue,{title:"Total Pending",value:I,icon:l,color:"blue",subtitle:"Awaiting review"}),t.jsx(Ue,{title:"High Urgency",value:L,icon:r,color:"red",trend:-12,subtitle:"Immediate attention"}),t.jsx(Ue,{title:"Medium Urgency",value:U,icon:i,color:"amber",subtitle:"Standard processing"}),t.jsx(Ue,{title:"Low Urgency",value:O,icon:d,color:"green",trend:8,subtitle:"Routine requests"})]}),t.jsxs("div",{id:"requisitions-section",className:"bg-white rounded-2xl border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(c,{className:"w-5 h-5 text-gray-600"}),t.jsx("h3",{className:"font-semibold text-gray-900",children:"Pending Requisitions"})]}),t.jsxs("button",{onClick:()=>{const e=document.getElementById("requisitions-section")?.innerHTML;if(!e)return void J("Nothing to print","error");const s=window.open("","_blank","width=900,height=700");s.document.write(`\n      <html>\n        <head>\n          <title>Pending Requisitions Print</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; }\n            h1 { text-align: center; margin-bottom: 20px; }\n            .print-header { \n              display: flex; \n              justify-content: space-between; \n              align-items: center; \n              margin-bottom: 20px; \n              padding-bottom: 10px;\n              border-bottom: 1px solid #ddd;\n            }\n            .print-metrics {\n              display: grid;\n              grid-template-columns: repeat(4, 1fr);\n              gap: 15px;\n              margin-bottom: 20px;\n            }\n            .metric-box {\n              border: 1px solid #ddd;\n              padding: 15px;\n              text-align: center;\n              border-radius: 8px;\n            }\n            .metric-value {\n              font-size: 24px;\n              font-weight: bold;\n              margin: 5px 0;\n            }\n            .metric-title {\n              font-size: 14px;\n              color: #666;\n              text-transform: uppercase;\n            }\n            .requisitions-grid {\n              display: grid;\n              grid-template-columns: repeat(2, 1fr);\n              gap: 15px;\n              margin-top: 20px;\n            }\n            .requisition-card {\n              border: 1px solid #ddd;\n              border-radius: 8px;\n              padding: 15px;\n              margin-bottom: 15px;\n            }\n            .requisition-header {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 10px;\n            }\n            .urgency-badge {\n              padding: 3px 8px;\n              border-radius: 12px;\n              font-size: 12px;\n              font-weight: bold;\n            }\n            .urgency-high { background-color: #fee; color: #c00; border: 1px solid #fcc; }\n            .urgency-medium { background-color: #ffe; color: #c90; border: 1px solid #ffc; }\n            .urgency-low { background-color: #efe; color: #090; border: 1px solid #cfc; }\n            table { \n              width: 100%; \n              border-collapse: collapse; \n              margin-top: 20px; \n            }\n            th, td { \n              border: 1px solid #ddd; \n              padding: 8px; \n              text-align: left; \n              font-size: 14px; \n            }\n            th { background-color: #f4f4f4; }\n            @media print {\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="print-header">\n            <h1>Pending Requisitions Report</h1>\n            <div>Generated: ${(new Date).toLocaleDateString()}</div>\n          </div>\n          \n          <div class="print-metrics">\n            <div class="metric-box">\n              <div class="metric-value">${I}</div>\n              <div class="metric-title">Total Pending</div>\n            </div>\n            <div class="metric-box">\n              <div class="metric-value">${L}</div>\n              <div class="metric-title">High Urgency</div>\n            </div>\n            <div class="metric-box">\n              <div class="metric-value">${U}</div>\n              <div class="metric-title">Medium Urgency</div>\n            </div>\n            <div class="metric-box">\n              <div class="metric-value">${O}</div>\n              <div class="metric-title">Low Urgency</div>\n            </div>\n          </div>\n          \n          <h2>Requisitions List (${P.length} items)</h2>\n          \n          <table>\n            <thead>\n              <tr>\n                <th>Item Name</th>\n                <th>Quantity</th>\n                <th>Employee</th>\n                <th>Urgency</th>\n                <th>Budget Code</th>\n                <th>Submitted Date</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${P.map(e=>`\n                <tr>\n                  <td>${e.itemName||"N/A"}</td>\n                  <td>${e.quantity||0}</td>\n                  <td>${e.employee?.firstName||"Unknown"} ${e.employee?.lastName||""}</td>\n                  <td>\n                    <span class="urgency-badge urgency-${e.urgency||"medium"}">\n                      ${e.urgency||"N/A"}\n                    </span>\n                  </td>\n                  <td>${e.budgetCode||"N/A"}</td>\n                  <td>${e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}</td>\n                </tr>\n              `).join("")}\n            </tbody>\n          </table>\n        </body>\n      </html>\n    `),s.document.close(),s.focus(),s.print()},className:"flex items-center gap-2 px-4 py-2 border border-blue-500 text-blue-600 bg-white rounded-2xl text-sm font-medium hover:bg-blue-50 transition",children:[t.jsx(o,{size:16}),"Print"]}),t.jsxs("button",{onClick:()=>E.current.click(),className:"flex items-center gap-2 px-4 py-2 border border-blue-500 text-blue-600 bg-white rounded-2xl text-sm font-medium hover:bg-blue-50 transition",children:[t.jsx(x,{size:16}),"Excel Import"]}),t.jsxs("button",{onClick:()=>{if(!b||0===b.length)return void J("No requisitions to export","error");const e=b.map(e=>({"Item Name":e.itemName||"N/A",Quantity:e.quantity||0,"Budget Code":e.budgetCode||"N/A",Urgency:e.urgency||"N/A","Employee Name":e.employee?.firstName+" "+e.employee?.lastName||"N/A","Employee Email":e.employee?.email||"N/A",Description:e.description||"","Submitted Date":e.createdAt?G(e.createdAt):"N/A",Department:e.department||"N/A","Project Code":e.projectCode||"N/A",Status:"Pending"})),s=he.json_to_sheet(e),t=he.book_new();he.book_append_sheet(t,s,"Requisitions"),be(t,"pending-requisitions.xlsx"),J("Export successful!","success")},className:"flex items-center gap-2 px-4 py-2 border border-blue-500 text-blue-600 bg-white rounded-2xl text-sm font-medium hover:bg-blue-50 transition",children:[t.jsx(m,{size:16}),"Excel Export"]}),t.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:t.jsxs("span",{children:[P.length," of ",I," requisitions"]})})]}),0===P.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:t.jsx(l,{size:32,className:"text-gray-400"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:w||"all"!==C?"No requisitions match your filters":"No Pending Requisitions"}),t.jsx("p",{className:"text-gray-500 mb-4",children:w||"all"!==C?"Try adjusting your search criteria or filters.":"All requisitions have been processed. New requests will appear here."}),t.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-2xl font-medium hover:bg-blue-600 mx-auto",children:[t.jsx(n,{size:16}),"Refresh"]})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:P.map(e=>t.jsx(Oe,{requisition:e,onMenuClick:F,showMenuId:R,onAction:_,onView:K,onDownload:W,getUrgencyColor:H,getUrgencyIcon:V,formatDate:G},e._id))})]})]}),R&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[100] bg-transparent",onClick:()=>F(null)}),t.jsx("div",{className:"fixed z-[101] w-64 bg-white rounded-2xl shadow-2xl border border-gray-200/50 backdrop-blur-sm",style:{top:(()=>{const e=document.querySelector(`[data-requisition-id="${R}"]`);if(e){const s=e.getBoundingClientRect(),t=280,r=window.innerHeight-s.bottom,a=s.top;return r<t&&a>r?`${s.top-t+window.scrollY}px`:`${s.bottom+8+window.scrollY}px`}return"50px"})(),left:(()=>{const e=document.querySelector(`[data-requisition-id="${R}"]`);if(e){const s=e.getBoundingClientRect(),t=256;return window.innerWidth-s.right<t?s.left-t+8+"px":s.right-t+"px"}return"50px"})()},children:t.jsxs("div",{className:"py-2",children:[t.jsxs("button",{onClick:()=>K(R),className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors text-left",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(u,{size:16,className:"text-blue-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:"View Details"}),t.jsx("div",{className:"text-xs text-gray-500",children:"See full requisition"})]})]}),t.jsxs("button",{onClick:()=>W(R),className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-colors text-left",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:t.jsx(p,{size:16,className:"text-purple-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:"Download PDF"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Export as document"})]})]}),t.jsx("div",{className:"border-t border-gray-100 my-2 mx-4"}),t.jsxs("button",{onClick:()=>_(R,"approve"),className:"w-full flex items-center space-x-3 px-4 py-3 text-green-700 hover:bg-green-50 transition-colors text-left",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(g,{size:16,className:"text-green-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:"Approve"}),t.jsx("div",{className:"text-xs text-green-600",children:"Accept this request"})]})]}),t.jsxs("button",{onClick:()=>_(R,"reject"),className:"w-full flex items-center space-x-3 px-4 py-3 text-red-700 hover:bg-red-50 transition-colors text-left",children:[t.jsx("div",{className:"p-2 bg-red-50 rounded-lg",children:t.jsx(h,{size:16,className:"text-red-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:"Reject"}),t.jsx("div",{className:"text-xs text-red-600",children:"Decline this request"})]})]})]})})]}),t.jsx(fe,{children:S&&t.jsx(je.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:"fixed bottom-4 right-4 z-50",children:t.jsx("div",{className:"px-6 py-4 rounded-xl shadow-2xl border "+("success"===T?"bg-green-50 text-green-800 border-green-200":"bg-red-50 text-red-800 border-red-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:["success"===T?t.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):t.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t.jsx("span",{className:"font-medium",children:M}),t.jsx("button",{onClick:()=>A(!1),className:"ml-4 text-gray-400 hover:text-gray-600",children:t.jsx(h,{size:18})})]})})})})]})}const Ke=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"})),We=({isVisible:e,message:s="Processing..."})=>e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl p-4 flex items-center gap-2",children:[t.jsx(b,{className:"animate-spin w-4 h-4 text-blue-500"}),t.jsx("span",{className:"font-medium text-sm",children:s})]})}):null,Je=e=>{if(!e)return new Date;try{const s=new Date(e);return isNaN(s.getTime())?new Date:s}catch(s){return new Date}};function He(){s();const[n,l]=e.useState("pending"),[o,x]=e.useState(null),[m,b]=e.useState(""),[y,j]=e.useState("all"),[f,N]=e.useState(!1),[F,$]=e.useState(!1),[E,B]=e.useState(!1),[P,I]=e.useState(!1),[L,U]=e.useState(!1),[O,_]=e.useState(null),[K,W]=e.useState(!1),[J,H]=e.useState(null),[V,G]=e.useState(!1),[Y,Q]=e.useState(!0),[X,Z]=e.useState(""),[ee,se]=e.useState("success"),[te,re]=e.useState(!1),[ae,ne]=e.useState([]),le="https://backend.nexusmwi.com",[ie,de]=e.useState({internalNotes:"",expenseNotes:{},approvalDecision:"approve",reimbursementMethod:"bank-transfer",reimbursementAmount:0,reimbursementCurrency:"",reimbursementDate:we(new Date,"yyyy-MM-dd")}),[ce,oe]=e.useState({reason:"",details:"",requestedItems:[],dueDate:we(new Date(Date.now()+2592e5),"yyyy-MM-dd")});e.useEffect(()=>{(async()=>{Q(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${le}/api/travel-requests/pending/recon`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch completed travel requests");const t=await s.json(),r=t.map(e=>{const s=Je(e.departureDate),t=Je(e.returnDate||new Date(s.getTime()+864e5)),r=e.reconciled||!1,a=e.reconciliation?e.reconciliation.status:e.status,n=e.payment?.expenses?.reduce((e,s)=>e+(s.amount||0),0)||0,l=e.payment?.perDiemAmount||("MWK"===e.currency?1e5:1e3),i=e.employee||{},d=i.name||"Unknown Employee",c=i.department||"Unknown Department",o=i._id||"Unknown ID";return{id:e._id,employeeName:d,employeeId:o,department:c,purpose:e.purpose,country:"international"===e.travelType?"International":e.location||"Local",city:e.location||"Local",departureDate:s,returnDate:t,status:a,reconciled:r,perDiemAmount:l,currency:e.currency||"USD",submittedDate:Je(e.reconciliation?.submittedDate||e.createdAt),totalExpenses:n,remainingBalance:l-n,tripReport:e.reconciliation?.tripReport||"No trip report submitted",additionalNotes:e.reconciliation?.notes||"",email:i.email||"unknown@company.com",expenses:e.payment?.expenses?.map(s=>({id:s._id||Math.random().toString(36).substr(2,9),category:s.category||"Miscellaneous",description:s.description||"No description",amount:s.amount||0,currency:e.currency||"USD",date:Je(s.date||e.departureDate),paymentMethod:s.paymentMethod||"card",receipt:s.receipt||null,status:s.status||"recorded"}))||[],reconciliation:e.reconciliation?{submittedDate:Je(e.reconciliation.submittedDate||e.updatedAt),approvedDate:e.reconciliation.approvedDate?Je(e.reconciliation.approvedDate):null,approvedBy:e.reconciliation.approvedBy||e.finalApprover,totalSpent:n,remainingBalance:l-n,status:e.reconciliation.status,notes:e.reconciliation.notes||""}:null,bankDetails:e.bankDetails||{accountName:"John Doe",accountNumber:"1234567890",bankName:"Example Bank",routingNumber:"987654321"}}});ne(r),r.length>0&&(x(r[0]),de({internalNotes:"",expenseNotes:{},approvalDecision:"approve",reimbursementMethod:r[0].remainingBalance<0?"bank-transfer":"n/a",reimbursementAmount:r[0].remainingBalance<0?Math.abs(r[0].remainingBalance):0,reimbursementCurrency:r[0].currency,reimbursementDate:we(new Date,"yyyy-MM-dd")}))}catch(e){Z("Failed to fetch completed travel requests"),se("error"),re(!0)}finally{Q(!1)}})()},[le]);const xe=ae.filter(e=>{const s=e.employeeName.toLowerCase().includes(m.toLowerCase())||e.id.toLowerCase().includes(m.toLowerCase())||e.country.toLowerCase().includes(m.toLowerCase())||e.city.toLowerCase().includes(m.toLowerCase()),t="all"===y||e.department.toLowerCase()===y.toLowerCase(),r="pending"===n?"pending"===e.reconciliation?.status:"pending_reconciliation"===n?"pending_reconciliation"===e.status:e.reconciliation?.status===n;return s&&t&&r}),me=(e,s)=>{de({...ie,expenseNotes:{...ie.expenseNotes,[e]:s}})},ue=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:2}).format(e),pe=e=>e.amount>({Meals:100,Entertainment:150,Transportation:50,Accommodation:200,Miscellaneous:50}[e.category]||100),ge=e=>!e.receipt,he=e=>{switch(e){case"pending":case"pending_reconciliation":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-2xl text-xs font-medium bg-amber-100 text-amber-800 border border-amber-200",children:[t.jsx(i,{size:12,className:"mr-1"}),"pending_reconciliation"===e?"Pending Reconciliation":"Pending Review"]});case"clarification-requested":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-2xl text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200",children:[t.jsx(S,{size:12,className:"mr-1"}),"Clarification Requested"]});case"approved":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-2xl text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:[t.jsx(d,{size:12,className:"mr-1"}),"Approved"]});case"rejected":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-2xl text-xs font-medium bg-red-100 text-red-800 border border-red-200",children:[t.jsx(h,{size:12,className:"mr-1"}),"Rejected"]});default:return t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-2xl text-xs font-medium bg-gray-100 text-gray-800 border border-gray-200",children:e})}},be=e=>{switch(e){case"pending":return t.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded-2xl text-xs font-medium",children:"Pending"});case"approved":return t.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-2xl text-xs font-medium",children:"Approved"});case"rejected":return t.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-2xl text-xs font-medium",children:"Rejected"});default:return t.jsx("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-2xl text-xs font-medium",children:e})}};return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(We,{isVisible:Y,message:"Loading Reconciliation Data..."}),t.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Reconciliation Reviews"}),t.jsxs("select",{value:y,onChange:e=>j(e.target.value),className:"px-2 py-1 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs",children:[t.jsx("option",{value:"all",children:"All Departments"}),t.jsx("option",{value:"Engineering",children:"Engineering"}),t.jsx("option",{value:"Marketing",children:"Marketing"}),t.jsx("option",{value:"Sales",children:"Sales"}),t.jsx("option",{value:"Finance",children:"Finance"}),t.jsx("option",{value:"Product",children:"Product"})]})]}),t.jsxs("div",{className:"relative mb-3",children:[t.jsx(a,{className:"absolute left-2 top-2 h-3 w-3 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search reconciliations...",value:m,onChange:e=>b(e.target.value),className:"w-full pl-7 pr-3 py-1.5 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs"})]}),t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("button",{onClick:()=>l("pending_reconciliation"),className:"px-2 py-1 rounded-2xl text-xs font-medium transition-colors "+("pending_reconciliation"===n?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Review"}),t.jsx("button",{onClick:()=>l("approved"),className:"px-2 py-1 rounded-2xl text-xs font-medium transition-colors "+("approved"===n?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Approved"}),t.jsx("button",{onClick:()=>l("rejected"),className:"px-2 py-1 rounded-2xl text-xs font-medium transition-colors "+("rejected"===n?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Rejected"})]})]}),t.jsx("div",{className:"space-y-2 max-h-[calc(100vh-300px)] overflow-y-auto",children:0===xe.length?t.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 text-center",children:t.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[t.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-2xl flex items-center justify-center",children:t.jsx(c,{size:24,className:"text-gray-400"})}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:["No ",n," reconciliations found"]}),t.jsx("p",{className:"text-gray-600 text-sm",children:"All reconciliations have been processed"})]})]})}):xe.map((e,s)=>t.jsxs("div",{onClick:()=>(e=>{x(e),N(!1),$(!1),de({internalNotes:"",expenseNotes:{},approvalDecision:"approve",reimbursementMethod:e.remainingBalance<0?"bank-transfer":"n/a",reimbursementAmount:e.remainingBalance<0?Math.abs(e.remainingBalance):0,reimbursementCurrency:e.currency,reimbursementDate:we(new Date,"yyyy-MM-dd")}),oe({reason:"",details:"",requestedItems:[],dueDate:we(new Date(Date.now()+2592e5),"yyyy-MM-dd")})})(e),className:"bg-white rounded-2xl border p-2 hover:shadow-sm transition-shadow cursor-pointer "+(o?.id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-sm text-gray-900",children:e.employeeName}),t.jsx("p",{className:"text-gray-600 text-xs",children:e.id})]}),he(e.status)]}),t.jsxs("div",{className:"space-y-1 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[t.jsx(v,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[e.city,", ",e.country]})]}),t.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[t.jsx(w,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[we(e.departureDate,"MMM d")," -"," ",we(e.returnDate,"MMM d, yyyy")]})]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded-2xl text-xs font-medium",children:e.department})}),t.jsx("span",{className:"text-xs text-gray-500",children:we(e.submittedDate,"MMM d")})]})]},e.id))})]}),t.jsx("div",{className:"space-y-3",children:o?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200",children:[t.jsx("div",{className:"bg-gray-50 border-b border-gray-200 p-3 rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-blue-500 rounded-xl text-white",children:t.jsx(c,{size:16})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-base font-semibold text-gray-900",children:o.purpose}),he(o.status)]}),t.jsxs("p",{className:"text-gray-600 text-xs mt-0.5",children:[o.id," â€¢ ",o.department]})]})]}),t.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors",children:t.jsx(D,{size:16})})]})}),t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Employee Information"}),t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-xl",children:[t.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold text-xs",children:o.employeeName.split(" ").map(e=>e[0]).join("")}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm",children:o.employeeName}),t.jsx("p",{className:"text-xs text-gray-600",children:o.employeeId})]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Trip Details"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{className:"text-blue-500",size:12}),t.jsxs("span",{className:"text-gray-900 text-xs",children:[o.city,", ",o.country]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(w,{className:"text-blue-500",size:12}),t.jsxs("span",{className:"text-gray-900 text-xs",children:[we(o.departureDate,"MMM d, yyyy")," -"," ",we(o.returnDate,"MMM d, yyyy")]}),t.jsxs("span",{className:"bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded-2xl text-xs font-medium ml-1",children:[(ye=o.departureDate,je=o.returnDate,Ce(je,ye)+1)," ","days"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(i,{className:"text-blue-500",size:12}),t.jsxs("span",{className:"text-gray-900 text-xs",children:["Submitted ",we(o.submittedDate,"MMM d, yyyy")]})]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Financial Summary"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-xs",children:"Per Diem Allowance:"}),t.jsx("span",{className:"font-medium text-xs",children:ue(o.perDiemAmount,o.currency)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-xs",children:"Total Expenses:"}),t.jsx("span",{className:"font-medium text-xs",children:ue(o.totalExpenses,o.currency)})]}),t.jsx("hr",{className:"my-1"}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-xs",children:"Remaining Balance:"}),t.jsx("span",{className:"font-medium text-xs "+(o.remainingBalance<0?"text-red-600":"text-green-600"),children:ue(o.remainingBalance,o.currency)})]})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[t.jsx("span",{children:"0"}),t.jsx("span",{children:ue(o.perDiemAmount,o.currency)})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"h-1.5 rounded-full "+(o.totalExpenses>o.perDiemAmount?"bg-red-500":"bg-blue-500"),style:{width:`${Math.min(o.totalExpenses/o.perDiemAmount*100,100)}%`}})})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Trip Report"}),t.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-2",children:t.jsx("p",{className:"text-xs text-gray-700",children:o.tripReport})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Additional Notes"}),t.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-2",children:t.jsx("p",{className:"text-xs text-gray-700",children:o.additionalNotes||"No additional notes provided."})})]}),"clarification-requested"===o.status&&o.reconciliation?.clarificationRequest&&t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Clarification Request"}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-2",children:[t.jsx("h4",{className:"font-medium text-blue-800 mb-1 text-xs",children:o.reconciliation.clarificationRequest.reason}),t.jsx("p",{className:"text-blue-700 text-xs mb-2",children:o.reconciliation.clarificationRequest.details}),t.jsxs("div",{className:"mb-2",children:[t.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Requested items:"}),t.jsx("ul",{className:"list-disc list-inside text-xs text-blue-700 space-y-0.5",children:o.reconciliation.clarificationRequest.requestedItems.map((e,s)=>t.jsx("li",{children:e},s))})]}),t.jsxs("div",{className:"flex justify-between text-xs text-blue-600",children:[t.jsxs("span",{children:["By: ",o.reconciliation.clarificationRequest.requestedBy]}),t.jsxs("span",{children:["Due:"," ",we(new Date(o.reconciliation.clarificationRequest.dueDate),"MMM d")]})]})]})]}),"approved"===o.status&&o.reconciliation?.approvedDate&&t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Approval Details"}),t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[t.jsx(k,{size:12,className:"text-green-600"}),t.jsxs("span",{className:"font-medium text-green-800 text-xs",children:["Approved by ",o.reconciliation.approvedBy]})]}),t.jsx("p",{className:"text-green-700 text-xs mb-1",children:o.reconciliation.notes}),"n/a"!==ie.reimbursementMethod&&t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-green-600 font-medium mb-0.5",children:"Reimbursement Details:"}),t.jsxs("p",{className:"text-green-700 text-xs",children:[ue(ie.reimbursementAmount,o.currency)," ","via ",ie.reimbursementMethod]}),ie.reimbursementDate&&t.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Processed: ",we(new Date(ie.reimbursementDate),"MMM d, yyyy")]})]})]})]}),"rejected"===o.status&&o.reconciliation?.notes&&t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Rejection Details"}),t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[t.jsx(h,{size:12,className:"text-red-600"}),t.jsxs("span",{className:"font-medium text-red-800 text-xs",children:["Rejected by ",o.reconciliation.approvedBy]})]}),t.jsx("p",{className:"text-red-700 text-xs",children:o.reconciliation.notes})]})]})]})]}),("pending"===o.status||"pending_reconciliation"===o.status)&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-2",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(r,{className:"text-amber-600",size:16}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-amber-800 text-xs",children:"Action Required"}),t.jsx("p",{className:"text-amber-700 text-xs mt-0.5",children:"This reconciliation requires your review. Please check all expenses and the trip report for accuracy."})]})]})})]}),t.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 p-3 flex justify-between items-center rounded-b-2xl",children:[("pending"===o.status||"pending_reconciliation"===o.status)&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>$(!0),className:"px-3 py-1.5 bg-blue-100 text-blue-700 border border-blue-200 rounded-2xl hover:bg-blue-200 transition-colors flex items-center gap-1 text-xs",children:[t.jsx(S,{size:12}),"Request Clarification"]}),t.jsxs("button",{onClick:()=>N(!0),className:"px-3 py-1.5 bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors flex items-center gap-1 text-xs",children:[t.jsx(A,{size:12}),"Review & Process"]})]}),"clarification-requested"===o.status&&t.jsxs("button",{className:"px-3 py-1.5 bg-blue-100 text-blue-700 border border-blue-200 rounded-2xl hover:bg-blue-200 transition-colors flex items-center gap-1 text-xs",children:[t.jsx(M,{size:12}),"View History"]}),"approved"===o.status&&t.jsxs("button",{onClick:async()=>{B(!0);try{await Ne(o),Z("Report downloaded successfully"),se("success")}catch(e){Z("Failed to generate report"),se("error")}finally{re(!0),B(!1)}},disabled:E,className:"px-3 py-1.5 bg-green-100 text-green-700 border border-green-200 rounded-2xl hover:bg-green-200 transition-colors flex items-center gap-1 disabled:opacity-50 text-xs",children:[E?t.jsx(z,{size:12,className:"animate-spin"}):t.jsx(p,{size:12}),E?"Generating...":"Download Report"]}),"rejected"===o.status&&t.jsxs("button",{className:"px-3 py-1.5 bg-red-100 text-red-700 border border-red-200 rounded-2xl hover:bg-red-200 transition-colors flex items-center gap-1 text-xs",children:[t.jsx(M,{size:12}),"View Details"]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200",children:[t.jsx("div",{className:"bg-gray-50 border-b border-gray-200 p-3 rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-blue-100 rounded-xl",children:t.jsx(T,{size:16,className:"text-blue-600"})}),t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Expenses"})]}),t.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-2xl text-xs font-medium",children:[o.expenses.length," items"]})]})}),t.jsx("div",{className:"overflow-x-auto",children:0===o.expenses.length?t.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:"No expenses recorded"}):t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),t.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receipt"}),t.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[o.expenses.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50 "+(pe(e)?"bg-amber-50":""),children:[t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-900",children:we(Je(e.date),"MMM d, yyyy")}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-900",children:e.category}),t.jsx("td",{className:"px-3 py-2 text-xs text-gray-900",children:e.description}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-900 text-right font-medium",children:t.jsxs("div",{className:"flex items-center justify-end gap-1",children:[ue(e.amount,o.currency),pe(e)&&t.jsxs("div",{className:"group relative",children:[t.jsx(r,{size:12,className:"text-amber-500"}),t.jsx("div",{className:"absolute bottom-full right-0 mb-2 w-48 p-2 bg-gray-900 text-white text-xs rounded-xl opacity-0 group-hover:opacity-100 transition-opacity",children:"Unusually high amount for this category"})]})]})}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:be(e.status)}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.receipt?t.jsxs("button",{onClick:()=>{_(e),W(!0)},className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1",children:[t.jsx(u,{size:12}),"View"]}):t.jsx("span",{className:"bg-red-100 text-red-800 px-1.5 py-0.5 rounded-2xl text-xs font-medium",children:"Missing"})}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.jsx("button",{className:"text-gray-400 hover:text-gray-600 p-0.5 rounded-xl",children:t.jsx(D,{size:12})})})]},e.id)),t.jsxs("tr",{className:"bg-gray-100 font-medium",children:[t.jsx("td",{colSpan:3,className:"px-3 py-2 text-right text-xs text-gray-900",children:"Total"}),t.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-900 text-right font-bold",children:ue(o.totalExpenses,o.currency)}),t.jsx("td",{colSpan:3})]})]})]})})]}),f&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(A,{size:20,className:"text-green-500"}),"Review & Process Reconciliation"]}),t.jsxs("p",{className:"text-gray-600 text-xs mt-0.5",children:["Review and process ",o?.employeeName,"'s reconciliation for"," ",o?.city]})]}),t.jsx("button",{onClick:()=>N(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:20})})]})}),t.jsxs("div",{className:"p-4 max-h-[70vh] overflow-y-auto space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Decision"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("label",{className:"p-3 border-2 rounded-2xl cursor-pointer transition-colors "+("approve"===ie.approvalDecision?"border-green-300 bg-green-50":"border-gray-200 hover:border-green-200"),children:[t.jsx("input",{type:"radio",name:"decision",value:"approve",checked:"approve"===ie.approvalDecision,onChange:e=>de({...ie,approvalDecision:e.target.value}),className:"sr-only"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full border-2 "+("approve"===ie.approvalDecision?"border-green-500 bg-green-500":"border-gray-300"),children:"approve"===ie.approvalDecision&&t.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})}),t.jsx("span",{className:"font-medium text-sm",children:"Approve Reconciliation"})]})]}),t.jsxs("label",{className:"p-3 border-2 rounded-2xl cursor-pointer transition-colors "+("reject"===ie.approvalDecision?"border-red-300 bg-red-50":"border-gray-200 hover:border-red-200"),children:[t.jsx("input",{type:"radio",name:"decision",value:"reject",checked:"reject"===ie.approvalDecision,onChange:e=>de({...ie,approvalDecision:e.target.value}),className:"sr-only"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full border-2 "+("reject"===ie.approvalDecision?"border-red-500 bg-red-500":"border-gray-300"),children:"reject"===ie.approvalDecision&&t.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})}),t.jsx("span",{className:"font-medium text-sm",children:"Reject Reconciliation"})]})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Internal Notes"}),t.jsx("textarea",{placeholder:"Add notes about this reconciliation (visible to finance team only)",value:ie.internalNotes,onChange:e=>de({...ie,internalNotes:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"})]}),o.remainingBalance<0&&"approve"===ie.approvalDecision&&t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Reimbursement Details"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reimbursement Method"}),t.jsxs("select",{value:ie.reimbursementMethod,onChange:e=>de({...ie,reimbursementMethod:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",children:[t.jsx("option",{value:"bank-transfer",children:"Bank Transfer"}),t.jsx("option",{value:"payroll",children:"Add to Next Payroll"}),t.jsx("option",{value:"check",children:"Check"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reimbursement Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:o.currency}),t.jsx("input",{type:"number",value:ie.reimbursementAmount,onChange:e=>de({...ie,reimbursementAmount:Number.parseFloat(e.target.value)}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"})]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Default:"," ",ue(Math.abs(o.remainingBalance),o.currency)]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Processing Date"}),t.jsx("input",{type:"date",value:ie.reimbursementDate,onChange:e=>de({...ie,reimbursementDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(q,{size:14,className:"text-blue-600"}),t.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"Payment Details"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Account Name:"}),t.jsx("span",{className:"text-blue-600 ml-2",children:o.bankDetails.accountName})]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Account Number:"}),t.jsx("span",{className:"text-blue-600 ml-2",children:o.bankDetails.accountNumber})]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Bank:"}),t.jsx("span",{className:"text-blue-600 ml-2",children:o.bankDetails.bankName})]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-blue-700",children:"Routing Number:"}),t.jsx("span",{className:"text-blue-600 ml-2",children:o.bankDetails.routingNumber})]})]})]})]}),o.remainingBalance>0&&"approve"===ie.approvalDecision&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(d,{className:"text-green-600",size:16}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-green-800 text-sm",children:"Remaining Balance"}),t.jsxs("p",{className:"text-green-700 text-xs mt-1",children:["The employee has a remaining balance of"," ",ue(o.remainingBalance,o.currency),". This amount will be returned to the company account."]})]})]})}),"reject"===ie.approvalDecision&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(r,{className:"text-red-600",size:16}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-red-800 text-sm",children:"Rejection Notice"}),t.jsx("p",{className:"text-red-700 text-xs mt-1",children:"The employee will be notified that their reconciliation has been rejected. They will need to resubmit with corrections."})]})]})}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Expense Review"}),t.jsx("div",{className:"space-y-3",children:o.expenses.map(e=>t.jsxs("div",{className:"p-3 border rounded-2xl "+(pe(e)?"border-amber-200 bg-amber-50":"border-gray-200"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-900 text-sm",children:[e.category,": ",e.description]}),t.jsx("p",{className:"text-xs text-gray-600",children:we(Je(e.date),"MMM d, yyyy")})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm",children:ue(e.amount,o.currency)}),t.jsxs("p",{className:"text-xs text-gray-600",children:["Payment: ",e.paymentMethod]})]})]}),pe(e)&&t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-2 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(r,{className:"text-amber-600",size:12}),t.jsx("span",{className:"font-medium text-amber-800 text-xs",children:"Warning"})]}),t.jsx("p",{className:"text-amber-700 text-xs mt-0.5",children:"This expense amount is unusually high for this category."})]}),ge(e)&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-2 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(r,{className:"text-red-600",size:12}),t.jsx("span",{className:"font-medium text-red-800 text-xs",children:"Error"})]}),t.jsx("p",{className:"text-red-700 text-xs mt-0.5",children:"Receipt is missing for this expense."})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"text",placeholder:"Add notes for this expense",value:ie.expenseNotes[e.id]||"",onChange:s=>me(e.id,s.target.value),className:"flex-1 px-2 py-1.5 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-xs"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("label",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"radio",name:`expense-${e.id}`,checked:!ie.expenseNotes[e.id],onChange:()=>me(e.id,""),className:"text-green-500 focus:ring-green-500"}),t.jsx("span",{className:"text-xs text-green-700",children:"Approve"})]}),t.jsxs("label",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"radio",name:`expense-${e.id}`,checked:!!ie.expenseNotes[e.id],onChange:()=>{ie.expenseNotes[e.id]||me(e.id,"Flagged for review")},className:"text-amber-500 focus:ring-amber-500"}),t.jsx("span",{className:"text-xs text-amber-700",children:"Flag"})]})]})]})]},e.id))})]})]}),t.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between rounded-b-2xl",children:[t.jsx("button",{onClick:()=>N(!1),className:"px-3 py-1.5 text-gray-700 border border-gray-300 rounded-2xl hover:bg-gray-100 transition-colors text-sm",children:"Cancel"}),t.jsx("button",{onClick:async()=>{I(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${le}/api/travel-requests/${o.id}/process-reconciliation`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({decision:ie.approvalDecision,internalNotes:ie.internalNotes,expenseNotes:ie.expenseNotes,reimbursementMethod:ie.reimbursementMethod,reimbursementAmount:ie.reimbursementAmount,reimbursementCurrency:ie.reimbursementCurrency,reimbursementDate:ie.reimbursementDate})});if(!s.ok)throw new Error("Failed to process reconciliation");const t=await s.json();x(t.travelRequest),N(!1),l("approve"===ie.approvalDecision?"approved":"rejected"),Z(`Reconciliation ${"approve"===ie.approvalDecision?"approved":"rejected"} successfully`),se("success"),re(!0)}catch(e){Z(e.message||"Failed to process reconciliation"),se("error"),re(!0)}finally{I(!1)}},disabled:P,className:"px-3 py-1.5 text-white rounded-2xl transition-colors disabled:opacity-50 flex items-center gap-1 text-sm "+("approve"===ie.approvalDecision?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"),children:P?t.jsxs(t.Fragment,{children:[t.jsx(z,{size:14,className:"animate-spin"}),"Processing..."]}):t.jsx(t.Fragment,{children:"approve"===ie.approvalDecision?t.jsxs(t.Fragment,{children:[t.jsx(g,{size:14}),"Approve Reconciliation"]}):t.jsxs(t.Fragment,{children:[t.jsx(h,{size:14}),"Reject Reconciliation"]})})})]})]})}),F&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden",children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(S,{size:20,className:"text-blue-500"}),"Request Clarification"]}),t.jsxs("p",{className:"text-gray-600 text-xs mt-0.5",children:["Request additional information from ",o?.employeeName]})]}),t.jsx("button",{onClick:()=>$(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:20})})]})}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Clarification"}),t.jsxs("select",{value:ce.reason,onChange:e=>oe({...ce,reason:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:[t.jsx("option",{value:"",children:"Select a reason"}),t.jsx("option",{value:"Missing documentation",children:"Missing documentation"}),t.jsx("option",{value:"Policy violation",children:"Policy violation"}),t.jsx("option",{value:"Incomplete information",children:"Incomplete information"}),t.jsx("option",{value:"Expense discrepancy",children:"Expense discrepancy"}),t.jsx("option",{value:"Other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clarification Details"}),t.jsx("textarea",{placeholder:"Provide detailed information about what needs to be clarified",value:ce.details,onChange:e=>oe({...ce,details:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Requested Items"}),t.jsx("div",{className:"space-y-1",children:["Missing receipts","Expense justification","Policy explanation","Additional documentation"].map(e=>t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:ce.requestedItems.includes(e),onChange:()=>(e=>{const s=[...ce.requestedItems],t=s.indexOf(e);t>=0?s.splice(t,1):s.push(e),oe({...ce,requestedItems:s})})(e),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-700 text-sm",children:e})]},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Response Due Date"}),t.jsx("input",{type:"date",value:ce.dueDate,onChange:e=>oe({...ce,dueDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 3 business days from today"})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(q,{className:"text-blue-600",size:16}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-blue-800 text-sm",children:"Notification"}),t.jsxs("p",{className:"text-blue-700 text-xs mt-0.5",children:["An email will be sent to ",o.employeeName," (",o.email,") with your clarification request."]})]})]})})]}),t.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between rounded-b-2xl",children:[t.jsx("button",{onClick:()=>$(!1),className:"px-3 py-1.5 text-gray-700 border border-gray-300 rounded-2xl hover:bg-gray-100 transition-colors text-sm",children:"Cancel"}),t.jsx("button",{onClick:()=>{U(!0),setTimeout(()=>{const e={...o,status:"clarification-requested",reconciliation:{...o.reconciliation,status:"clarification-requested",clarificationRequest:{requestedBy:"Sarah Johnson",requestedDate:new Date,reason:ce.reason,details:ce.details,requestedItems:ce.requestedItems,dueDate:new Date(ce.dueDate),status:"pending"}}};x(e),U(!1),$(!1),l("clarification-requested")},1500)},disabled:L||!ce.reason||!ce.details||0===ce.requestedItems.length,className:"px-3 py-1.5 bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors disabled:opacity-50 flex items-center gap-1 text-sm",children:L?t.jsxs(t.Fragment,{children:[t.jsx(z,{size:14,className:"animate-spin"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{size:14}),"Send Clarification Request"]})})]})]})}),K&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[t.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 rounded-t-2xl",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Receipt"}),t.jsxs("p",{className:"text-gray-600 text-xs mt-0.5",children:[O?.description," -"," ",O?we(De(O.date),"MMMM d, yyyy"):""]})]}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"border border-gray-200 rounded-2xl overflow-hidden",children:t.jsx("img",{src:"/placeholder.svg?height=400&width=300",alt:"Receipt",className:"max-h-96 w-auto object-contain"})})})}),t.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between rounded-b-2xl",children:[t.jsx("button",{onClick:()=>W(!1),className:"px-3 py-1.5 text-gray-700 border border-gray-300 rounded-2xl hover:bg-gray-100 transition-colors text-sm",children:"Close"}),t.jsxs("button",{className:"px-3 py-1.5 bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors flex items-center gap-1 text-sm",children:[t.jsx(p,{size:14}),"Download"]})]})]})})]}):t.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 p-8 text-center",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center",children:t.jsx(c,{size:32,className:"text-gray-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Reconciliation Selected"}),t.jsx("p",{className:"text-gray-600 max-w-md mx-auto text-sm",children:"Select a reconciliation from the list to view details and process reviews"})]})]})})})]})}),te&&t.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:t.jsx("div",{className:"px-3 py-2 rounded-2xl border max-w-md "+("success"===ee?"bg-green-50 border-green-200 text-green-800":"error"===ee?"bg-red-50 border-red-200 text-red-800":"bg-blue-50 border-blue-200 text-blue-800"),children:t.jsxs("div",{className:"flex items-center gap-2",children:["success"===ee&&t.jsx(d,{size:16,className:"text-green-600"}),"error"===ee&&t.jsx(r,{size:16,className:"text-red-600"}),"info"===ee&&t.jsx(q,{size:16,className:"text-blue-600"}),t.jsx("span",{className:"font-medium text-sm",children:X}),t.jsx("button",{onClick:()=>re(!1),className:"ml-2 text-gray-400 hover:text-gray-600",children:t.jsx(h,{size:14})})]})})})]});var ye,je}const Ve=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"})),Ge=({type:e="info",title:s,children:a,onClose:n})=>{const l={info:r,success:g,warning:r,error:r}[e];return t.jsx("div",{className:`p-3 rounded-2xl border ${{info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"}[e]} mb-3`,children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(l,{className:`w-4 h-4 mt-0.5 ${{info:"text-blue-500",success:"text-green-500",warning:"text-yellow-500",error:"text-red-500"}[e]}`}),t.jsxs("div",{className:"flex-1",children:[s&&t.jsx("h4",{className:"font-medium mb-1 text-sm",children:s}),t.jsx("div",{className:"text-sm",children:a})]}),n&&t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:t.jsx(h,{size:14})})]})})},Ye=({isVisible:e,message:s="Processing..."})=>e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl p-6 flex items-center gap-3 shadow-xl",children:[t.jsx(b,{className:"animate-spin w-6 h-6 text-blue-500"}),t.jsx("span",{className:"font-medium",children:s})]})}):null,Qe={dailyRate:0,days:0,totalAmount:0,currency:"",additionalAllowance:0,notes:"",categories:{}},Xe={cardNumber:"",cardType:"visa",accountHolder:"",amount:0,currency:"",exchangeRate:1,processingFee:0,totalAmount:0,transferDate:we(new Date,"yyyy-MM-dd"),notes:""},Ze={recipient:"",subject:"",message:"",includeBreakdown:!0,sendCopy:!1};function es(){const n=s(),[l,o]=e.useState("pending"),[x,m]=e.useState(null),[u,b]=e.useState(""),[y,j]=e.useState("all"),[f,k]=e.useState(!1),[S,A]=e.useState(!1),[M,z]=e.useState(!1),[T,q]=e.useState(!1),[I,L]=e.useState(!1),[U,O]=e.useState(!1),[_,K]=e.useState({}),[W,J]=e.useState({}),[H,V]=e.useState(!1),[G,Y]=e.useState(""),[Q,X]=e.useState("success"),[Z,ee]=e.useState(!1),[se,te]=e.useState(null),[re,ae]=e.useState(null),[ne,le]=e.useState(!0),[ie,de]=e.useState([]),ce="https://backend.nexusmwi.com",[oe,xe]=e.useState(Qe),[me,ue]=e.useState(Xe),[pe,ge]=e.useState(Ze),he={USD:1,EUR:.92,GBP:.79,JPY:149.82,SGD:1.35,AUD:1.53,CAD:1.37,CNY:7.24,INR:83.12,BRL:5.12,MWK:1800},be={lilongwe:{currency:"USD",rate:100},default:{currency:"MWK",rate:4e4}};e.useEffect(()=>{K(he),J(be)},[]),e.useEffect(()=>{if(H){const e=setTimeout(()=>{V(!1)},3e3);return()=>clearTimeout(e)}},[H]);const ye=ie.filter(e=>{const s=e.employeeName||"",t=e.id||"",r=e.country||"",a=e.city||"",n=s.toLowerCase().includes(u.toLowerCase())||t.toLowerCase().includes(u.toLowerCase())||r.toLowerCase().includes(u.toLowerCase())||a.toLowerCase().includes(u.toLowerCase()),l="all"===y||e.status===y;return n&&l});e.useEffect(()=>{if(!x&&ye.length>0){const e=ye.find(e=>"pending"===e.status);m(e||ye[0])}},[ye,x]);const je=e=>{if(m(e),k(!1),A(!1),z(!1),e){const s=Ce(e.returnDate,e.departureDate)+1,t=W[e.city?.toLowerCase()]||W.default;xe({dailyRate:t.rate,days:s,totalAmount:t.rate*s,currency:e.currency,additionalAllowance:0,notes:"",categories:{}}),ue({cardNumber:`**** **** **** ${e.cardDetails.lastFour}`,cardType:e.cardDetails.type.toLowerCase(),accountHolder:e.cardDetails.holder,amount:0,currency:e.currency,exchangeRate:_[e.currency]||1,processingFee:0,totalAmount:0,transferDate:we(new Date,"yyyy-MM-dd"),notes:""})}},fe=e=>{switch(e){case"high":return t.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium",children:"High"});case"medium":return t.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded-full text-xs font-medium",children:"Medium"});case"low":return t.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Low"});default:return null}},Ne=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:2,maximumFractionDigits:2}).format(e);return e.useEffect(()=>{if(me.amount>0){const e=.005*me.amount,s=Number.parseFloat(me.amount)+e;ue(t=>({...t,processingFee:e,totalAmount:s}))}},[me.amount]),e.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${ce}/api/travel-requests/finance/pending`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch approved travel requests");const t=await s.json();de((e=>e.map(e=>({id:e._id,employeeName:e.employee?.lastName||"Employee",employeeId:e.employee?._id,department:"Not specified",fundingCodes:e.fundingCodes||"Not specified",email:e.employee?.email||"No email",purpose:e.purpose,country:e.location||"Not specified",city:e.location||"Not specified",departureDate:new Date(e.departureDate),returnDate:new Date(e.returnDate),status:"approved"===e.finalApproval?"approved":"pending",financeStatus:e.financeStatus||"pending",perDiemAmount:e.payment?.perDiemAmount||("MWK"===e.currency?1e5:1e3),currency:e.currency||"USD",cardDetails:{lastFour:"1234",type:"VISA",holder:e.employee?.name||"Employee"},documents:e.documents||[],approvedBy:e.finalApprover?.firstName&&e.finalApprover?.lastName||"Not specified",approvedAt:new Date(e.finalApprovalDate||e.updatedAt),priority:"medium",travelType:e.travelType||"local"})))(t))}catch(e){Y("Failed to fetch approved travel requests"),X("error"),V(!0)}finally{le(!1)}})()},[ce]),t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(Ye,{isVisible:ne,message:"Loading Finance Data..."}),t.jsx("main",{className:"p-4 space-y-4 max-w-7xl mx-auto",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsx(a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("input",{type:"text",placeholder:"Search requests...",value:u,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white"})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>o("pending"),className:"px-3 py-1.5 rounded-xl font-medium transition-colors text-sm "+("pending"===l?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Pending"}),t.jsx("button",{onClick:()=>o("processed"),className:"px-3 py-1.5 rounded-xl font-medium transition-colors text-sm "+("processed"===l?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Processed"})]})]}),t.jsxs("div",{className:"space-y-2 max-h-[calc(100vh-400px)] overflow-y-auto",children:["pending"===l&&t.jsx(t.Fragment,{children:0===ye.filter(e=>"pending"===e.financeStatus).length?t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-8 text-center",children:[t.jsx(c,{size:32,className:"mx-auto text-gray-400 mb-4"}),t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["No ",l," requests found"]}),t.jsx("p",{className:"text-gray-600",children:"All travel requests have been processed"})]}):ye.filter(e=>"pending"===l||e.financeStatus===l).map(e=>t.jsxs("div",{onClick:()=>je(e),className:"bg-white rounded-2xl border p-2 cursor-pointer transition-all hover:shadow-sm "+(x?.id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900",children:e.employeeName}),t.jsx("p",{className:"text-gray-600 text-sm",children:e.email})]}),fe(e.priority)]}),t.jsxs("div",{className:"space-y-1 mb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700",children:[t.jsx(v,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[e.city,", ",e.country]})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700",children:[t.jsx(w,{size:14,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[we(e.departureDate,"MMM d")," - ",we(e.returnDate,"MMM d, yyyy")]})]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium border border-blue-200",children:e.currency}),"completed"===e.financeStatus&&e.perDiemAmount&&t.jsx("span",{className:"text-green-700 text-sm font-medium",children:Ne(e.perDiemAmount,e.currency)})]}),t.jsx("span",{className:"text-xs text-gray-500",children:"completed"===e.financeStatus&&e.paymentDate?`Paid: ${we(e.paymentDate,"MMM d, yyyy")}`:`Approved: ${we(e.approvedAt,"MMM d, yyyy")}`})]})]},e.id))}),"processed"===l&&t.jsx(t.Fragment,{children:0===ye.filter(e=>"completed"===e.financeStatus).length?t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-8 text-center",children:[t.jsx(c,{size:32,className:"mx-auto text-gray-400 mb-4"}),t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["No ",l," requests found"]}),t.jsx("p",{className:"text-gray-600",children:"All travel requests have been processed"})]}):ye.filter(e=>"processed"===l||"completed"===e.financeStatus).map(e=>t.jsxs("div",{onClick:()=>je(e),className:"bg-white rounded-2xl border p-2 cursor-pointer transition-all hover:shadow-sm "+(x?.id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900",children:e.employeeName}),t.jsx("p",{className:"text-gray-600 text-sm",children:e.email})]}),fe(e.priority)]}),t.jsxs("div",{className:"space-y-1 mb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700",children:[t.jsx(v,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[e.city,", ",e.country]})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700",children:[t.jsx(w,{size:14,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[we(e.departureDate,"MMM d")," - ",we(e.returnDate,"MMM d, yyyy")]})]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium border border-blue-200",children:e.currency}),"completed"===e.financeStatus&&e.perDiemAmount&&t.jsx("span",{className:"text-green-700 text-sm font-medium",children:Ne(e.perDiemAmount,e.currency)})]}),t.jsx("span",{className:"text-xs text-gray-500",children:"completed"===e.financeStatus&&e.paymentDate?`Paid: ${we(e.paymentDate,"MMM d, yyyy")}`:`Approved: ${we(e.approvedAt,"MMM d, yyyy")}`})]})]},e.id))})]})]}),t.jsx("div",{className:"space-y-4",children:x?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[t.jsx("div",{className:"bg-blue-50 border-b border-gray-100 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-xl",children:t.jsx(c,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:x.employeeName}),(e=>{switch(e){case"pending":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-50 text-amber-700 border border-amber-200",children:[t.jsx(i,{size:12,className:"mr-1"}),"Pending"]});case"processed":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200",children:[t.jsx(P,{size:12,className:"mr-1"}),"Processed"]});case"completed":return t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-50 text-green-700 border border-green-200",children:[t.jsx(d,{size:12,className:"mr-1"}),"Completed"]});default:return t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200",children:e})}})(x.financeStatus)]}),t.jsxs("p",{className:"text-gray-600 text-sm",children:[x.email," â€¢ ",x.fundingCodes]})]})]}),t.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl",children:t.jsx(D,{size:18})})]})}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Purpose of Travel"}),t.jsx("p",{className:"text-gray-900 text-sm",children:x.purpose||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Destination"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(C,{className:"text-blue-500",size:16}),t.jsxs("span",{className:"text-gray-900 text-sm",children:[x.city,", ",x.country]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Travel Period"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(w,{className:"text-blue-500",size:16}),t.jsxs("span",{className:"text-gray-900 text-sm",children:[we(x.departureDate,"MMM d, yyyy")," -"," ",we(x.returnDate,"MMM d, yyyy")]}),t.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium ml-2",children:[Math.ceil((x.returnDate-x.departureDate)/864e5)+1," ","days"]})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Payment Details"}),t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:t.jsx(F,{className:"text-blue-600",size:14})}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-gray-900",children:[x.cardDetails.type," Card **** ",x.cardDetails.lastFour]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Holder: ",x.employeeName]})]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Currency"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(N,{className:"text-blue-500",size:16}),t.jsx("span",{className:"text-gray-900",children:x.currency}),"USD"!==x.currency&&t.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium ml-2",children:["1 USD = ",_[x.currency]," ",x.currency]})]})]}),"completed"===x.financeStatus&&x.perDiemAmount&&t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Transferred Amount"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($,{className:"text-blue-500",size:16}),t.jsx("span",{className:"font-medium text-gray-900",children:Ne(x.perDiemAmount,x.currency)})]}),x.transferredAt&&t.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Transferred on ",we(x.transferredAt,"MMMM d, yyyy")]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Approval"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{className:"text-green-500",size:16}),t.jsxs("span",{className:"text-gray-900",children:["Approved by ",x.approvedBy]})]}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:we(x.approvedAt,"MMMM d, yyyy")})]})]})]}),"pending"===x.financeStatus&&t.jsxs(Ge,{type:"warning",title:"Action Required",children:["This request requires per diem calculation and fund transfer to the employee's"," ",x.cardDetails.type," card."]}),"processed"===x.financeStatus&&t.jsx(Ge,{type:"info",title:"In Progress",children:"Funds have been processed. Please notify the employee about the transfer."}),"completed"===x.financeStatus&&t.jsx(Ge,{type:"success",title:"Completed",children:"All financial processing has been completed for this travel request."})]}),t.jsxs("div",{className:"bg-gray-50 border-t border-gray-100 p-4 flex justify-between items-center",children:["pending"===x.financeStatus&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n("/"),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-2xl hover:bg-gray-50 text-sm",children:"Back to Dashboard"}),t.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 text-sm",children:[t.jsx(E,{size:14}),"Calculate Per Diem"]})]}),"processed"===x.financeStatus&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n("/travel-dashboard"),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-2xl hover:bg-gray-50 text-sm",children:"Back to Dashboard"}),t.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-2xl hover:bg-green-700 text-sm",children:[t.jsx(R,{size:14}),"Notify Employee"]})]}),"completed"===x.financeStatus&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n("/travel-dashboard"),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-2xl hover:bg-gray-50 text-sm",children:"Back to Dashboard"}),x&&t.jsxs("button",{onClick:()=>{if(!x)return Y("Please select a travel request first"),X("error"),void V(!0);if(!x.financeStatus)return Y("Selected request is missing financial information"),X("error"),void V(!0);const e=new ke;e.setFont("helvetica"),e.setFontSize(20),e.setTextColor(40,40,40),e.text("TRANSACTION RECORD",105,20,{align:"center"}),e.setFontSize(10),e.setTextColor(100,100,100),e.text("Company Name â€¢ Finance Department",105,30,{align:"center"}),e.setDrawColor(200,200,200),e.line(20,35,190,35),e.setFontSize(14),e.setTextColor(40,40,40),e.text("Transaction Details",20,45),e.setFontSize(10),e.setTextColor(80,80,80);let s=55;e.text(`Transaction ID: ${x.id||"N/A"}`,20,s),e.text(`Date: ${we(new Date,"MMMM d, yyyy")}`,120,s),s+=8,e.text(`Employee: ${x.employeeName||"N/A"}`,20,s),e.text(`Department: ${x.department||"N/A"}`,120,s),s+=8,e.text(`Destination: ${x.city||"N/A"}, ${x.country||"N/A"}`,20,s),s+=8;const t=x.departureDate?we(x.departureDate,"MMM d, yyyy"):"N/A",r=x.returnDate?we(x.returnDate,"MMM d, yyyy"):"N/A";e.text(`Travel Period: ${t} - ${r}`,20,s);const a=x.departureDate&&x.returnDate?Math.ceil((x.returnDate-x.departureDate)/864e5)+1:"N/A";e.text(`Duration: ${a} days`,120,s),s+=8,e.text(`Purpose: ${x.purpose||"N/A"}`,20,s),s+=15,e.setFontSize(14),e.setTextColor(40,40,40),e.text("Payment Details",20,s),s+=10,e.setFontSize(10),e.setTextColor(80,80,80);const n=x.cardDetails?.type||"N/A",l=x.cardDetails?.lastFour||"N/A",i=x.cardDetails?.holder||"N/A";e.text(`Payment Method: ${n} Card **** ${l}`,20,s),s+=8,e.text(`Card Holder: ${i}`,20,s),s+=8,e.text(`Currency: ${x.currency||"N/A"}`,20,s);const d=x.currency&&_[x.currency]?`1 USD = ${_[x.currency]} ${x.currency}`:"N/A";if(e.text(`Exchange Rate: ${d}`,120,s),s+=15,e.setFontSize(14),e.setTextColor(40,40,40),e.text("Financial Breakdown",20,s),s+=10,e.setFontSize(10),x.perDiemAmount){e.text("Per Diem Amount:",20,s),e.text(Ne(x.perDiemAmount,x.currency||"USD"),120,s,{align:"right"}),s+=8;const t=.005*x.perDiemAmount;e.text("Processing Fee (0.5%):",20,s),e.text(Ne(t,x.currency||"USD"),120,s,{align:"right"}),s+=8;const r=x.perDiemAmount+t;e.setFontSize(11),e.setFont(void 0,"bold"),e.text("Total Amount:",20,s),e.text(Ne(r,x.currency||"USD"),120,s,{align:"right"}),e.setFont(void 0,"normal"),s+=12,x.currency&&_[x.currency]&&(e.setFontSize(9),e.setTextColor(100,100,100),e.text(`USD Equivalent: ${Ne(r/_[x.currency],"USD")}`,20,s),s+=15)}e.setFontSize(14),e.setTextColor(40,40,40),e.text("Approval Information",20,s),s+=10,e.setFontSize(10),e.setTextColor(80,80,80),e.text(`Approved By: ${x.approvedBy||"N/A"}`,20,s);const c=x.approvedAt?we(x.approvedAt,"MMMM d, yyyy"):"N/A";if(e.text(`Approval Date: ${c}`,120,s),s+=8,e.text(`Status: ${x.financeStatus.toUpperCase()}`,20,s),x.paymentDate){const t=we(x.paymentDate,"MMMM d, yyyy");e.text(`Payment Date: ${t}`,120,s)}s+=15,e.setFontSize(8),e.setTextColor(150,150,150),e.text("This is an automatically generated transaction record. For any discrepancies, please contact the Finance Department.",105,280,{align:"center"}),e.text(`Generated on: ${we(new Date,"yyyy-MM-dd HH:mm:ss")}`,105,285,{align:"center"});const o=`${x.id||"transaction"}-record.pdf`;e.save(o),Y(`PDF generated successfully: ${o}`),X("success"),V(!0)},className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-50 text-green-700 border border-green-200 rounded-xl hover:bg-green-100 text-sm",children:[t.jsx(p,{size:14}),"Download Transaction Record"]})]})]})]})}):t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-12 text-center",children:[t.jsx(c,{size:32,className:"mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Request Selected"}),t.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Select a travel request from the list to view details and process financial requirements"})]})})]})}),f&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]",children:t.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(E,{size:18,className:"text-blue-500"}),"Calculate Per Diem"]}),t.jsx("button",{onClick:()=>k(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]})}),t.jsxs("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("p",{className:"text-sm text-gray-600",children:["Calculate allowance for ",x?.employeeName,"'s trip to ",x?.city]})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Daily Rate *"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:x?.currency}),t.jsx("input",{type:"number",value:oe.dailyRate,onChange:e=>{const s=Number.parseFloat(e.target.value)||0;xe({...oe,dailyRate:s})},className:"w-full pl-12 pr-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Number of Days *"}),t.jsx("input",{type:"number",value:oe.days,onChange:e=>xe({...oe,days:Number.parseInt(e.target.value)||0}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Additional Allowance"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:x?.currency}),t.jsx("input",{type:"number",placeholder:"0.00",value:oe.additionalAllowance,onChange:e=>xe({...oe,additionalAllowance:Number.parseFloat(e.target.value)||0}),className:"w-full pl-12 pr-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Currency"}),t.jsx("input",{type:"text",value:x?.currency||"",readOnly:!0,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl bg-gray-50 text-gray-700"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),t.jsx("textarea",{placeholder:"Any notes about this calculation",value:oe.notes,onChange:e=>xe({...oe,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-4",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-blue-800 mb-2 text-sm",children:"Calculation Summary"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-blue-700",children:"Daily Rate Ã— Days:"}),t.jsx("span",{className:"font-medium text-blue-700",children:x&&Ne(oe.dailyRate*oe.days,x.currency)})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-blue-700",children:"Additional Allowance:"}),t.jsx("span",{className:"font-medium text-blue-700",children:x&&Ne(oe.additionalAllowance,x.currency)})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-xs text-blue-700 mb-1",children:"Total Amount"}),t.jsx("p",{className:"text-lg font-bold text-blue-800",children:x&&Ne(oe.dailyRate*oe.days+Number.parseFloat(oe.additionalAllowance||0),x.currency)})]})]})})]})]}),t.jsxs("div",{className:"px-5 py-3 bg-gray-50 border-t border-gray-200 flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Cancel"}),t.jsx("button",{onClick:()=>{q(!0),setTimeout(()=>{const e=oe.dailyRate*oe.days+Number.parseFloat(oe.additionalAllowance||0);xe({...oe,totalAmount:e}),ue({...me,amount:e,totalAmount:e+Number.parseFloat(me.processingFee||0)}),q(!1),k(!1),A(!0)},1500)},disabled:T||oe.dailyRate<=0||oe.days<=0,className:"px-4 py-2 text-xs bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors font-medium flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:T?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Calculating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{size:14}),"Confirm Calculation"]})})]})]})}),S&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]",children:t.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(B,{size:18,className:"text-blue-500"}),"Fund Transfer"]}),t.jsx("button",{onClick:()=>A(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]})}),t.jsxs("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("p",{className:"text-sm text-gray-600",children:["Transfer funds to ",x?.employeeName,"'s ",x?.cardDetails.type," card"]})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Card Details"}),t.jsxs("div",{className:"p-3 border border-gray-200 rounded-2xl bg-gray-50 flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-blue-100 rounded-full",children:t.jsx(F,{className:"text-blue-600",size:14})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm",children:me.cardNumber}),t.jsxs("p",{className:"text-xs text-gray-600",children:["Holder: ",me.employeeName]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Transfer Amount *"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:x?.currency}),t.jsx("input",{type:"number",value:me.amount,onChange:e=>ue({...me,amount:Number.parseFloat(e.target.value)||0}),className:"w-full pl-12 pr-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Currency"}),t.jsx("select",{value:me.currency,onChange:e=>ue({...me,currency:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:t.jsx("option",{value:x?.currency,children:x?.currency})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Processing Fee"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:x?.currency}),t.jsx("input",{type:"text",value:me.processingFee.toFixed(2),readOnly:!0,className:"w-full pl-12 pr-3 py-2 text-sm border border-gray-300 rounded-2xl bg-gray-50 text-gray-700"})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-calculated (0.5%)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Transfer Date"}),t.jsx("input",{type:"date",value:me.transferDate,onChange:e=>ue({...me,transferDate:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Transfer Notes"}),t.jsx("textarea",{placeholder:"Any notes about this transfer",value:me.notes,onChange:e=>ue({...me,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),"USD"!==x?.currency&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-2xl p-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(v,{size:14,className:"text-gray-500"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Exchange Rate"})]}),t.jsxs("p",{className:"text-xs text-gray-600",children:["1 USD = ",x&&_[x.currency]," ",x?.currency]})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-4",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-blue-800 mb-2 text-sm",children:"Transfer Summary"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-blue-700",children:"Transfer Amount:"}),t.jsx("span",{className:"font-medium text-blue-700",children:x&&Ne(me.amount,x.currency)})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-blue-700",children:"Processing Fee:"}),t.jsx("span",{className:"font-medium text-blue-700",children:x&&Ne(me.processingFee,x.currency)})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-xs text-blue-700 mb-1",children:"Total to Transfer"}),t.jsx("p",{className:"text-lg font-bold text-blue-800",children:x&&Ne(me.totalAmount,x.currency)}),t.jsxs("p",{className:"text-xs text-blue-600",children:["Approx."," ",x&&Ne(me.totalAmount/_[x.currency],"USD")]})]})]})}),t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(r,{className:"w-4 h-4 mt-0.5 text-yellow-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium mb-1 text-sm text-yellow-800",children:"Important"}),t.jsxs("div",{className:"text-xs text-yellow-700",children:["By proceeding, you confirm that the transfer details are correct and funds will be sent to the employee's ",x?.cardDetails.type," card. This action cannot be undone."]})]})]})})]})]}),t.jsxs("div",{className:"px-5 py-3 bg-gray-50 border-t border-gray-200 flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Back"}),t.jsx("button",{onClick:async()=>{L(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${ce}/api/travel-requests/${x.id}/finance-process`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({amount:oe.totalAmount,currency:me.currency,processingFee:me.processingFee,totalAmount:me.totalAmount,transferDate:me.transferDate})});if(!s.ok){const e=await s.json();throw new Error(e.message||"Failed to process transfer")}const t=await s.json(),r={...x,financeStatus:"processed",perDiemAmount:t.perDiemAmount,paymentDate:new Date(t.paymentDate||new Date)};m(r),de(e=>e.map(e=>e.id===x.id?r:e)),ge({recipient:x.email,subject:`Travel Funds Transfer - To ${x.location}`,message:`Dear ${x.employeeName},\n\nWe are pleased to inform you that your per diem allowance for your upcoming trip to ${x.city}, ${x.country} has been processed. A total of ${t.perDiemAmount} ${me.currency} has been transferred to your ${x.cardDetails.type} card ending in ${x.cardDetails.lastFour}.\n\nThe funds should be available within 24 hours.\n\nIf you have any questions, please contact the Finance Department.\n\nSafe travels!`,includeBreakdown:!0,sendCopy:!0}),z(!0),Y(`Successfully processed payment of ${t.perDiemAmount} ${me.currency}`),X("success"),V(!0)}catch(e){Y(e.message||"Failed to process transfer"),X("error"),V(!0)}finally{L(!1),A(!1)}},disabled:I||me.amount<=0,className:"px-4 py-2 text-xs bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors font-medium flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:I?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{size:14}),"Process Transfer"]})})]})]})}),M&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]",children:t.jsxs("div",{className:"bg-white rounded-xl w-full max-w-lg max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(R,{size:18,className:"text-green-500"}),"Notify Employee"]}),t.jsx("button",{onClick:()=>z(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]})}),t.jsxs("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("p",{className:"text-sm text-gray-600",children:["Send notification to ",x?.employeeName," about the fund transfer"]})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Recipient *"}),t.jsx("input",{type:"email",value:pe.recipient,onChange:e=>ge({...pe,recipient:e.target.value}),readOnly:!0,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl bg-gray-50 text-gray-700"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Employee's email address"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Subject *"}),t.jsx("input",{type:"text",placeholder:"Notification subject",value:pe.subject,onChange:e=>ge({...pe,subject:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Message *"}),t.jsx("textarea",{placeholder:"Enter notification message",value:pe.message,onChange:e=>ge({...pe,message:e.target.value}),rows:4,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:pe.includeBreakdown,onChange:e=>ge({...pe,includeBreakdown:e.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Include per diem breakdown"})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:pe.sendCopy,onChange:e=>ge({...pe,sendCopy:e.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Send copy to finance"})]})]}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-2xl p-3",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Preview"}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-3",children:[t.jsxs("div",{className:"space-y-1 mb-2",children:[t.jsxs("p",{className:"font-medium text-gray-900 text-xs",children:["To: ",pe.recipient]}),t.jsxs("p",{className:"font-medium text-gray-900 text-xs",children:["Subject: ",pe.subject]})]}),t.jsx("hr",{className:"my-2"}),t.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-line mb-2 max-h-20 overflow-y-auto",children:pe.message}),pe.includeBreakdown&&t.jsxs(t.Fragment,{children:[t.jsx("hr",{className:"my-2"}),t.jsx("h5",{className:"font-medium text-gray-900 mb-1 text-xs",children:"Per Diem Breakdown:"}),t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{children:"Daily Rate:"}),t.jsx("span",{className:"font-medium",children:x&&Ne(oe.dailyRate,x.currency)})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{children:"Number of Days:"}),t.jsx("span",{className:"font-medium",children:oe.days})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{children:"Additional Allowance:"}),t.jsx("span",{className:"font-medium",children:x&&Ne(oe.additionalAllowance,x.currency)})]}),t.jsx("hr",{className:"my-1"}),t.jsxs("div",{className:"flex justify-between text-xs font-semibold",children:[t.jsx("span",{children:"Total Amount:"}),t.jsx("span",{children:x&&Ne(me.totalAmount,x.currency)})]})]})]})]})]}),t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(d,{className:"w-4 h-4 mt-0.5 text-green-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium mb-1 text-sm text-green-800",children:"Ready to Send"}),t.jsxs("div",{className:"text-xs text-green-700",children:["The notification will be sent to ",x?.employeeName," with transfer confirmation details.",pe.sendCopy&&" A copy will also be sent to the finance department."]})]})]})})]})]}),t.jsxs("div",{className:"px-5 py-3 bg-gray-50 border-t border-gray-200 flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>z(!1),className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Back"}),t.jsx("button",{onClick:async()=>{if(!U){O(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${ce}/api/travel-requests/${x.id}/send-notification`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(pe)});if(!s.ok){const e=await s.json();throw new Error(e.message||"Failed to send notification")}await s.json();const t={...x,financeStatus:"completed"};m(t),de(e=>e.map(e=>e.id===x.id?t:e)),Y("Notification sent successfully!"),X("success"),V(!0),z(!1)}catch(e){Y(e.message||"Failed to send notification"),X("error"),V(!0)}finally{O(!1)}}},disabled:U||!pe.subject||!pe.message,className:"px-4 py-2 text-xs bg-green-500 text-white rounded-2xl hover:bg-green-600 transition-colors font-medium flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:U?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{size:14}),"Send Notification"]})})]})]})}),H&&t.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:t.jsx("div",{className:"px-4 py-3 rounded-2xl shadow-lg border max-w-md "+("success"===Q?"bg-green-50 border-green-200 text-green-800":"error"===Q?"bg-red-50 border-red-200 text-red-800":"bg-blue-50 border-blue-200 text-blue-800"),children:t.jsxs("div",{className:"flex items-center gap-3",children:["success"===Q&&t.jsx(d,{size:16,className:"text-green-600"}),"error"===Q&&t.jsx(r,{size:16,className:"text-red-600"}),t.jsx("span",{className:"font-medium text-sm",children:G}),t.jsx("button",{onClick:()=>V(!1),className:"ml-2 text-gray-400 hover:text-gray-600","aria-label":"Dismiss notification",children:t.jsx(h,{size:14})})]})})})]})}const ss=Object.freeze(Object.defineProperty({__proto__:null,default:es},Symbol.toStringTag,{value:"Module"})),ts="https://backend.nexusmwi.com";function rs(){const[l,o]=e.useState("overview"),[m,g]=e.useState(!1),[w,D]=e.useState(""),[k,S]=e.useState(!1),[A,M]=e.useState({overview:null,stats:null,quickLinks:null,loading:!1});s();const{enqueueSnackbar:z}=Ae(),[q,R]=e.useState(0),[F,E]=e.useState(0),[B,se]=e.useState(0),[te,re]=e.useState(!1),[ae,ne]=e.useState(!1),[le,ie]=e.useState(!1),[de,ce]=e.useState(null),[oe,xe]=e.useState(null),[me,ue]=e.useState(null),[pe,ge]=e.useState([]),[he,be]=e.useState([]),[ye,je]=e.useState([]),[fe,Ne]=e.useState(!1),[ve,we]=e.useState(!1),[De,Ce]=e.useState(null),[ke,Ie]=e.useState({totalTrips:0,totalExpenses:0,averageExpense:0,budgetUtilization:0}),[Le,Ue]=e.useState({totalAllowances:0,totalExpenses:0,pendingReimbursements:0,currentBalance:0,monthlyAllowances:0,monthlyExpenses:0}),[Oe,_e]=e.useState([{category:"Transport",amount:0,percentage:45,color:"#3B82F6"},{category:"Accommodation",amount:0,percentage:30,color:"#10B981"},{category:"Meals",amount:0,percentage:15,color:"#F59E0B"},{category:"Other",amount:0,percentage:10,color:"#EF4444"}]),[Ke,We]=e.useState([]),[Je,He]=e.useState("details"),Ve=e=>{const s="local"===e?"localTravelDraft":"internationalTravelDraft",t=localStorage.getItem(s);return t?JSON.parse(t):{destination:"",purpose:"",startDate:"",endDate:"",estimatedCost:"",accommodationCost:"",transportCost:"",mealsCost:"",otherCosts:"",budgetCode:"",department:"",urgency:"medium",receipts:[],meansOfTravel:"company"}},Ge=e=>{const s="local"===e?"localTravelDraft":"internationalTravelDraft";localStorage.removeItem(s)},Ye=({title:e,value:s,icon:r,color:a,trend:n,subtitle:l,prefix:i="",suffix:d="",size:c="normal",onClick:o})=>{const x="large"===c?"col-span-2":"",m="large"===c?"text-2xl":"text-base";return t.jsxs("div",{className:`bg-white rounded-2xl border border-gray-200 p-1.5 hover:shadow-sm transition-shadow cursor-pointer ${x}`,onClick:o,children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("div",{className:"p-1.5 rounded-xl "+("blue"===a?"bg-blue-50":"green"===a?"bg-emerald-50":"purple"===a?"bg-purple-50":"orange"===a?"bg-orange-50":"red"===a?"bg-red-50":"bg-gray-50"),children:t.jsx(r,{size:16,className:"blue"===a?"text-blue-600":"green"===a?"text-emerald-600":"purple"===a?"text-purple-600":"orange"===a?"text-orange-600":"red"===a?"text-red-600":"text-gray-600"})}),n&&t.jsxs("div",{className:"flex items-center gap-1",children:[n>0?t.jsx(y,{size:12,className:"text-emerald-500"}):t.jsx(j,{size:12,className:"text-red-500"}),t.jsxs("span",{className:"text-xs font-medium "+(n>0?"text-emerald-500":"text-red-500"),children:[n>0?"+":"",n,"%"]})]})]}),t.jsxs("div",{className:`${m} font-bold text-gray-900 mb-1`,children:[i,"number"==typeof s?s.toLocaleString():s,d]}),t.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:e}),l&&t.jsx("div",{className:"text-xs text-gray-400",children:l})]})},Qe=({type:s,onCancel:r,onSubmitSuccess:a})=>{const[n,l]=e.useState(()=>Ve(s)),[i,d]=e.useState({transport:0,accommodation:0,meals:0,other:0,total:0}),[c,o]=e.useState({isValid:!0,warnings:[],exceedsLimit:!1}),m=(e,s)=>{const t="local"===e?"localTravelDraft":"internationalTravelDraft";localStorage.setItem(t,JSON.stringify(s)),z("Draft saved successfully!",{variant:"success"})};return e.useEffect(()=>{const e=setTimeout(()=>{m(s,n)},500);return()=>clearTimeout(e)},[n,s]),e.useEffect(()=>{const e=Number.parseFloat(n.transportCost)||0,s=Number.parseFloat(n.accommodationCost)||0,t=Number.parseFloat(n.mealsCost)||0,r=Number.parseFloat(n.otherCosts)||0,a=e+s+t+r;if(d({transport:e,accommodation:s,meals:t,other:r,total:a}),l(e=>({...e,estimatedCost:a.toString()})),me&&a>0){const e=a>me.remaining,s=a/me.remaining>.3;o({isValid:!e,warnings:[...e?["This request exceeds your remaining travel budget"]:[],...s&&!e?["This request uses more than 30% of remaining budget"]:[]],exceedsLimit:e})}},[n.transportCost,n.accommodationCost,n.mealsCost,n.otherCosts,me]),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"details",label:"Trip Details",icon:C},{id:"budget",label:"Budget & Costs",icon:$},{id:"expenses",label:"Expense Planning",icon:T}].map(e=>t.jsxs("button",{onClick:()=>He(e.id),className:"flex items-center gap-1.5 px-3 py-2 font-medium text-sm transition-colors "+(Je===e.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:[t.jsx(e.icon,{size:14}),e.label]},e.id))}),"details"===Je&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Destination *"}),t.jsx("input",{type:"text",value:n.destination,onChange:e=>l(s=>({...s,destination:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"international"===s?"e.g., London, UK":"e.g., Lilongwe, Malawi"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Purpose of Travel *"}),t.jsxs("select",{value:n.purpose,onChange:e=>l(s=>({...s,purpose:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select purpose"}),t.jsx("option",{value:"business_meeting",children:"Business Meeting"}),t.jsx("option",{value:"conference",children:"Conference/Training"}),t.jsx("option",{value:"client_visit",children:"Client Visit"}),t.jsx("option",{value:"project_work",children:"Project Work"}),t.jsx("option",{value:"other",children:"Other"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date *"}),t.jsx("input",{type:"date",value:n.startDate,onChange:e=>l(s=>({...s,startDate:e.target.value})),min:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date *"}),t.jsx("input",{type:"date",value:n.endDate,onChange:e=>l(s=>({...s,endDate:e.target.value})),min:n.startDate||(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Department *"}),t.jsxs("select",{value:n.department,onChange:e=>{const s=pe.find(s=>s.name===e.target.value);l(t=>({...t,department:e.target.value,budgetCode:s?.departmentCode||""}))},children:[t.jsx("option",{value:"",children:"Select department"}),pe.map(e=>t.jsx("option",{value:e.name,children:e.name},e._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Priority Level"}),t.jsxs("select",{value:n.urgency,onChange:e=>l(s=>({...s,urgency:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"low",children:"Low (2-4 weeks notice)"}),t.jsx("option",{value:"medium",children:"Medium (1-2 weeks notice)"}),t.jsx("option",{value:"high",children:"High (Urgent - less than 1 week)"})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Means of Travel *"}),t.jsxs("select",{value:n.meansOfTravel,onChange:e=>l(s=>({...s,meansOfTravel:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",children:"Select means"}),t.jsx("option",{value:"company",children:"Company Car"}),t.jsx("option",{value:"own",children:"Own Car"}),t.jsx("option",{value:"rental",children:"Rental"}),t.jsx("option",{value:"public",children:"Public Transport"}),t.jsx("option",{value:"other",children:"Other"})]})]})})]}),"budget"===Je&&t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-3",children:[t.jsx("h4",{className:"font-bold text-gray-900 mb-3 text-sm",children:"Estimated Costs Breakdown"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Transport Costs (MWK)"}),t.jsx("input",{type:"number",value:n.transportCost,onChange:e=>l(s=>({...s,transportCost:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Accommodation Costs (MWK)"}),t.jsx("input",{type:"number",value:n.accommodationCost,onChange:e=>l(s=>({...s,accommodationCost:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Meals & Allowances (MWK)"}),t.jsx("input",{type:"number",value:n.mealsCost,onChange:e=>l(s=>({...s,mealsCost:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Other Expenses (MWK)"}),t.jsx("input",{type:"number",value:n.otherCosts,onChange:e=>l(s=>({...s,otherCosts:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"})]})]}),t.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Cost Summary"}),t.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["MWK ",i.total.toLocaleString()]})]}),t.jsx("div",{className:"space-y-1.5",children:[{label:"Transport",amount:i.transport,color:"#3B82F6"},{label:"Accommodation",amount:i.accommodation,color:"#10B981"},{label:"Meals",amount:i.meals,color:"#F59E0B"},{label:"Other",amount:i.other,color:"#EF4444"}].map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-xs text-gray-600",children:e.label})]}),t.jsxs("span",{className:"text-xs font-medium",children:["MWK ",e.amount.toLocaleString()]})]},s))})]}),c.warnings.length>0&&t.jsx("div",{className:"mt-3 p-2 rounded-2xl border "+(c.exceedsLimit?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"),children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(J,{className:"w-4 h-4 mt-0.5 "+(c.exceedsLimit?"text-red-600":"text-amber-600")}),t.jsxs("div",{children:[t.jsxs("h6",{className:"font-medium text-xs "+(c.exceedsLimit?"text-red-900":"text-amber-900"),children:["Budget ",c.exceedsLimit?"Exceeded":"Warning"]}),t.jsx("ul",{className:"text-xs mt-1 "+(c.exceedsLimit?"text-red-700":"text-amber-700"),children:c.warnings.map((e,s)=>t.jsxs("li",{children:["â€¢ ",e]},s))})]})]})})]})}),"expenses"===Je&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-3",children:[t.jsx("h4",{className:"font-bold text-gray-900 mb-3 text-sm",children:"Supporting Documents"}),t.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-2xl p-4 text-center",children:[t.jsx(x,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-gray-600 text-xs",children:"Upload pre-approval documents, quotes, or itineraries"}),t.jsx("p",{className:"text-xs text-gray-500",children:"PDF, PNG, JPG up to 10MB each"})]}),t.jsx("button",{className:"mt-2 px-3 py-1.5 bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors text-xs",children:"Choose Files"})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-3",children:[t.jsx("h4",{className:"font-bold text-blue-900 mb-2 text-sm",children:"Travel Expense Guidelines"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-blue-800 mb-1",children:"Transport"}),t.jsxs("ul",{className:"text-blue-700 space-y-0.5",children:[t.jsx("li",{children:"â€¢ Economy class flights only"}),t.jsx("li",{children:"â€¢ Book 2 weeks in advance when possible"}),t.jsx("li",{children:"â€¢ Use company preferred vendors"})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-blue-800 mb-1",children:"Accommodation"}),t.jsxs("ul",{className:"text-blue-700 space-y-0.5",children:[t.jsx("li",{children:"â€¢ Standard business hotels"}),t.jsx("li",{children:"â€¢ Maximum MWK 25,000/night local"}),t.jsx("li",{children:"â€¢ Maximum MWK 45,000/night international"})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-blue-800 mb-1",children:"Meals"}),t.jsxs("ul",{className:"text-blue-700 space-y-0.5",children:[t.jsx("li",{children:"â€¢ MWK 8,000/day local allowance"}),t.jsx("li",{children:"â€¢ MWK 15,000/day international allowance"}),t.jsx("li",{children:"â€¢ Keep receipts for reimbursement"})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-blue-800 mb-1",children:"Other"}),t.jsxs("ul",{className:"text-blue-700 space-y-0.5",children:[t.jsx("li",{children:"â€¢ Airport parking/transfers"}),t.jsx("li",{children:"â€¢ Business communications"}),t.jsx("li",{children:"â€¢ Pre-approved incidentals"})]})]})]})]}),n.startDate&&n.endDate&&t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-3",children:[t.jsx("h4",{className:"font-bold text-green-900 mb-2 text-sm",children:"Estimated Daily Allowances"}),(()=>{const e=new Date(n.startDate),r=new Date(n.endDate),a=Math.ceil((r-e)/864e5)+1,l="international"===s?15e3:8e3,i=a*l;return t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-lg font-bold text-green-900",children:a}),t.jsx("div",{className:"text-xs text-green-700",children:"Days"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-lg font-bold text-green-900",children:["MWK ",l.toLocaleString()]}),t.jsx("div",{className:"text-xs text-green-700",children:"Daily Allowance"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-lg font-bold text-green-900",children:["MWK ",i.toLocaleString()]}),t.jsx("div",{className:"text-xs text-green-700",children:"Total Allowance"})]})]})})()]})]}),t.jsxs("div",{className:"flex justify-between pt-3 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>{Ge(s),l(Ve(s)),r()},className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Cancel"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>{m(s,n)},className:"px-4 py-2 text-xs bg-gray-100 text-gray-700 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Save Draft"}),t.jsxs("button",{type:"button",disabled:c.exceedsLimit,onClick:async()=>{try{await Ze(n,s),Ge(s),z(("local"===s?"Local":"International")+" travel request submitted successfully!",{variant:"success"}),rs(),r(),a()}catch(e){z(`Failed to submit travel request: ${e.message}`,{variant:"error"})}},className:"px-4 py-2 text-xs rounded-2xl font-medium transition-colors flex items-center gap-1 "+(c.exceedsLimit?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:[t.jsx(ee,{size:12}),"Submit Request"]})]})]})]})};e.useEffect(()=>(ie(!0),()=>ie(!1)),[]);const Xe=async()=>{try{Ne(!0),Ce(null);const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const s=await fetch(`${ts}/api/departments`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch department data");const t=(await s.json()).data||[];ge(t);const r=t.reduce((e,s)=>e+.1*(s.budgetInfo?.total||s.budget||0),0),a=t.reduce((e,s)=>e+.1*(s.budgetInfo?.actualSpending||s.actualSpending||0),0);ue({totalBudget:r,totalSpent:a,remaining:r-a,utilization:r>0?a/r*100:0})}catch(e){Ce(e.message),ue({totalBudget:25e4,totalSpent:18e4,remaining:7e4,utilization:72}),ge([])}finally{Ne(!1)}},Ze=async(e,s)=>{try{const t=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user"));let a="";r?.department?.departmentCode&&(a=r.department.departmentCode);const n={employee:r._id,purpose:e.purpose,departureDate:e.startDate,returnDate:e.endDate,location:e.destination,destination:"international"===s?e.destination:void 0,travelType:s,estimatedCost:e.estimatedCost,meansOfTravel:e.meansOfTravel||"company",currency:"international"===s?"USD":"MWK",documents:e.receipts,additionalNotes:"",fundingCodes:e.budgetCode};return(await Se.post(`${ts}/api/travel-requests`,n,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data}catch(t){throw t}},es=async()=>{try{we(!0);const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const s=await fetch(`${ts}/api/travel-requests?limit=10&sort=createdAt&order=desc`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=((await s.json()).data||[]).map((e,s)=>({id:e.requestId||`TR-2024-${String(s+1).padStart(3,"0")}`,destination:e.destination||"Unknown Destination",type:e.travelType||"Local",status:e.status||"pending",date:e.travelDate?new Date(e.travelDate).toLocaleDateString():"TBD",amount:`MWK ${(e.estimatedCost||e.totalCost||0).toLocaleString()}`,purpose:e.purpose||"Business Trip"}));je(e);const t=e.length,r=e.reduce((e,s)=>e+(Number.parseFloat(s.amount.replace(/[MWK\s,]/g,""))||0),0);Ie({totalTrips:t,totalExpenses:r,averageExpense:t>0?r/t:0,budgetUtilization:me?r/me.totalBudget*100:0});const a=e.filter(e=>"approved"===e.status),n=e.filter(e=>"pending"===e.status),l=a.reduce((e,s)=>e+(Number.parseFloat(s.amount.replace(/[MWK\s,]/g,""))||0),0),i=n.reduce((e,s)=>e+(Number.parseFloat(s.amount.replace(/[MWK\s,]/g,""))||0),0),d=e.filter(e=>{const s=new Date(e.date),t=new Date;return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear()}).reduce((e,s)=>e+(Number.parseFloat(s.amount.replace(/[MWK\s,]/g,""))||0),0);Ue({totalAllowances:me?me.totalBudget:25e4,totalExpenses:l,pendingReimbursements:i,currentBalance:me?me.remaining:7e4,monthlyAllowances:me?Math.round(me.totalBudget/12):2e4,monthlyExpenses:d});const c=Math.round(.45*l),o=Math.round(.3*l),x=Math.round(.15*l);_e([{category:"Transport",amount:c,percentage:45,color:"#3B82F6"},{category:"Accommodation",amount:o,percentage:30,color:"#10B981"},{category:"Meals",amount:x,percentage:15,color:"#F59E0B"},{category:"Other",amount:l-c-o-x,percentage:10,color:"#EF4444"}]);const m=n.slice(0,3).map((e,s)=>({id:s+1,type:`${e.type} Travel - ${e.destination.split(",")[0]}`,amount:Number.parseFloat(e.amount.replace(/[MWK\s,]/g,""))||0,submittedDate:e.date,expectedApproval:new Date(Date.now()+24*(3+s)*60*60*1e3).toISOString().split("T")[0],status:"under_review",receipts:Math.floor(3*Math.random())+1}));We(m)}else{je([{id:"TR-2024-001",destination:"Lilongwe, Malawi",type:"Local",status:"completed",date:"Mar 15-17, 2024",amount:"MWK 45,000",purpose:"Client Meeting"},{id:"TR-2024-002",destination:"Johannesburg, SA",type:"International",status:"approved",date:"Apr 20-25, 2024",amount:"MWK 125,000",purpose:"Conference"},{id:"TR-2024-003",destination:"Blantyre, Malawi",type:"Local",status:"pending",date:"May 10-12, 2024",amount:"MWK 32,000",purpose:"Training"}]),Ie({totalTrips:12,totalExpenses:18e4,averageExpense:15e3,budgetUtilization:72}),Ue({totalAllowances:25e4,totalExpenses:18e4,pendingReimbursements:32e3,currentBalance:7e4,monthlyAllowances:2e4,monthlyExpenses:45e3})}}catch(e){je([{id:"TR-2024-001",destination:"Lilongwe, Malawi",type:"Local",status:"completed",date:"Mar 15-17, 2024",amount:"MWK 45,000",purpose:"Client Meeting"}]),Ie({totalTrips:12,totalExpenses:18e4,averageExpense:15e3,budgetUtilization:72}),Ue({totalAllowances:25e4,totalExpenses:18e4,pendingReimbursements:32e3,currentBalance:7e4,monthlyAllowances:2e4,monthlyExpenses:45e3})}finally{we(!1)}},ss=async()=>{try{const e=localStorage.getItem("token"),s=await Se.get("undefined/api/travel-requests/pending/stat",{headers:{Authorization:`Bearer ${e}`}});s.data&&(R(s.data.totalPending||0),E(s.data.pendingLocal||0),se(s.data.pendingInternational||0))}catch(e){R(3),E(2),se(1)}};e.useEffect(()=>{Xe(),es(),ss()},[]);const rs=()=>{Xe(),es(),ss()},as=me?[{name:"Transport",value:Math.round(.45*me.totalSpent),percentage:45,color:"#3b82f6"},{name:"Accommodation",value:Math.round(.3*me.totalSpent),percentage:30,color:"#10b981"},{name:"Meals",value:Math.round(.15*me.totalSpent),percentage:15,color:"#f59e0b"},{name:"Other",value:Math.round(.1*me.totalSpent),percentage:10,color:"#ef4444"}]:[{name:"Transport",value:81e3,percentage:45,color:"#3b82f6"},{name:"Accommodation",value:54e3,percentage:30,color:"#10b981"},{name:"Meals",value:27e3,percentage:15,color:"#f59e0b"},{name:"Other",value:18e3,percentage:10,color:"#ef4444"}],ns=e=>{switch(e){case"completed":return"text-green-700 bg-green-50 border-green-200";case"approved":return"text-blue-700 bg-blue-50 border-blue-200";case"pending":return"text-amber-700 bg-amber-50 border-amber-200";case"rejected":return"text-red-700 bg-red-50 border-red-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}},ls=e=>{switch(e){case"completed":case"approved":return t.jsx(d,{size:12});case"pending":return t.jsx(i,{size:12});case"rejected":return t.jsx(h,{size:12});default:return t.jsx(r,{size:12})}};return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:[t.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsx("div",{children:t.jsxs("h1",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl text-white",children:t.jsx(I,{size:20})}),"Travel Dashboard"]})})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("button",{onClick:()=>S(!k),className:"p-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",children:t.jsx(a,{size:16})}),t.jsx("button",{className:"p-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",children:t.jsx(L,{size:16})}),t.jsx("button",{className:"p-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",children:t.jsx(U,{size:16})}),t.jsx("button",{onClick:rs,disabled:fe||ve,className:"p-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",children:t.jsx(n,{size:16,className:fe||ve?"animate-spin":""})})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>g(!m),className:"px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl hover:from-blue-600 hover:to-blue-700 transition-all text-xs font-medium shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-1.5",children:[t.jsx(O,{size:16}),"New Travel Request"]}),m&&t.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-2xl shadow-xl border border-gray-200 z-50",children:t.jsxs("div",{className:"p-1.5",children:[t.jsxs("button",{onClick:()=>{re(!0),g(!1)},className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-blue-50 rounded-xl transition-colors",children:[t.jsx("div",{className:"p-1.5 bg-blue-100 rounded-xl",children:t.jsx(C,{size:14,className:"text-blue-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"Local Travel"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Domestic business trips"})]})]}),t.jsxs("button",{onClick:()=>{ne(!0),g(!1)},className:"w-full flex items-center space-x-2 px-3 py-2 text-left hover:bg-purple-50 rounded-xl transition-colors",children:[t.jsx("div",{className:"p-1.5 bg-purple-100 rounded-xl",children:t.jsx(v,{size:14,className:"text-purple-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 text-sm",children:"International Travel"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Global business trips"})]})]})]})})]})]})]}),k&&t.jsxs("div",{className:"max-w-7xl mx-auto mt-3 flex items-center bg-gray-50 rounded-2xl px-3 py-2 border border-gray-200 transition-all",children:[t.jsx(a,{size:16,className:"text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search travel requests, destinations, or expenses...",value:w,onChange:e=>D(e.target.value),className:"bg-transparent border-none outline-none text-gray-800 w-full pl-2 placeholder-gray-400 text-sm"})]})]}),t.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 mb-4 shadow-sm",children:[t.jsx("div",{className:"flex border-b border-gray-200 bg-white rounded-t-2xl",children:["overview","analytics","expenses"].map(e=>t.jsxs("button",{onClick:()=>o(e),className:"flex-1 py-3 text-sm font-medium transition-all relative "+(l===e?"text-blue-600":"text-gray-500 hover:text-gray-800"),children:["overview"===e&&t.jsx(_,{size:14,className:"inline mr-1.5"}),"analytics"===e&&t.jsx(y,{size:14,className:"inline mr-1.5"}),"expenses"===e&&t.jsx($,{size:14,className:"inline mr-1.5"}),e.charAt(0).toUpperCase()+e.slice(1),l===e&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500"})]},e))}),"overview"===l&&t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-3 border border-blue-200 hover:shadow-sm transition-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-blue-500 rounded-xl shadow-sm",children:t.jsx(I,{size:18,className:"text-white"})}),t.jsx("div",{className:"text-right",children:ve?t.jsx(b,{size:16,className:"animate-spin text-blue-600"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xl font-bold text-blue-900",children:ke.totalTrips}),t.jsx("div",{className:"text-xs text-blue-600",children:"Total Trips"})]})})]}),t.jsxs("div",{className:"flex items-center text-xs text-blue-700",children:[t.jsx(K,{size:12,className:"mr-1"}),t.jsx("span",{children:"+2 from last month"})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl p-3 border border-amber-200 hover:shadow-sm transition-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-amber-500 rounded-xl shadow-sm",children:t.jsx(i,{size:18,className:"text-white"})}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xl font-bold text-amber-900",children:q}),t.jsx("div",{className:"text-xs text-amber-600",children:"Pending Approvals"})]})]}),t.jsxs("div",{className:"text-xs text-amber-700",children:[F," local, ",B," international"]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-3 border border-green-200 hover:shadow-sm transition-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-green-500 rounded-xl shadow-sm",children:t.jsx($,{size:18,className:"text-white"})}),t.jsx("div",{className:"text-right",children:fe?t.jsx(b,{size:16,className:"animate-spin text-green-600"}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-xl font-bold text-green-900",children:["MWK ",Le.totalExpenses.toLocaleString()]}),t.jsx("div",{className:"text-xs text-green-600",children:"Total Expenses"})]})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"w-full bg-green-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-1000",style:{width:le?`${me?me.utilization:72}%`:"0%"}})}),t.jsxs("div",{className:"text-xs text-green-700",children:[me?me.utilization.toFixed(1):"72","% of annual budget"]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-3 border border-purple-200 hover:shadow-sm transition-shadow",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-purple-500 rounded-xl shadow-sm",children:t.jsx(N,{size:18,className:"text-white"})}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-xl font-bold text-purple-900",children:["MWK ",Le.currentBalance.toLocaleString()]}),t.jsx("div",{className:"text-xs text-purple-600",children:"Available Balance"})]})]}),t.jsx("div",{className:"text-xs text-purple-700",children:"Current allocation remaining"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[t.jsx(Ye,{title:"Month Allowances",value:Le.monthlyAllowances,prefix:"MWK ",icon:W,color:"green",trend:8,subtitle:"This month allocated"}),t.jsx(Ye,{title:"Month Expenses",value:Le.monthlyExpenses,prefix:"MWK ",icon:T,color:"blue",trend:-3,subtitle:"This month spent"}),t.jsx(Ye,{title:"Pending Reimbursements",value:Le.pendingReimbursements,prefix:"MWK ",icon:i,color:"orange",subtitle:"Awaiting approval"}),t.jsx(Ye,{title:"Avg Trip Cost",value:ke.averageExpense,prefix:"MWK ",icon:_,color:"purple",trend:5,subtitle:"Per trip average"})]}),me&&me.utilization>80&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-3 mb-4 hover:shadow-sm transition-shadow",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-1.5 bg-amber-100 rounded-xl",children:t.jsx(J,{className:"w-4 h-4 text-amber-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-bold text-amber-900 mb-1 text-sm",children:"Budget Alert - Immediate Attention Required"}),t.jsxs("p",{className:"text-amber-800 mb-2 text-xs",children:["You've used ",me.utilization.toFixed(1),"% of your annual travel budget. Consider reviewing upcoming travel plans to stay within budget limits."]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-3 py-1.5 bg-amber-600 text-white rounded-2xl hover:bg-amber-700 transition-colors font-medium text-xs",children:"Review Budget"}),t.jsx("button",{className:"px-3 py-1.5 bg-white text-amber-600 border border-amber-600 rounded-2xl hover:bg-amber-50 transition-colors font-medium text-xs",children:"View Guidelines"})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 shadow-sm hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(H,{className:"w-4 h-4 text-blue-500"}),t.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:"Expense Breakdown"})]}),t.jsx(Me,{width:"100%",height:150,children:t.jsxs(ze,{children:[t.jsx(Te,{data:Oe,cx:"50%",cy:"50%",innerRadius:30,outerRadius:60,paddingAngle:5,dataKey:"amount",children:Oe.map((e,s)=>t.jsx(qe,{fill:e.color},`cell-${s}`))}),t.jsx(Re,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}})]})}),t.jsx("div",{className:"space-y-1.5 mt-3",children:Oe.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-gray-600",children:e.category})]}),t.jsxs("span",{className:"font-medium",children:["MWK ",e.amount.toLocaleString()]})]},s))})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 shadow-sm hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(v,{className:"w-4 h-4 text-purple-500"}),t.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:"Travel Types"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),t.jsx("span",{className:"text-gray-700 font-medium text-xs",children:"Local Travel"})]}),t.jsxs("span",{className:"text-gray-900 font-bold text-xs",children:[ye.filter(e=>"Local"===e.type).length," trips"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-1000",style:{width:le?"75%":"0%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),t.jsx("span",{className:"text-gray-700 font-medium text-xs",children:"International"})]}),t.jsxs("span",{className:"text-gray-900 font-bold text-xs",children:[ye.filter(e=>"International"===e.type).length," trips"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-1000 delay-300",style:{width:le?"25%":"0%"}})})]}),t.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2 text-xs",children:"Top Destinations"}),t.jsx("div",{className:"space-y-2",children:ye.slice(0,3).map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:["International"===e.type?t.jsx(v,{size:12,className:"text-purple-500"}):t.jsx(C,{size:12,className:"text-blue-500"}),t.jsx("span",{className:"text-gray-700 text-xs",children:e.destination.split(",")[0]})]}),t.jsx("span",{className:"text-gray-900 font-medium text-xs",children:e.amount})]},s))})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 shadow-sm hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(c,{className:"w-4 h-4 text-amber-500"}),t.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:"Pending Claims"})]}),t.jsx("div",{className:"space-y-2",children:Ke.length>0?Ke.map((e,s)=>t.jsxs("div",{className:"p-2 rounded-xl border-l-4 transition-all hover:shadow-sm "+("approved"===e.status?"bg-green-50 border-green-500":"under_review"===e.status?"bg-blue-50 border-blue-500":"bg-yellow-50 border-yellow-500"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:e.type}),t.jsxs("span",{className:"text-xs font-bold text-gray-900",children:["MWK ",e.amount.toLocaleString()]})]}),t.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["Submitted: ",e.submittedDate]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"px-2 py-0.5 rounded-full font-medium text-xs "+("approved"===e.status?"bg-green-100 text-green-700":"under_review"===e.status?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"),children:e.status.replace("_"," ")}),t.jsxs("div",{className:"flex items-center gap-1 text-gray-500 text-xs",children:[t.jsx(T,{size:10}),t.jsxs("span",{children:[e.receipts," receipts"]})]})]})]},s)):t.jsxs("div",{className:"text-center py-6",children:[t.jsx(d,{size:24,className:"mx-auto text-green-500 mb-2"}),t.jsx("p",{className:"text-gray-600 text-xs",children:"No pending claims"}),t.jsx("p",{className:"text-gray-500 text-xs",children:"All expenses are up to date"})]})}),Ke.length>0&&t.jsx("button",{className:"w-full mt-3 px-3 py-1.5 bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors font-medium text-xs",children:"View All Claims"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[t.jsxs(V,{to:"/travel/requests",className:"group bg-white rounded-2xl p-3 border border-gray-200 hover:shadow-md transition-all hover:scale-105 relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-blue-500/10 rounded-full transform translate-x-6 -translate-y-6"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-xl group-hover:bg-blue-200 transition-colors shadow-sm",children:t.jsx(c,{size:18,className:"text-blue-600"})}),t.jsx(G,{size:16,className:"text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all"})]}),t.jsx("h3",{className:"text-sm font-bold text-gray-900 mb-1",children:"Manage Requests"}),t.jsx("p",{className:"text-gray-600 text-xs mb-2",children:"View and manage all your travel requests with enhanced tracking"}),t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsxs("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs font-medium",children:[ke.totalTrips," total"]}),t.jsxs("span",{className:"bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full text-xs font-medium",children:[q," pending"]})]})]})]}),t.jsxs("button",{onClick:()=>re(!0),className:"group bg-white rounded-2xl p-3 border border-gray-200 hover:shadow-md transition-all hover:scale-105 relative overflow-hidden text-left",children:[t.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-green-500/10 rounded-full transform translate-x-6 -translate-y-6"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-green-100 rounded-xl group-hover:bg-green-200 transition-colors shadow-sm",children:t.jsx(O,{size:18,className:"text-green-600"})}),t.jsx(G,{size:16,className:"text-gray-400 group-hover:text-green-600 group-hover:translate-x-1 transition-all"})]}),t.jsx("h3",{className:"text-sm font-bold text-gray-900 mb-1",children:"New Travel Request"}),t.jsx("p",{className:"text-gray-600 text-xs mb-2",children:"Submit new travel requests with budget validation"}),t.jsx("div",{className:"flex items-center space-x-1.5",children:t.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs font-medium",children:"Real-time budget check"})})]})]}),t.jsxs(V,{to:"/travel/expenses",className:"group bg-white rounded-2xl p-3 border border-gray-200 hover:shadow-md transition-all hover:scale-105 relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-purple-500/10 rounded-full transform translate-x-6 -translate-y-6"}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-purple-100 rounded-xl group-hover:bg-purple-200 transition-colors shadow-sm",children:t.jsx(T,{size:18,className:"text-purple-600"})}),t.jsx(G,{size:16,className:"text-gray-400 group-hover:text-purple-600 group-hover:translate-x-1 transition-all"})]}),t.jsx("h3",{className:"text-sm font-bold text-gray-900 mb-1",children:"Financial Reconciliation"}),t.jsx("p",{className:"text-gray-600 text-xs mb-2",children:"Track expenses and manage reimbursements"}),t.jsx("div",{className:"flex items-center space-x-1.5",children:t.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-0.5 rounded-full text-xs font-medium",children:["MWK ",Le.pendingReimbursements.toLocaleString()," pending"]})})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm",children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-100 bg-gradient-to-r from-blue-50/50 to-purple-50/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(P,{size:16,className:"text-blue-500"}),"Recent Travel Activity"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[ve&&t.jsx(b,{size:14,className:"animate-spin text-blue-500"}),t.jsxs("button",{onClick:es,className:"flex items-center gap-1 text-blue-600 hover:text-blue-800 text-xs font-medium bg-blue-50 px-2 py-1 rounded-xl hover:bg-blue-100 transition-colors",children:[t.jsx(n,{size:12}),"Refresh"]}),t.jsx("button",{className:"text-blue-600 hover:text-blue-800 text-xs font-medium",children:"View All"})]})]})}),ve?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx(b,{size:24,className:"animate-spin text-gray-400 mx-auto mb-2"}),t.jsx("span",{className:"text-gray-600 text-sm",children:"Loading travel activity..."})]})}):t.jsx("div",{className:"divide-y divide-gray-100",children:ye.slice(0,5).map(e=>t.jsx("div",{className:"p-3 hover:bg-gradient-to-r hover:from-blue-50/30 hover:to-purple-50/30 transition-all",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl shadow-sm",children:"International"===e.type?t.jsx(v,{size:16,className:"text-purple-600"}):t.jsx(C,{size:16,className:"text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:e.destination}),t.jsxs("div",{className:"flex items-center space-x-2 mt-0.5",children:[t.jsx("span",{className:"text-xs text-gray-500",children:e.date}),t.jsx("span",{className:"text-gray-300",children:"â€¢"}),t.jsx("span",{className:"text-xs text-gray-500",children:e.purpose}),t.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full font-medium "+("International"===e.type?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"),children:e.type})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-medium text-gray-900 text-sm",children:e.amount}),t.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${ns(e.status)}`,children:[ls(e.status),t.jsx("span",{className:"ml-1 capitalize",children:e.status})]})]}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx("button",{className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors",children:t.jsx(u,{size:14})}),t.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-xl transition-colors",children:t.jsx(f,{size:14})})]})]})]})},e.id))})]})]}),"analytics"===l&&t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 mb-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(_,{size:20,className:"text-blue-500"}),"Travel History"]}),t.jsx("p",{className:"text-gray-600 mt-0.5 text-xs",children:"Your travel patterns over the last 6 months"})]}),t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx("button",{className:"px-2 py-1 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition-colors text-xs font-medium",children:"Local"}),t.jsx("button",{className:"px-2 py-1 bg-purple-50 text-purple-600 rounded-xl hover:bg-purple-100 transition-colors text-xs font-medium",children:"International"})]})]}),t.jsx("div",{className:"h-64",children:t.jsx(Me,{width:"100%",height:"100%",children:t.jsxs(Fe,{data:[{name:"Jan",local:2,international:1,total:3},{name:"Feb",local:1,international:0,total:1},{name:"Mar",local:3,international:1,total:4},{name:"Apr",local:0,international:2,total:2},{name:"May",local:2,international:0,total:2},{name:"Jun",local:1,international:1,total:2}],children:[t.jsx($e,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),t.jsx(Ee,{dataKey:"name",stroke:"#6b7280",fontSize:12}),t.jsx(Be,{allowDecimals:!1,stroke:"#6b7280",fontSize:12}),t.jsx(Re,{contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),t.jsx(Pe,{dataKey:"local",name:"Local Trips",fill:"#3b82f6",radius:[4,4,0,0]}),t.jsx(Pe,{dataKey:"international",name:"International Trips",fill:"#8b5cf6",radius:[4,4,0,0]})]})})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 shadow-sm",children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(H,{size:16,className:"text-green-500"}),"Travel by Type"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),t.jsx("span",{className:"text-gray-700 font-medium text-xs",children:"Local Travel"})]}),t.jsxs("span",{className:"text-gray-900 font-bold text-xs",children:[ye.filter(e=>"Local"===e.type).length," trips (75%)"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-1000",style:{width:le?"75%":"0%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),t.jsx("span",{className:"text-gray-700 font-medium text-xs",children:"International Travel"})]}),t.jsxs("span",{className:"text-gray-900 font-bold text-xs",children:[ye.filter(e=>"International"===e.type).length," trips (25%)"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-purple-500 h-1.5 rounded-full transition-all duration-1000 delay-300",style:{width:le?"25%":"0%"}})})]}),t.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2 text-xs",children:"Top Destinations"}),t.jsx("div",{className:"space-y-2",children:ye.slice(0,3).map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-xl",children:[t.jsx("span",{className:"text-gray-700 text-xs",children:e.destination.split(",")[0]}),t.jsx("span",{className:"text-gray-900 font-medium text-xs",children:"1 trip"})]},s))})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 shadow-sm",children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(N,{size:16,className:"text-amber-500"}),"Expense Breakdown"]}),t.jsxs("div",{className:"space-y-4",children:[as.map((e,s)=>t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-gray-700 font-medium text-xs",children:e.name})]}),t.jsxs("span",{className:"text-gray-900 font-bold text-xs",children:["MWK ",e.value.toLocaleString()," (",e.percentage,"%)"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"h-1.5 rounded-full transition-all duration-1000",style:{backgroundColor:e.color,width:le?`${e.percentage}%`:"0%",transitionDelay:200*s+"ms"}})})]},s)),t.jsx("div",{className:"border-t border-gray-200 pt-3",children:t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl border border-green-200",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-green-900 font-bold text-sm",children:"Total Expenses"}),t.jsx("p",{className:"text-green-700 text-xs",children:"Current year"})]}),t.jsxs("span",{className:"text-lg font-bold text-green-900",children:["MWK ",me?me.totalSpent.toLocaleString():"180,000"]})]})})]})]})]})]}),"expenses"===l&&t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-3 border border-blue-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-blue-500 rounded-xl",children:t.jsx(I,{size:16,className:"text-white"})}),t.jsx(y,{size:12,className:"text-blue-600"})]}),t.jsxs("div",{className:"text-lg font-bold text-blue-900 mb-0.5",children:["MWK ",as[0]?.value.toLocaleString()||"81,000"]}),t.jsx("div",{className:"text-xs text-blue-600",children:"Transport Costs"}),t.jsxs("div",{className:"text-xs text-blue-500 mt-1",children:[as[0]?.percentage||45,"% of total"]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-3 border border-green-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-green-500 rounded-xl",children:t.jsx(Y,{size:16,className:"text-white"})}),t.jsx(y,{size:12,className:"text-green-600"})]}),t.jsxs("div",{className:"text-lg font-bold text-green-900 mb-0.5",children:["MWK ",as[1]?.value.toLocaleString()||"54,000"]}),t.jsx("div",{className:"text-xs text-green-600",children:"Accommodation"}),t.jsxs("div",{className:"text-xs text-green-500 mt-1",children:[as[1]?.percentage||30,"% of total"]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl p-3 border border-amber-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-amber-500 rounded-xl",children:t.jsx(Q,{size:16,className:"text-white"})}),t.jsx(j,{size:12,className:"text-amber-600"})]}),t.jsxs("div",{className:"text-lg font-bold text-amber-900 mb-0.5",children:["MWK ",as[2]?.value.toLocaleString()||"27,000"]}),t.jsx("div",{className:"text-xs text-amber-600",children:"Meals"}),t.jsxs("div",{className:"text-xs text-amber-500 mt-1",children:[as[2]?.percentage||15,"% of total"]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-2xl p-3 border border-red-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"p-2 bg-red-500 rounded-xl",children:t.jsx(X,{size:16,className:"text-white"})}),t.jsx(y,{size:12,className:"text-red-600"})]}),t.jsxs("div",{className:"text-lg font-bold text-red-900 mb-0.5",children:["MWK ",as[3]?.value.toLocaleString()||"18,000"]}),t.jsx("div",{className:"text-xs text-red-600",children:"Other"}),t.jsxs("div",{className:"text-xs text-red-500 mt-1",children:[as[3]?.percentage||10,"% of total"]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm",children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(c,{size:16,className:"text-purple-500"}),"Recent Expense Reports"]}),t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsxs("button",{className:"px-2 py-1 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition-colors text-xs font-medium flex items-center gap-1",children:[t.jsx(x,{size:12}),"Upload Receipt"]}),t.jsxs("button",{className:"px-2 py-1 bg-green-50 text-green-600 rounded-xl hover:bg-green-100 transition-colors text-xs font-medium flex items-center gap-1",children:[t.jsx(O,{size:12}),"New Report"]})]})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Report ID"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trip"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Submitted"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:ye.slice(0,3).map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsxs("span",{className:"text-xs font-medium text-gray-900",children:["EXP-",e.id.split("-")[2]]})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsxs("span",{className:"text-xs text-gray-900",children:[e.destination," - ",e.purpose]})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsx("span",{className:"text-xs font-medium text-gray-900",children:e.amount})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${ns(e.status)}`,children:[ls(e.status),t.jsx("span",{className:"ml-1",children:e.status})]})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsx("span",{className:"text-xs text-gray-500",children:e.date})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("button",{className:"p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors",children:t.jsx(u,{size:12})}),t.jsx("button",{className:"p-1 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-xl transition-colors",children:t.jsx(p,{size:12})}),t.jsx("button",{className:"p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors",children:t.jsx(Z,{size:12})})]})})]},s))})]})})]})]})]})}),te&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsxs("div",{className:"px-5 py-3 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl text-white",children:t.jsx(C,{size:18})}),"New Local Travel Request"]}),t.jsx("button",{onClick:()=>re(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]}),me&&t.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-2 border border-white/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(W,{size:14,className:"text-blue-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Total Budget"})]}),t.jsxs("span",{className:"font-bold text-gray-900 text-xs",children:["MWK ",me.totalBudget.toLocaleString()]})]})}),t.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-2 border border-white/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx($,{size:14,className:"text-emerald-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Remaining"})]}),t.jsxs("span",{className:"font-bold text-emerald-600 text-xs",children:["MWK ",me.remaining.toLocaleString()]})]})}),t.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-2 border border-white/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(_,{size:14,className:"text-purple-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Utilization"})]}),t.jsxs("span",{className:"font-bold text-purple-600 text-xs",children:[me.utilization.toFixed(1),"%"]})]})})]})]}),t.jsx("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:t.jsx(Qe,{type:"local",onCancel:()=>re(!1),onSubmitSuccess:()=>{re(!1),z("Local travel request submitted successfully!",{variant:"success"}),rs()}})})]})}),ae&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsxs("div",{className:"px-5 py-3 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl text-white",children:t.jsx(v,{size:18})}),"New International Travel Request"]}),t.jsx("button",{onClick:()=>ne(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]}),me&&t.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-2 border border-white/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(W,{size:14,className:"text-purple-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Total Budget"})]}),t.jsxs("span",{className:"font-bold text-gray-900 text-xs",children:["MWK ",me.totalBudget.toLocaleString()]})]})}),t.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-2 border border-white/50",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(J,{size:14,className:"text-amber-600"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Int'l Allowance"}),t.jsx("div",{className:"text-xs text-amber-600",children:"Higher daily rates apply"})]})]})}),t.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-2 border border-white/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(i,{size:14,className:"text-blue-600"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Processing"})]}),t.jsx("span",{className:"font-bold text-blue-600 text-xs",children:"5-7 days"})]})})]})]}),t.jsx("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:t.jsx(Qe,{type:"international",onCancel:()=>ne(!1),onSubmitSuccess:()=>{ne(!1),z("International travel request submitted successfully!",{variant:"success"}),rs()}})})]})}),m&&t.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>g(!1)})]})}const as=Object.freeze(Object.defineProperty({__proto__:null,default:rs},Symbol.toStringTag,{value:"Module"})),ns=({onCancel:a,onSubmitSuccess:n})=>{const l=s(),[i,c]=e.useState(0),[o,m]=e.useState({purpose:"",departureDate:"",returnDate:"",travelDays:0,country:"",fundingCodes:"",meansOfTravel:"company",currency:"",documents:[],location:"",travelType:"international",estimatedCost:"",numberOfTravelers:1,accommodationNeeded:!1,emergencyContact:"",specialRequirements:"",businessJustification:"",department:"",visaRequired:!1,passportExpiry:"",insuranceNeeded:!0}),[p,g]=e.useState({}),[b,y]=e.useState(!1),[j,f]=e.useState(!1),[D,k]=e.useState(!1),[S,A]=e.useState(""),[M,z]=e.useState(0),[T,$]=e.useState(!1),[E,B]=e.useState(!1),P=[{id:0,title:"Travel Details",description:"Basic travel information and destination",icon:t.jsx(v,{size:20})},{id:1,title:"Dates & Logistics",description:"Travel dates and transportation",icon:t.jsx(w,{size:20})},{id:2,title:"Budget & Documentation",description:"Funding, documents, and submission",icon:t.jsx(F,{size:20})}],L=[{name:"United Kingdom",code:"GB",currencies:["GBP","EUR"],visaRequired:!1},{name:"France",code:"FR",currencies:["EUR"],visaRequired:!1},{name:"Germany",code:"DE",currencies:["EUR"],visaRequired:!1},{name:"Japan",code:"JP",currencies:["JPY"],visaRequired:!0},{name:"Australia",code:"AU",currencies:["AUD"],visaRequired:!0},{name:"Canada",code:"CA",currencies:["CAD"],visaRequired:!1},{name:"Brazil",code:"BR",currencies:["BRL"],visaRequired:!0},{name:"India",code:"IN",currencies:["INR"],visaRequired:!0},{name:"South Africa",code:"ZA",currencies:["ZAR"],visaRequired:!1},{name:"China",code:"CN",currencies:["CNY"],visaRequired:!0},{name:"United States",code:"US",currencies:["USD"],visaRequired:!1},{name:"Singapore",code:"SG",currencies:["SGD"],visaRequired:!1},{name:"Thailand",code:"TH",currencies:["THB"],visaRequired:!1},{name:"Kenya",code:"KE",currencies:["KES"],visaRequired:!0}],U=[{value:"flight",label:"Flight",icon:t.jsx(I,{size:16}),description:"International air travel"},{value:"company",label:"Company Vehicle",icon:t.jsx(se,{size:16}),description:"Use company fleet"},{value:"personal",label:"Personal Vehicle",icon:t.jsx(C,{size:16}),description:"Use personal vehicle"},{value:"other",label:"Other Transport",icon:t.jsx(v,{size:16}),description:"Train, bus, or other"}];e.useEffect(()=>{if(B(!0),o.departureDate&&o.returnDate){const e=new Date(o.departureDate),s=new Date(o.returnDate),t=Ce(s,e)+1;m(e=>({...e,travelDays:t>0?t:0}))}const e=setTimeout(()=>{Object.values(o).some(e=>""!==e&&1!==e&&!1!==e&&0!==e&&0!==e.length)&&(localStorage.setItem("internationalTravelDraft",JSON.stringify(o)),$(!0),setTimeout(()=>$(!1),2e3))},3e3);return()=>clearTimeout(e)},[o]),e.useEffect(()=>{const e=localStorage.getItem("internationalTravelDraft");e&&m(JSON.parse(e))},[]),e.useEffect(()=>{let e=0;o.purpose&&e++,o.departureDate&&e++,o.returnDate&&e++,o.country&&e++,o.fundingCodes&&e++,o.currency&&e++,o.department&&e++,o.businessJustification&&e++,o.meansOfTravel&&e++,o.documents.length>0&&e++,z(e/10*100)},[o]);const _=e=>{const{name:s,value:t,type:r,checked:a}=e.target;m(e=>({...e,[s]:"checkbox"===r?a:t})),p[s]&&g(e=>({...e,[s]:""}))},K=e=>{const s={};if(0===e&&(o.purpose.trim()||(s.purpose="Purpose of travel is required"),o.country||(s.country="Destination country is required"),o.department||(s.department="Department is required"),o.purpose.length<20&&(s.purpose="Please provide detailed purpose (minimum 20 characters)")),1===e){if(o.departureDate||(s.departureDate="Departure date is required"),o.returnDate||(s.returnDate="Return date is required"),o.meansOfTravel||(s.meansOfTravel="Transportation method is required"),o.departureDate&&o.returnDate){const e=new Date(o.departureDate);e>=new Date(o.returnDate)&&(s.returnDate="Return date must be after departure date"),e<new Date&&(s.departureDate="Departure date cannot be in the past")}o.visaRequired&&!o.passportExpiry&&(s.passportExpiry="Passport expiry date is required for visa-required countries")}return 2===e&&(o.fundingCodes.trim()||(s.fundingCodes="Funding code is required"),o.businessJustification.trim()||(s.businessJustification="Business justification is required"),o.businessJustification.length<30&&(s.businessJustification="Please provide detailed justification (minimum 30 characters)"),0===o.documents.length&&(s.documents="At least one supporting document is required")),g(s),0===Object.keys(s).length},W=()=>L.find(e=>e.code===o.country),H=()=>o.travelDays;return t.jsxs("div",{className:"w-full max-w-6xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-500 to-blue-600 rounded-xl text-white",children:t.jsx(v,{size:24})}),"International Travel Request"]}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Submit a request for international business travel"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[T&&t.jsxs("div",{className:"flex items-center text-green-600 text-sm bg-green-50 px-3 py-2 rounded-lg border border-green-200 animate-pulse",children:[t.jsx(ee,{size:16,className:"mr-2"}),"Draft saved"]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-gray-500",children:"Progress"}),t.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2 mt-1",children:t.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-500",style:{width:`${M}%`}})}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[Math.round(M),"% complete"]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"font-semibold text-gray-900",children:"Progress"}),t.jsxs("span",{className:"text-sm text-gray-500",children:["Step ",i+1," of ",P.length]})]}),t.jsx("div",{className:"flex items-center justify-between",children:P.map((e,s)=>t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-xl border-2 transition-all duration-300 "+(s<=i?"bg-gradient-to-br from-purple-500 to-blue-600 border-transparent text-white shadow-lg":"bg-white border-gray-300 text-gray-400"),children:s<i?t.jsx(d,{size:20}):e.icon}),s<P.length-1&&t.jsx("div",{className:"w-16 h-1 mx-4 rounded-full transition-all duration-500 "+(s<i?"bg-gradient-to-r from-purple-500 to-blue-500":"bg-gray-300")})]},e.id))}),t.jsxs("div",{className:"mt-4 text-center",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:P[i].title}),t.jsx("p",{className:"text-sm text-gray-600",children:P[i].description})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-xl overflow-hidden",children:[t.jsx("div",{className:"px-8 py-6 border-b border-gray-100 bg-gradient-to-r from-gray-50/50 to-purple-50/30",children:t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[P[i].icon,P[i].title]})}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),K(2)){y(!0);try{const e=localStorage.getItem("token"),s=JSON.parse(localStorage.getItem("user"));if(!s||!s._id)throw new Error("User not logged in or user ID not found");const t={employee:s._id,purpose:o.purpose,departureDate:o.departureDate?new Date(o.departureDate).toISOString():null,returnDate:o.returnDate?new Date(o.returnDate).toISOString():null,location:o.location,fundingCodes:o.fundingCodes,meansOfTravel:o.meansOfTravel,travelType:"international",currency:o.currency,documents:o.documents,destination:o.country,estimatedCost:o.estimatedCost,numberOfTravelers:o.numberOfTravelers,accommodationNeeded:o.accommodationNeeded,emergencyContact:o.emergencyContact,specialRequirements:o.specialRequirements,businessJustification:o.businessJustification,department:o.department,visaRequired:o.visaRequired,passportExpiry:o.passportExpiry,insuranceNeeded:o.insuranceNeeded},r=await fetch("https://backend.nexusmwi.com/api/travel-requests",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(t)});if(r.ok){await r.json();f(!0),localStorage.removeItem("internationalTravelDraft"),n?setTimeout(()=>{n()},2e3):setTimeout(()=>{l("/travel/manage/dash")},2e3)}else{const e=await r.json();A(e.message||"Failed to submit travel request"),k(!0)}}catch(s){A(s.message||"An error occurred while submitting the travel request"),k(!0)}finally{y(!1)}}},className:"p-8",children:[0===i&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Purpose of Travel *"}),t.jsx("textarea",{name:"purpose",value:o.purpose,onChange:_,rows:4,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none "+(p.purpose?"border-red-300":"border-gray-300"),placeholder:"Provide detailed information about the purpose of your international travel, conferences, meetings, business objectives..."}),t.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[p.purpose?t.jsx("p",{className:"text-sm text-red-600",children:p.purpose}):t.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 20 characters required"}),t.jsxs("span",{className:"text-xs "+(o.purpose.length>=20?"text-green-600":"text-gray-400"),children:[o.purpose.length,"/20"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Destination Country *"}),t.jsxs("div",{className:"relative",children:[t.jsx(v,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsxs("select",{name:"country",value:o.country,onChange:e=>{const s=e.target.value,t=L.find(e=>e.code===s);m(e=>({...e,country:s,currency:t?.currencies[0]||"",visaRequired:t?.visaRequired||!1})),p.country&&g(e=>({...e,country:""}))},className:"w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(p.country?"border-red-300":"border-gray-300"),children:[t.jsx("option",{value:"",children:"Select Destination Country"}),L.map(e=>t.jsx("option",{value:e.code,children:e.name},e.code))]})]}),p.country&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.country}),o.country&&t.jsx("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-purple-900 font-medium",children:"Destination Info"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[o.visaRequired?t.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs",children:"Visa Required"}):t.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"No Visa Required"}),t.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:["Currency: ",o.currency]})]})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department *"}),t.jsxs("div",{className:"relative",children:[t.jsx(se,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsxs("select",{name:"department",value:o.department,onChange:_,className:"w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(p.department?"border-red-300":"border-gray-300"),children:[t.jsx("option",{value:"",children:"Select Department"}),["Information Technology","Human Resources","Finance & Accounting","Operations","Marketing & Communications","Research & Development","Customer Support"].map(e=>t.jsx("option",{value:e,children:e},e))]})]}),p.department&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.department})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Travelers"}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>m(e=>({...e,numberOfTravelers:Math.max(1,e.numberOfTravelers-1)})),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:t.jsx(te,{size:16})}),t.jsx("span",{className:"text-lg font-medium text-gray-900 px-4",children:o.numberOfTravelers}),t.jsx("button",{type:"button",onClick:()=>m(e=>({...e,numberOfTravelers:e.numberOfTravelers+1})),className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:t.jsx(O,{size:16})})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact"}),t.jsxs("div",{className:"relative",children:[t.jsx(re,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",name:"emergencyContact",value:o.emergencyContact,onChange:_,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Name and phone number"})]})]})]}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"flex items-center space-x-6",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"accommodationNeeded",name:"accommodationNeeded",checked:o.accommodationNeeded,onChange:_,className:"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"}),t.jsx("label",{htmlFor:"accommodationNeeded",className:"ml-3 text-sm font-medium text-gray-900",children:"Accommodation required"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"insuranceNeeded",name:"insuranceNeeded",checked:o.insuranceNeeded,onChange:_,className:"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"}),t.jsx("label",{htmlFor:"insuranceNeeded",className:"ml-3 text-sm font-medium text-gray-900",children:"Travel insurance needed"})]})]})})]}),1===i&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departure Date *"}),t.jsxs("div",{className:"relative",children:[t.jsx(w,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"date",name:"departureDate",value:o.departureDate,onChange:_,min:(new Date).toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(p.departureDate?"border-red-300":"border-gray-300")})]}),p.departureDate&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.departureDate})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Date *"}),t.jsxs("div",{className:"relative",children:[t.jsx(w,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"date",name:"returnDate",value:o.returnDate,onChange:_,min:o.departureDate||(new Date).toISOString().split("T")[0],className:"w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(p.returnDate?"border-red-300":"border-gray-300")})]}),p.returnDate&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.returnDate})]})]}),o.departureDate&&o.returnDate&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-blue-900 font-medium",children:"Trip Duration"}),t.jsxs("span",{className:"text-blue-700 font-bold",children:[H()," ",1===H()?"day":"days"]})]})}),o.visaRequired&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(J,{size:20,className:"text-amber-600 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium text-amber-900 mb-2",children:"Visa Required"}),t.jsxs("p",{className:"text-sm text-amber-800 mb-4",children:["Travel to ",W()?.name," requires a valid visa. Please ensure all visa documentation is complete."]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-amber-900 mb-2",children:"Passport Expiry Date *"}),t.jsx("input",{type:"date",name:"passportExpiry",value:o.passportExpiry,onChange:_,min:(new Date).toISOString().split("T")[0],className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 "+(p.passportExpiry?"border-red-300":"border-amber-300")}),p.passportExpiry&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.passportExpiry})]})]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Transportation Method *"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:U.map(e=>t.jsxs("button",{type:"button",onClick:()=>m(s=>({...s,meansOfTravel:e.value})),className:"p-4 border-2 rounded-xl transition-all duration-200 text-left "+(o.meansOfTravel===e.value?"border-purple-500 bg-purple-50 shadow-lg scale-105":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[t.jsx("div",{className:"p-2 rounded-lg "+(o.meansOfTravel===e.value?"bg-purple-100":"bg-gray-100"),children:e.icon}),o.meansOfTravel===e.value&&t.jsx(d,{size:20,className:"text-purple-600"})]}),t.jsx("h4",{className:"font-medium text-gray-900",children:e.label}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]},e.value))}),p.meansOfTravel&&t.jsx("p",{className:"mt-2 text-sm text-red-600",children:p.meansOfTravel})]}),o.currency&&t.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"font-bold text-purple-900 flex items-center gap-2",children:[t.jsx(N,{size:20}),"Currency Information"]}),t.jsx("span",{className:"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium",children:o.currency})]}),t.jsxs("p",{className:"text-purple-800 text-sm",children:["You'll be traveling to ",t.jsx("strong",{children:W()?.name})," where the local currency is ",t.jsx("strong",{children:o.currency}),". Corporate travel cards will be loaded with the appropriate currency amount."]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Requirements (Optional)"}),t.jsx("textarea",{name:"specialRequirements",value:o.specialRequirements,onChange:_,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Dietary restrictions, accessibility needs, special accommodations, etc."})]})]}),2===i&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Funding Code *"}),t.jsxs("div",{className:"relative",children:[t.jsx(F,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",name:"fundingCodes",value:o.fundingCodes,onChange:_,className:"w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(p.fundingCodes?"border-red-300":"border-gray-300"),placeholder:"e.g., INT-2024-001"})]}),p.fundingCodes&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.fundingCodes})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Cost (Optional)"}),t.jsxs("div",{className:"relative",children:[t.jsx(N,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"number",name:"estimatedCost",value:o.estimatedCost,onChange:_,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"0.00",min:"0",step:"0.01"})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Currency: ",o.currency||"USD"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Justification *"}),t.jsx("textarea",{name:"businessJustification",value:o.businessJustification,onChange:_,rows:4,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none "+(p.businessJustification?"border-red-300":"border-gray-300"),placeholder:"Explain the business necessity for this international travel, expected outcomes, ROI, and strategic importance..."}),t.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[p.businessJustification?t.jsx("p",{className:"text-sm text-red-600",children:p.businessJustification}):t.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 30 characters required"}),t.jsxs("span",{className:"text-xs "+(o.businessJustification.length>=30?"text-green-600":"text-gray-400"),children:[o.businessJustification.length,"/30"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Supporting Documents *"}),t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(q,{size:20,className:"text-amber-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-amber-900 mb-1",children:"Required Documents"}),t.jsxs("ul",{className:"text-sm text-amber-800 space-y-1",children:[t.jsx("li",{children:"â€¢ Pre-approval documents from department head"}),t.jsx("li",{children:"â€¢ Visa applications or approvals (if required)"}),t.jsx("li",{children:"â€¢ Flight booking confirmations or quotes"}),t.jsx("li",{children:"â€¢ Hotel/accommodation confirmations"}),t.jsx("li",{children:"â€¢ Conference registration or invitation letters"})]})]})]})}),t.jsxs("div",{className:"border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 "+(p.documents?"border-red-300 bg-red-50":"border-gray-300 hover:border-purple-400 hover:bg-purple-50/50"),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).filter(e=>["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)&&e.size<=10485760);m(e=>({...e,documents:[...e.documents,...s]}))},children:[t.jsx(x,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),t.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Upload Documents"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Drag and drop files here, or click to browse"}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"PDF, Word, JPEG, PNG up to 10MB each"}),t.jsx("input",{type:"file",multiple:!0,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:e=>{const s=Array.from(e.target.files).filter(e=>["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)&&e.size<=10485760);m(e=>({...e,documents:[...e.documents,...s]})),p.documents&&g(e=>({...e,documents:""}))},className:"hidden",id:"document-upload"}),t.jsxs("label",{htmlFor:"document-upload",className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200 cursor-pointer",children:[t.jsx(x,{size:16,className:"mr-2"}),"Select Files"]})]}),p.documents&&t.jsx("p",{className:"mt-2 text-sm text-red-600",children:p.documents})]}),o.documents.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Uploaded Documents (",o.documents.length,")"]}),t.jsx("div",{className:"space-y-3",children:o.documents.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:t.jsx(ae,{size:16,className:"text-purple-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 truncate max-w-xs",children:e.name}),t.jsxs("p",{className:"text-sm text-gray-500",children:[(e.size/1024/1024).toFixed(2)," MB â€¢ ",e.type.split("/")[1].toUpperCase()]})]})]}),t.jsx("button",{type:"button",onClick:()=>(e=>{m(s=>({...s,documents:s.documents.filter((s,t)=>t!==e)}))})(s),className:"p-2 text-red-600 hover:text-red-800 hover:bg-red-100 rounded-lg transition-colors duration-200",children:t.jsx(ne,{size:16})})]},s))})]}),t.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-6",children:[t.jsxs("h4",{className:"font-bold text-purple-900 mb-4 flex items-center gap-2",children:[t.jsx(u,{size:20}),"Travel Request Summary"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Destination:"}),t.jsx("p",{className:"text-purple-900",children:W()?.name||"Not specified"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Department:"}),t.jsx("p",{className:"text-purple-900",children:o.department||"Not specified"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Travel Dates:"}),t.jsx("p",{className:"text-purple-900",children:o.departureDate&&o.returnDate?`${new Date(o.departureDate).toLocaleDateString()} - ${new Date(o.returnDate).toLocaleDateString()}`:"Not specified"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Duration:"}),t.jsxs("p",{className:"text-purple-900",children:[H()," days"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Transportation:"}),t.jsx("p",{className:"text-purple-900",children:U.find(e=>e.value===o.meansOfTravel)?.label||"Not specified"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Currency:"}),t.jsx("p",{className:"text-purple-900",children:o.currency||"Not specified"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Visa Required:"}),t.jsx("p",{className:"text-purple-900",children:o.visaRequired?"Yes":"No"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-purple-700 font-medium",children:"Documents:"}),t.jsxs("p",{className:"text-purple-900",children:[o.documents.length," file(s) uploaded"]})]})]})]}),t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(le,{size:20,className:"text-amber-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-amber-900 mb-2",children:"International Travel Compliance"}),t.jsxs("ul",{className:"text-sm text-amber-800 space-y-1",children:[t.jsx("li",{children:"â€¢ All international travel requires pre-approval from department head and HR"}),t.jsx("li",{children:"â€¢ Valid passport required (must be valid for 6+ months from travel date)"}),t.jsx("li",{children:"â€¢ Visa documentation must be completed before travel"}),t.jsx("li",{children:"â€¢ Travel insurance is mandatory for all international trips"}),t.jsx("li",{children:"â€¢ Emergency contact information must be provided to security team"})]})]})]})})]}),t.jsxs("div",{className:"flex justify-between items-center pt-8 border-t border-gray-200 mt-8",children:[t.jsxs("button",{type:"button",onClick:0===i?a:()=>{c(e=>e-1)},className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors duration-200 font-medium flex items-center gap-2",children:[t.jsx(ie,{size:16}),0===i?"Cancel":"Previous"]}),t.jsx("div",{className:"flex space-x-3",children:i<P.length-1?t.jsxs("button",{type:"button",onClick:()=>{K(i)&&c(e=>e+1)},className:"px-8 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:["Continue",t.jsx(G,{size:16})]}):t.jsx("button",{type:"submit",disabled:b,className:"px-8 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl hover:from-green-700 hover:to-blue-700 disabled:opacity-50 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:b?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"}),"Submitting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{size:16}),"Submit Request"]})})})]})]})]}),j&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:t.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl",children:t.jsxs("div",{className:"p-8 text-center",children:[t.jsx("div",{className:"flex items-center justify-center w-20 h-20 mx-auto bg-gradient-to-br from-green-500 to-emerald-600 rounded-full mb-6 shadow-lg animate-pulse",children:t.jsx(d,{size:32,className:"text-white"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"International Travel Request Submitted! ðŸŒ"}),t.jsxs("div",{className:"text-gray-600 mb-6 space-y-2",children:[t.jsx("p",{children:"Your international travel request has been submitted successfully."}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[t.jsxs("div",{className:"text-lg font-bold text-green-900 font-mono",children:["ITR-",(new Date).getFullYear(),"-",String(Math.floor(1e3*Math.random())).padStart(3,"0")]}),t.jsx("div",{className:"text-sm text-green-700",children:"Reference Number"})]}),t.jsxs("div",{className:"text-sm space-y-1",children:[t.jsx("p",{children:"âœ… Department head and HR will review"}),t.jsx("p",{children:"âœ… Visa processing will be initiated if required"}),t.jsx("p",{children:"âœ… You'll receive detailed email updates"}),t.jsx("p",{children:"âœ… Travel documentation will be prepared"})]})]})]})})}),D&&t.jsx("div",{className:"fixed top-4 right-4 bg-red-50 border border-red-200 rounded-xl p-4 shadow-lg z-50 max-w-md",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(r,{size:20,className:"text-red-600 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium text-red-900",children:"Submission Failed"}),t.jsx("p",{className:"text-sm text-red-700 mt-1",children:S})]}),t.jsx("button",{onClick:()=>k(!1),className:"text-red-400 hover:text-red-600 transition-colors duration-200",children:t.jsx(h,{size:16})})]})}),t.jsx("div",{className:"fixed right-6 bottom-6 z-40",children:t.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-blue-600 rounded-2xl p-4 text-white shadow-2xl max-w-xs",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h4",{className:"font-bold flex items-center gap-2",children:[t.jsx(de,{size:16}),"International Travel Help"]}),t.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("button",{className:"w-full text-left p-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 flex items-center gap-2",children:[t.jsx(ce,{size:14}),"Visa Requirements Guide"]}),t.jsxs("button",{className:"w-full text-left p-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 flex items-center gap-2",children:[t.jsx(oe,{size:14}),"Travel Support Chat"]}),t.jsxs("button",{className:"w-full text-left p-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 flex items-center gap-2",children:[t.jsx(re,{size:14}),"Emergency Travel Line"]})]})]})})]})},ls=Object.freeze(Object.defineProperty({__proto__:null,default:ns},Symbol.toStringTag,{value:"Module"})),is=({isVisible:e,message:s="Processing..."})=>e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-2xl p-6 flex items-center gap-3",children:[t.jsx(b,{className:"animate-spin w-6 h-6 text-blue-500"}),t.jsx("span",{className:"font-medium",children:s})]})}):null,ds=({status:e})=>{const s=(e=>{switch(e){case"pending":default:return i;case"in-progress":return P;case"completed":return d}})(e);return t.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${(e=>{switch(e){case"pending":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"in-progress":return"bg-blue-50 text-blue-700 border-blue-200";case"completed":return"bg-green-50 text-green-700 border-green-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}})(e)}`,children:[t.jsx(s,{size:12,className:"mr-1"}),e.charAt(0).toUpperCase()+e.slice(1).replace("-"," ")]})},cs=({priority:e})=>t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${{high:"bg-red-50 text-red-700 border-red-200",medium:"bg-amber-50 text-amber-700 border-amber-200",low:"bg-green-50 text-green-700 border-green-200"}[e]||"bg-gray-50 text-gray-700 border-gray-200"}`,children:e}),os=({request:e,isSelected:s,onClick:r})=>t.jsxs("div",{onClick:r,className:"bg-white rounded-2xl border p-2 cursor-pointer transition-all hover:shadow-sm "+(s?"border-blue-500 shadow-sm":"border-gray-200"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:e.employee.lastName}),t.jsx("p",{className:"text-xs text-gray-500",children:e.employee.email})]}),t.jsx(cs,{priority:e.priority})]}),t.jsxs("div",{className:"space-y-1 mb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700",children:[t.jsx(v,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[e.city,", ",e.country]})]}),t.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700",children:[t.jsx(xe,{size:12,className:"text-gray-400"}),t.jsxs("span",{className:"text-xs",children:[we(e.departureDate,"MMM d")," - ",we(e.returnDate,"MMM d, yyyy")]})]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex gap-1",children:[e.requiresDriver&&t.jsx("div",{className:"p-1 bg-blue-50 rounded-lg",children:t.jsx(pe,{size:12,className:"text-blue-600"})}),e.requiresFlight&&t.jsx("div",{className:"p-1 bg-purple-50 rounded-lg",children:t.jsx(I,{size:12,className:"text-purple-600"})})]}),t.jsx("span",{className:"text-xs text-gray-500",children:we(e.submittedAt,"MMM d, yyyy")})]})]});function xs(){const n=s(),[l,o]=e.useState("pending"),[x,m]=e.useState(null),[u,y]=e.useState(null),[j,f]=e.useState(""),[N,v]=e.useState("all"),[w,k]=e.useState(!1),[S,A]=e.useState(!1),[M,z]=e.useState(!1),[T,F]=e.useState(!1),[$,E]=e.useState(!1),[B,P]=e.useState(!1),[L,U]=e.useState(!1),[O,_]=e.useState(""),[K,W]=e.useState("success"),[J,H]=e.useState(!0),[V,G]=e.useState([]),[Y,Q]=e.useState([]),[Z,ee]=e.useState({airline:"",flightNumber:"",departureTime:"",arrivalTime:"",ticketClass:"economy",price:"",notes:""}),[te,ae]=e.useState({recipients:["employee"],subject:"",message:"",includeItinerary:!0}),ne="https://backend.nexusmwi.com",le=e=>e.map(e=>{const s=e=>{if(!e)return new Date;const s=new Date(e);return isNaN(s.getTime())?new Date:s},t=e.employee||{_id:"",firstName:"",lastName:"",email:"",name:"Unknown Employee"};return{id:e._id||e.id||"",employeeName:t.firstName?`${t.firstName} ${t.lastName}`:t.name||"Unknown",fleetNotification:e.fleetNotification||{sent:!1,sentAt:null,recipients:[],subject:"",message:"",includeItinerary:!1,sentBy:null},employee:t,employeeId:t._id,department:e.fundingCodes||"Not specified",email:t.email||"",purpose:e.purpose||"",location:e.location||"Not specified",country:e.location||"Not specified",city:e.location||"Not specified",departureDate:s(e.departureDate),returnDate:s(e.returnDate),status:e.fleetNotification?.sent?"completed":e.assignedDriver?"in-progress":"pending",financialStatus:e.financeStatus||"pending",perDiemAmount:e.payment?.perDiemAmount||("MWK"===e.currency?1e5:1e3),currency:e.currency||"USD",cardDetails:{lastFour:"1234",type:"VISA",holder:t.name||"Unknown"},documents:e.documents||[],approvedBy:e.finalApprover||"System",approvedAt:s(e.finalApprovalDate||e.updatedAt),priority:"medium",travelType:e.travelType||"local",requiresDriver:"company"===e.meansOfTravel,requiresFlight:"international"===e.travelType,submittedAt:s(e.createdAt),supervisorApproval:e.supervisorApproval,finalApproval:e.finalApproval,assignedDriver:e.assignedDriver||null}}),ie=e=>{if(!x)return{subject:"",message:""};const s=Math.ceil((new Date(x.returnDate)-new Date(x.departureDate))/864e5)+1,t=we(new Date(x.departureDate),"EEEE, MMMM d, yyyy"),r=we(new Date(x.returnDate),"EEEE, MMMM d, yyyy"),a=`${x.employee?.firstName||""} ${x.employee?.lastName||""}`.trim(),n=x.location||"Unknown Location";switch(e){case"employee":return{subject:`Travel Arrangements Confirmed - ${n}`,message:`\n          <div style="font-family: Arial, sans-serif; color:#333; line-height:1.6;">\n            <p style="font-size:16px;">Dear ${x.employee?.firstName||"Employee"},</p>\n            <p>Your travel arrangements for your trip to <strong>${n}</strong> have been finalized. Here are the details:</p>\n\n            <h3 style="color:#2E86C1;">ðŸ—“ï¸ Travel Period</h3>\n            <ul>\n              <li><strong>Departure:</strong> ${t}</li>\n              <li><strong>Return:</strong> ${r}</li>\n              <li><strong>Duration:</strong> ${s} days</li>\n            </ul>\n\n            <h3 style="color:#2E86C1;">ðŸ“ Destination</h3>\n            <ul>\n              <li><strong>Location:</strong> ${n}</li>\n              <li><strong>Purpose:</strong> ${x.purpose}</li>\n            </ul>\n\n            ${x.assignedDriver?`\n                <h3 style="color:#2E86C1;">ðŸš— Ground Transportation</h3>\n                <ul>\n                  <li><strong>Driver Assigned:</strong> ${x.assignedDriver.firstName} ${x.assignedDriver.lastName}</li>\n                  <li><strong>Contact:</strong> ${x.assignedDriver.phoneNumber||"Contact details will be provided"}</li>\n                </ul>\n              `:""}\n\n            <h3 style="color:#2E86C1;">ðŸ“„ Important Reminders</h3>\n            <ul>\n              <li>Please carry all required travel documents</li>\n              <li>Confirm your accommodation arrangements</li>\n              <li>Review company travel policies</li>\n              <li>Keep all receipts for expense reporting</li>\n            </ul>\n\n            <p>If you have any questions or need assistance, please contact the travel department immediately.</p>\n\n            <p style="margin-top:20px;">Safe travels!</p>\n            <p><strong>Best regards,<br/>NexusMWI Travel Department</strong></p>\n          </div>\n        `};case"driver":return{subject:`New Assignment - Transport Service for ${a}`,message:`\n          <div style="font-family: Arial, sans-serif; color:#333; line-height:1.6;">\n            <p style="font-size:16px;">Dear ${x.assignedDriver?.firstName||u?.firstName||"Driver"},</p>\n            <p>You have been assigned to provide transportation services for the following travel request:</p>\n\n            <h3 style="color:#2E86C1;">ðŸ‘¤ Passenger Details</h3>\n            <ul>\n              <li><strong>Name:</strong> ${a}</li>\n              <li><strong>Contact:</strong> ${x.employee?.phoneNumber||x.employee?.email}</li>\n            </ul>\n\n            <h3 style="color:#2E86C1;">ðŸ—“ï¸ Travel Schedule</h3>\n            <ul>\n              <li><strong>Trip Start:</strong> ${t}</li>\n              <li><strong>Trip End:</strong> ${r}</li>\n              <li><strong>Duration:</strong> ${s} days</li>\n              <li><strong>Destination:</strong> ${n}</li>\n            </ul>\n\n            <h3 style="color:#2E86C1;">ðŸ“ Service Requirements</h3>\n            <ul>\n              <li><strong>Purpose:</strong> ${x.purpose}</li>\n              <li><strong>Type:</strong> ${"international"===x.travelType?"International Travel":"Local Travel"}</li>\n            </ul>\n\n            <h3 style="color:#2E86C1;">ðŸ“‹ Next Steps</h3>\n            <ul>\n              <li>Contact the passenger to arrange pickup details</li>\n              <li>Confirm vehicle readiness and fuel</li>\n              <li>Plan optimal routes to destinations</li>\n              <li>Maintain professional service standards</li>\n            </ul>\n\n            <h3 style="color:#C0392B;">âš ï¸ Important</h3>\n            <ul>\n              <li>Arrive 15 minutes early for all pickups</li>\n              <li>Keep vehicle clean and presentable</li>\n              <li>Follow all company safety protocols</li>\n              <li>Report any issues immediately to fleet management</li>\n            </ul>\n\n            <p>Please confirm receipt of this assignment and contact the passenger within 24 hours to coordinate arrangements.</p>\n\n            <p><strong>Best regards,<br/>Fleet Management Team</strong></p>\n          </div>\n        `};case"manager":return{subject:`Travel Arrangements Summary - ${a}`,message:`\n          <div style="font-family: Arial, sans-serif; color:#333; line-height:1.6;">\n            <p style="font-size:16px;">Dear Manager,</p>\n            <p>This is to inform you that travel arrangements have been completed for ${a}'s business trip.</p>\n\n            <h3 style="color:#2E86C1;">ðŸ“Š Travel Summary</h3>\n            <ul>\n              <li><strong>Employee:</strong> ${a}</li>\n              <li><strong>Destination:</strong> ${n}</li>\n              <li><strong>Purpose:</strong> ${x.purpose}</li>\n              <li><strong>Travel Period:</strong> ${t} to ${r} (${s} days)</li>\n            </ul>\n\n            <h3 style="color:#2E86C1;">ðŸ’¼ Arrangements Made</h3>\n            <ul>\n              <li>${x.assignedDriver?`Driver assigned: ${x.assignedDriver.firstName} ${x.assignedDriver.lastName}`:"No driver assigned"}</li>\n              <li>All notifications sent to relevant parties</li>\n              <li>Travel request ID: ${x._id}</li>\n            </ul>\n\n            <p>The employee has been notified of all arrangements and is ready for travel.</p>\n\n            <p><strong>Best regards,<br/>NexusMWI Travel Department</strong></p>\n          </div>\n        `};default:return{subject:"",message:""}}},de=async()=>{H(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${ne}/api/travel-requests/finance/pending`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch pending travel requests");const t=await s.json(),r=le(t);Q(r)}catch(e){_("Failed to fetch pending travel requests"),W("error"),U(!0),setTimeout(()=>{U(!1)},3e3)}finally{H(!1)}};e.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${ne}/api/auth/drivers`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch drivers");const t=await s.json();G(t)}catch(e){_("Failed to fetch drivers"),W("error"),U(!0)}})()},[ne]),e.useEffect(()=>{de()},[ne]),e.useEffect(()=>{(async()=>{if(M&&x?.id)try{const e=localStorage.getItem("token"),s=await fetch(`${ne}/api/travel-requests/${x.id}`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch updated travel request");const t=await s.json(),r=le([t])[0];m(r)}catch(e){_("Failed to refresh request data"),W("error"),U(!0)}})()},[M,x?.id,ne]),e.useEffect(()=>{if(M&&x){const e=te.recipients.includes("employee")?"employee":te.recipients.includes("driver")?"driver":"manager",s=ie(e);ae(e=>({...e,subject:s.subject,message:s.message}))}},[M,x,te.recipients]);const ce=Y.filter(e=>{const s=e.employeeName||"",t=e.id||"",r=e.country||"",a=e.city||"",n=s.toLowerCase().includes(j.toLowerCase())||t.toLowerCase().includes(j.toLowerCase())||r.toLowerCase().includes(j.toLowerCase())||a.toLowerCase().includes(j.toLowerCase()),l="all"===N||e.status===N;return n&&l});e.useEffect(()=>{if(!x&&ce.length>0){const e=ce.find(e=>"pending"===e.status);m(e||ce[0])}},[ce,x]);const oe=e=>{m(e),k(!1),A(!1),z(!1)};return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(is,{isVisible:J,message:"Loading fleet management data..."}),t.jsx("main",{className:"p-4 space-y-4 max-w-7xl mx-auto",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsx(a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("input",{type:"text",placeholder:"Search requests...",value:j,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white"})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>o("pending"),className:"px-3 py-1.5 rounded-xl font-medium transition-colors text-sm "+("pending"===l?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Pending"}),t.jsx("button",{onClick:()=>o("completed"),className:"px-3 py-1.5 rounded-xl font-medium transition-colors text-sm "+("completed"===l?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Completed"})]})]}),t.jsxs("div",{className:"space-y-2 max-h-[calc(100vh-400px)] overflow-y-auto",children:["pending"===l&&t.jsx(t.Fragment,{children:(()=>{const e=ce.filter(e=>(!e.fleetNotification||!e.fleetNotification.sent)&&e.requiresDriver);return 0===e.length?t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-8 text-center",children:[t.jsx(c,{size:32,className:"mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No pending driver requests found"}),t.jsx("p",{className:"text-gray-600",children:ce.filter(e=>!e.fleetNotification||!e.fleetNotification.sent).length>0?"There are pending requests that don't require drivers":"All travel requests have been processed"})]}):e.map(e=>t.jsx(os,{request:e,isSelected:x?.id===e.id,onClick:()=>oe(e)},e.id))})()}),"completed"===l&&t.jsx(t.Fragment,{children:(()=>{const e=ce.filter(e=>e.fleetNotification&&e.fleetNotification.sent);return 0===e.length?t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-8 text-center",children:[t.jsx(d,{size:32,className:"mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No completed requests found"}),t.jsx("p",{className:"text-gray-600",children:"Completed requests will appear here"})]}):e.map(e=>t.jsx(os,{request:e,isSelected:x?.id===e.id,onClick:()=>oe(e)},e.id))})()})]})]}),t.jsx("div",{className:"space-y-4",children:x?t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[t.jsx("div",{className:"bg-gray-50 border-b border-gray-100 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-xl",children:t.jsx(c,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:x.employee.lastName}),t.jsx(ds,{status:x.status})]}),t.jsxs("p",{className:"text-gray-600 text-sm",children:[x.employee.email," â€¢ ",x.department]})]})]}),t.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl",children:t.jsx(D,{size:18})})]})}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Purpose of Travel"}),t.jsx("p",{className:"text-gray-900 text-sm",children:x.purpose||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Destination"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(C,{className:"text-blue-500",size:16}),t.jsxs("span",{className:"text-gray-900 text-sm",children:[x.city,", ",x.country]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Travel Period"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(xe,{className:"text-blue-500",size:16}),t.jsxs("span",{className:"text-gray-900 text-sm",children:[we(x.departureDate,"MMM d, yyyy")," -"," ",we(x.returnDate,"MMM d, yyyy")]}),t.jsxs("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded-full text-xs font-medium ml-2",children:[Math.ceil((x.returnDate-x.departureDate)/864e5)+1," ","days"]})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Requirements"}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:x.requiresDriver,disabled:!0,className:"rounded border-gray-300 text-blue-600"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Driver Required"})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:x.requiresFlight,disabled:!0,className:"rounded border-gray-300 text-blue-600"}),t.jsx("span",{className:"text-xs text-gray-700",children:"Flight Booking Required"})]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Documents"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:x.documents.length>0?x.documents.map((e,s)=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-50 text-gray-700 rounded text-xs",children:[t.jsx(c,{size:10}),e]},s)):t.jsx("span",{className:"text-xs text-gray-500",children:"No documents"})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Submitted"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"text-blue-500",size:16}),t.jsx("span",{className:"text-gray-900 text-sm",children:we(x.submittedAt,"MMM d, yyyy")})]})]})]})]}),"pending"===x.status&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(r,{className:"w-4 h-4 text-amber-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-amber-800 text-sm",children:"Action Required"}),t.jsx("p",{className:"text-amber-700 text-xs",children:"This request requires your attention. Please assign a driver (if needed) and initiate the flight booking process."})]})]})}),"in-progress"===x.status&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(q,{className:"w-4 h-4 text-blue-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-blue-800 text-sm",children:"In Progress"}),t.jsx("p",{className:"text-blue-700 text-xs",children:"This request is being processed. Complete the remaining steps to finalize the travel arrangements."})]})]})}),"completed"===x.status&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(d,{className:"w-4 h-4 text-green-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-green-800 text-sm",children:"Completed"}),t.jsx("p",{className:"text-green-700 text-xs",children:"All travel arrangements have been completed for this request."})]})]})})]}),t.jsxs("div",{className:"bg-gray-50 border-t border-gray-100 p-4 flex justify-between items-center",children:["pending"===x.status&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n("/travel-dashboard"),className:"px-3 py-1.5 text-gray-700 border border-gray-300 rounded-xl hover:bg-gray-50 text-sm",children:"Back to Dashboard"}),t.jsxs("div",{className:"flex gap-2",children:[x.requiresDriver&&t.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 text-blue-700 border border-blue-200 rounded-xl hover:bg-blue-100 text-sm",children:[t.jsx(me,{size:14}),"Assign Driver"]}),t.jsx("button",{onClick:async()=>{try{F(!0);const e=localStorage.getItem("token");if(!(await fetch(`${ne}/api/travel-requests/${x.id}/process`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({status:"in-progress"})})).ok)throw new Error("Failed to process request");const s={...x,status:"in-progress"};m(s),Q(e=>e.map(e=>e.id===x.id?s:e)),s.requiresFlight?A(!0):z(!0),_("Request processing started"),W("success"),U(!0)}catch(e){_("Failed to process request"),W("error"),U(!0)}finally{F(!1)}},disabled:T,className:"flex items-center gap-1.5 px-4 py-1.5 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 text-sm",children:T?t.jsxs(t.Fragment,{children:[t.jsx(b,{className:"animate-spin w-4 h-4"}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{size:14}),"Process Request"]})})]})]}),"in-progress"===x.status&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n("/travel-dashboard"),className:"px-3 py-1.5 text-gray-700 border border-gray-300 rounded-xl hover:bg-gray-50 text-sm",children:"Back to Dashboard"}),t.jsxs("div",{className:"flex gap-2",children:[x.requiresFlight&&!S&&!M&&t.jsxs("button",{onClick:()=>A(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-purple-50 text-purple-700 border border-purple-200 rounded-xl hover:bg-purple-100 text-sm",children:[t.jsx(I,{size:14}),"Book Flight"]}),!S&&!M&&t.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-1.5 px-4 py-1.5 bg-green-500 text-white rounded-xl hover:bg-green-600 text-sm",children:[t.jsx(R,{size:14}),"Send Notifications"]})]})]}),"completed"===x.status&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>n("/travel-dashboard"),className:"px-3 py-1.5 text-gray-700 border border-gray-300 rounded-xl hover:bg-gray-50 text-sm",children:"Back to Dashboard"}),t.jsxs("button",{onClick:()=>{if(x)try{const e=new ke("p","mm","a4"),s=[41,128,185],t=[44,62,80],r=[240,240,240];let a=20;e.setFillColor(...s),e.rect(0,0,210,25,"F"),e.setFontSize(18),e.setTextColor(255,255,255),e.text("Travel Itinerary",15,15),e.setFontSize(11),e.text(`Request ID: ${x.id}`,195,15,{align:"right"}),a=35;const n=(n,l)=>{e.setFillColor(...r),e.rect(15,a,180,8,"F"),e.setFontSize(12),e.setTextColor(...s),e.text(n,20,a+6),a+=14,l.forEach(([s,r])=>{r||(r="N/A"),e.setFontSize(10),e.setTextColor(...t),e.text(s,20,a),e.setFontSize(11),e.setTextColor(0),e.text(String(r),70,a),a+=8}),a+=6};n("Passenger Information",[["Name of Traveller:",`Mr. ${x.employee?.lastName||""}`],["Email:",x.email],["Department:",x.department]]),n("Departure Information",[["Purpose:",x.purpose],["Flight No.:",Z.flightNumber],["Airline:",Z.airline],["Class:",Z.ticketClass],["Departure Date:",x.departureDate?we(new Date(x.departureDate),"EEE, MMM d, yyyy HH:mm"):"N/A"],["Arrival Date:",x.returnDate?we(new Date(x.returnDate),"EEE, MMM d, yyyy HH:mm"):"N/A"]]),x.requiresFlight&&n("Return Flight",[["Airline:",Z.airline],["Class:",Z.ticketClass],["Return Date:",x.returnDate?we(new Date(x.returnDate),"EEE, MMM d, yyyy HH:mm"):"N/A"]]),u&&n("Ground Transport",[["Assigned Driver:",u.name||`${u.firstName||""} ${u.lastName||""}`],["Driver Contact:",u.phone||"N/A"]]),e.setDrawColor(200),e.line(15,275,195,275),e.setFontSize(9),e.setTextColor(100),e.text("Generated by NexusMWI Travel System",20,285),e.text(we(new Date,"MMM d, yyyy h:mm a"),195,285,{align:"right"}),e.save(`itinerary-${x.id}.pdf`)}catch(e){_("Failed to generate itinerary PDF"),W("error"),U(!0)}},className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-50 text-green-700 border border-green-200 rounded-xl hover:bg-green-100 text-sm",children:[t.jsx(p,{size:14}),"Download Itinerary"]})]})]})]}):t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-12 text-center",children:[t.jsx(c,{size:40,className:"mx-auto text-gray-400 mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Request Selected"}),t.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Select a travel request from the list to view details and manage fleet coordination"})]})})]})}),w&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]",children:t.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(X,{size:18,className:"text-blue-500"}),"Assign Driver"]}),t.jsx("button",{onClick:()=>k(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]})}),t.jsxs("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:[t.jsxs("p",{className:"text-gray-600 mb-4 text-xs",children:["Select a driver for ",x?.employeeName,"'s trip to ",x?.city]}),t.jsx("div",{className:"mb-3",children:t.jsxs("div",{className:"relative",children:[t.jsx(a,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search drivers by name, location, or language...",className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:0===V.length?t.jsx("div",{className:"text-center py-6",children:t.jsx("p",{className:"text-gray-500 text-sm",children:"No drivers available"})}):V.map(e=>t.jsx("div",{onClick:()=>(e=>{y(e)})(e),className:"p-3 border rounded-2xl cursor-pointer transition-colors "+(u?._id===e._id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:bg-gray-50"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 font-semibold text-xs",children:e.firstName?.charAt(0)||"D"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:e.firstName}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[t.jsx(C,{size:12}),t.jsx("span",{children:e.location?.coordinates?.city||"Location not specified"})]}),e.phone&&t.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[t.jsx(re,{size:12}),t.jsx("span",{children:e.phone})]})]})]}),t.jsxs("div",{className:"text-right",children:[e.rating&&t.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[t.jsx(ue,{size:12,className:"text-yellow-500 fill-current"}),t.jsx("span",{className:"font-semibold text-xs",children:e.rating})]}),e.experience&&t.jsx("p",{className:"text-xs text-gray-600",children:e.experience})]})]})},e._id))}),t.jsxs("div",{className:"flex justify-between mt-4 pt-4 border-t border-gray-100",children:[t.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Cancel"}),t.jsx("button",{onClick:async()=>{try{F(!0);const e=localStorage.getItem("token"),s=await fetch(`${ne}/api/travel-requests/${x.id}/assign-driver`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({driverId:u._id})}),t=await s.json();if(!s.ok)return _(t.message?`${t.message}${t.currentDriver?` (Current driver: ${t.currentDriver})`:""}`:"Failed to assign driver"),W("error"),void U(!0);const r=le([t.travelRequest])[0];m(r),Q(e=>e.map(e=>e.id===x.id?r:e)),k(!1),r.requiresFlight?A(!0):z(!0),_(t.message||"Driver assigned successfully"),W("success"),U(!0)}catch(e){_(e.message||"Failed to assign driver"),W("error"),U(!0)}finally{F(!1)}},disabled:!u||T,className:"flex items-center gap-1 px-4 py-2 text-xs bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:T?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Assigning..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{size:14}),"Confirm Driver"]})})]})]})]})}),S&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]",children:t.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(I,{size:18,className:"text-blue-500"}),"Air Ticket Booking"]}),t.jsx("button",{onClick:()=>A(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]})}),t.jsxs("div",{className:"p-5 max-h-[75vh] overflow-y-auto",children:[t.jsxs("p",{className:"text-gray-600 mb-4 text-xs",children:["Book flight for ",x?.employee.lastName,"'s trip to ",x?.city,","," ",x?.country]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Airline"}),t.jsxs("select",{value:Z.airline,onChange:e=>ee({...Z,airline:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"",disabled:!0,children:"Select Airline"}),t.jsx("option",{value:"japan-airlines",children:"Japan Airlines"}),t.jsx("option",{value:"ana",children:"All Nippon Airways"}),t.jsx("option",{value:"delta",children:"Delta Airlines"}),t.jsx("option",{value:"united",children:"United Airlines"}),t.jsx("option",{value:"emirates",children:"Emirates"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Flight Number"}),t.jsx("input",{type:"text",placeholder:"e.g., JL123",value:Z.flightNumber,onChange:e=>ee({...Z,flightNumber:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Ticket Class"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:["economy","business","first"].map(e=>t.jsxs("label",{className:"relative flex items-center justify-center p-2 border rounded-2xl cursor-pointer transition-colors text-xs "+(Z.ticketClass===e?"border-purple-500 bg-purple-50 font-medium":"border-gray-300 hover:border-purple-300"),children:[t.jsx("input",{type:"radio",name:"ticketClass",value:e,checked:Z.ticketClass===e,onChange:e=>ee({...Z,ticketClass:e.target.value}),className:"sr-only"}),t.jsx("span",{className:"capitalize",children:e})]},e))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Departure Time"}),t.jsx("input",{type:"datetime-local",value:Z.departureTime,onChange:e=>ee({...Z,departureTime:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Arrival Time"}),t.jsx("input",{type:"datetime-local",value:Z.arrivalTime,onChange:e=>ee({...Z,arrivalTime:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Ticket Price"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"$"}),t.jsx("input",{type:"number",placeholder:"0.00",value:Z.price,onChange:e=>ee({...Z,price:e.target.value}),className:"w-full pl-8 pr-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Additional Notes"}),t.jsx("textarea",{placeholder:"Any special requirements or notes for the booking",rows:2,value:Z.notes,onChange:e=>ee({...Z,notes:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500 resize-none"})]})]}),t.jsxs("div",{className:"flex justify-between mt-4 pt-4 border-t border-gray-100",children:[t.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Cancel"}),t.jsx("button",{onClick:async()=>{try{E(!0);const e=localStorage.getItem("token"),s=await fetch(`${ne}/api/travel-requests/${x.id}/book-flight`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(Z)}),t=await s.json();if(!s.ok)throw new Error(t.message||"Failed to book flight");A(!1),z(!0),ae({...te,subject:`Flight Booking Confirmation - ${t.flightBooking.airline} ${t.flightBooking.flightNumber}`,message:`Dear ${x.employeeName},\n\nYour flight to ${x.location} has been successfully booked.\n\nFlight Details:\n- Airline: ${t.flightBooking.airline}\n- Flight: ${t.flightBooking.flightNumber}\n- Class: ${t.flightBooking.ticketClass}\n- Departure: ${we(new Date(t.flightBooking.departureTime),"MMM d, yyyy 'at' h:mm a")}\n${t.flightBooking.arrivalTime?`- Arrival: ${we(new Date(t.flightBooking.arrivalTime),"MMM d, yyyy 'at' h:mm a")}\n`:""}- Confirmation: ${t.flightBooking.confirmationNumber}\n\n${u?`A driver (${u.firstName} ${u.lastName}) has been assigned to assist you during your trip.`:"No driver has been assigned for this trip."}\n\nPlease contact the travel department if you have any questions.`}),_("Flight booked successfully"),W("success"),U(!0),de()}catch(e){_(e.message||"Failed to book flight"),W("error"),U(!0)}finally{E(!1)}},disabled:$||!Z.airline||!Z.flightNumber||!Z.departureTime,className:"flex items-center gap-1 px-4 py-2 text-xs bg-purple-500 text-white rounded-2xl hover:bg-purple-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:$?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Booking..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{size:14}),"Confirm Booking"]})})]})]})]})}),M&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-[1000]",children:t.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(R,{size:18,className:"text-blue-500"}),"Send Travel Notifications"]}),t.jsx("button",{onClick:()=>z(!1),className:"p-1.5 hover:bg-gray-100 rounded-2xl transition-colors",children:t.jsx(h,{size:18})})]})}),t.jsxs("div",{className:"p-5 space-y-4 max-h-[75vh] overflow-y-auto",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(q,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-blue-900 text-xs",children:"Automated Notifications"}),t.jsx("p",{className:"text-blue-700 text-xs mt-1",children:"Personalized messages will be automatically generated for each recipient based on their role and the travel details."})]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Select Recipients"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-2xl cursor-pointer transition-colors "+(te.recipients.includes("employee")?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-300"),children:[t.jsx("input",{type:"checkbox",checked:te.recipients.includes("employee"),onChange:e=>{e.target.checked?ae({...te,recipients:[...te.recipients,"employee"]}):ae({...te,recipients:te.recipients.filter(e=>"employee"!==e)})},className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(me,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"font-medium text-gray-900 text-xs",children:"Employee"})]}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[x?.employee.lastName," (",x?.employee.email,")"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Will receive: Travel itinerary, flight details, driver contact, and travel reminders"})]})]}),x?.assignedDriver&&t.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-2xl cursor-pointer transition-colors "+(te.recipients.includes("driver")?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-300"),children:[t.jsx("input",{type:"checkbox",checked:te.recipients.includes("driver"),onChange:e=>{e.target.checked?ae({...te,recipients:[...te.recipients,"driver"]}):ae({...te,recipients:te.recipients.filter(e=>"driver"!==e)})},className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(X,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"font-medium text-gray-900 text-xs",children:"Assigned Driver"})]}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[x.assignedDriver.lastName||u?.lastName||u?.name," ","(",x.assignedDriver.email||u?.email||"Email TBD",")"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Will receive: Passenger details, pickup schedule, flight coordination, and service requirements"})]})]}),t.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-2xl cursor-pointer transition-colors "+(te.recipients.includes("manager")?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-300"),children:[t.jsx("input",{type:"checkbox",checked:te.recipients.includes("manager"),onChange:e=>{e.target.checked?ae({...te,recipients:[...te.recipients,"manager"]}):ae({...te,recipients:te.recipients.filter(e=>"manager"!==e)})},className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(se,{className:"w-4 h-4 text-gray-600"}),t.jsx("span",{className:"font-medium text-gray-900 text-xs",children:"Department Manager"})]}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[x?.department," Department Head"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Will receive: Travel summary, arrangements overview, and budget information"})]})]})]})]}),te.recipients.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:"Message Preview"}),t.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:te.recipients.map(e=>{const s=ie(e);return t.jsxs("div",{className:"border border-gray-200 rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"bg-gray-50 px-3 py-2 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-2",children:["employee"===e&&t.jsx(me,{className:"w-4 h-4 text-blue-600"}),"driver"===e&&t.jsx(X,{className:"w-4 h-4 text-purple-600"}),"manager"===e&&t.jsx(se,{className:"w-4 h-4 text-orange-600"}),t.jsxs("span",{className:"font-medium text-gray-900 capitalize text-xs",children:[e," Notification"]})]})}),t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Subject"}),t.jsx("p",{className:"text-xs font-medium text-gray-900 bg-gray-50 p-2 rounded-2xl border",children:s.subject})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Message"}),t.jsx("div",{className:"text-xs text-gray-700 bg-gray-50 p-2 rounded-2xl border max-h-32 overflow-y-auto whitespace-pre-line",children:s.message})]})]})]},e)})})]}),t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(r,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-yellow-900 text-xs",children:"Before Sending"}),t.jsxs("ul",{className:"text-yellow-700 text-xs space-y-1 mt-1",children:[t.jsx("li",{children:"â€¢ Verify all travel details are accurate"}),t.jsx("li",{children:"â€¢ Ensure flight bookings are confirmed (if applicable)"}),t.jsx("li",{children:"â€¢ Confirm driver assignment details"}),t.jsx("li",{children:"â€¢ Check recipient email addresses"})]})]})]})}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:te.includeItinerary,onChange:e=>ae({...te,includeItinerary:e.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsx("span",{className:"text-gray-700 text-xs",children:"Include downloadable travel itinerary (PDF attachment)"})]}),t.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-100",children:[t.jsx("button",{onClick:()=>z(!1),className:"px-4 py-2 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:"Cancel"}),t.jsx("button",{onClick:async()=>{try{P(!0);const e=localStorage.getItem("token"),s=te.recipients.map(async s=>{let t;if("employee"===s?t=x.employee._id:"driver"===s&&x.assignedDriver?t=x.assignedDriver._id:"manager"===s&&(t=x.supervisor),!t)return null;const r=ie(s);return fetch(`${ne}/api/travel-requests/${x.id}/send-notifications`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({subject:r.subject,message:r.message,includeItinerary:te.includeItinerary,recipients:[t],recipientType:s})})}),t=(await Promise.all(s.filter(Boolean))).filter(e=>!e.ok);if(t.length>0)throw new Error(`Failed to send ${t.length} notification(s)`);const r={...x,status:"completed",fleetNotification:{sent:!0,sentAt:(new Date).toISOString(),recipients:te.recipients,subject:"Multiple personalized notifications sent",message:"Automated context-aware messages sent to all recipients",includeItinerary:te.includeItinerary,sentBy:"currentUserId"}};m(r),Q(e=>e.map(e=>e.id===x.id?r:e)),z(!1),_(`Personalized notifications sent successfully to ${te.recipients.length} recipient(s)`),W("success"),U(!0),setTimeout(()=>{U(!1)},3e3)}catch(e){_(e.message||"Failed to send notifications"),W("error"),U(!0),setTimeout(()=>{U(!1)},3e3)}finally{P(!1)}},disabled:B||0===te.recipients.length,className:"flex items-center gap-1 px-4 py-2 text-xs bg-green-500 text-white rounded-2xl hover:bg-green-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:B?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{size:14}),"Send to ",te.recipients.length," Recipient",1!==te.recipients.length?"s":""]})})]})]})]})}),L&&t.jsx(je.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:"fixed bottom-4 right-4 z-50",children:t.jsx("div",{className:"px-6 py-4 rounded-xl shadow-2xl border "+("success"===K?"bg-green-50 text-green-800 border-green-200":"error"===K?"bg-red-50 text-red-800 border-red-200":"bg-blue-50 text-blue-800 border-blue-200"),children:t.jsxs("div",{className:"flex items-center gap-3",children:["success"===K&&t.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:t.jsx(d,{size:16,className:"text-white"})}),"error"===K&&t.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:t.jsx(r,{size:16,className:"text-white"})}),"info"===K&&t.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:t.jsx(q,{size:16,className:"text-white"})}),t.jsx("span",{className:"font-medium",children:O}),t.jsx("button",{onClick:()=>U(!1),className:"ml-4 text-gray-400 hover:text-gray-600",children:t.jsx(h,{size:18})})]})})})]})}const ms=Object.freeze(Object.defineProperty({__proto__:null,default:xs},Symbol.toStringTag,{value:"Module"})),us=(e,s="MMM d, yyyy")=>!e||isNaN(new Date(e).getTime())?"N/A":we(new Date(e),s),ps=({status:e,type:s="trip"})=>t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${((e,s)=>{if("trip"===s)switch(e){case"active":return"bg-green-100 text-green-800";case"completed":return"bg-blue-100 text-blue-800";case"reconciled":return"bg-purple-100 text-purple-800";case"upcoming":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}else switch(e){case"recorded":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e,s)}`,children:e}),gs=({trip:e,isSelected:s,onClick:r})=>t.jsxs("div",{className:"bg-white rounded-2xl border p-2 cursor-pointer transition-all hover:shadow-sm "+(s?"border-blue-500 shadow-sm":"border-gray-200"),onClick:r,children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("div",{children:t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:e.purpose})}),t.jsx(ps,{status:e.status})]}),t.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[t.jsx(v,{className:"w-3 h-3 text-gray-400"}),t.jsxs("span",{className:"text-xs text-gray-600",children:[e.city,", ",e.country]})]}),t.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[t.jsx(w,{className:"w-3 h-3 text-gray-400"}),t.jsxs("span",{className:"text-xs text-gray-600",children:[we(e.departureDate,"MMM d")," - ",we(e.returnDate,"MMM d, yyyy")]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded-full text-xs font-medium",children:new Intl.NumberFormat("en-US",{style:"currency",currency:e.currency||"USD"}).format(e.perDiemAmount)}),t.jsx("div",{className:"p-0.5 bg-blue-50 rounded",children:t.jsx(F,{className:"w-3 h-3 text-blue-600"})})]}),t.jsxs("span",{className:"text-xs text-gray-500",children:[e.expenses.length," expenses"]})]})]}),hs=({isOpen:e,onClose:s,title:r,children:a,size:n="md"})=>{if(!e)return null;return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:`bg-white rounded-xl shadow-xl ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[n]} w-full max-h-[90vh] overflow-hidden`,children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 p-1 rounded-xl hover:bg-gray-100",children:t.jsx(h,{size:18})})]}),t.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-4rem)]",children:a})]})})},bs=({size:e="md"})=>t.jsx("div",{className:`${{sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"}[e]} animate-spin rounded-full border-2 border-gray-300 border-t-blue-600`}),ys=({type:e="info",title:s,children:a,onClose:n})=>{const l={info:q,success:d,warning:J,error:r}[e];return t.jsx("div",{className:`p-3 rounded-2xl border ${{info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"}[e]}`,children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(l,{className:`w-4 h-4 mt-0.5 ${{info:"text-blue-500",success:"text-green-500",warning:"text-yellow-500",error:"text-red-500"}[e]}`}),t.jsxs("div",{className:"flex-1",children:[s&&t.jsx("h4",{className:"font-medium mb-1 text-sm",children:s}),t.jsx("div",{className:"text-sm",children:a})]}),n&&t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 p-1 rounded-xl hover:bg-gray-100",children:t.jsx(h,{size:14})})]})})};function js(){s();const n=e.useRef(null),{user:l}=Ie(),[i,o]=e.useState("active"),[m,u]=e.useState({expenses:[]}),[b,y]=e.useState(""),[j,f]=e.useState("all"),[N,v]=e.useState(!1),[k,S]=e.useState(!1),[A,M]=e.useState(!1),[z,q]=e.useState(!1),[R,E]=e.useState(!1),[P,L]=e.useState(1),[U,_]=e.useState(!1),[K,W]=e.useState(""),[H,V]=e.useState("success"),[G,Y]=e.useState(!1),[Q,X]=e.useState(null),[Z,se]=e.useState(null),[te,re]=e.useState(!0),[ae,ne]=e.useState([]),[le,ie]=e.useState(null),[de,ce]=e.useState(!1),oe="https://backend.nexusmwi.com",[xe,me]=e.useState({category:"",description:"",amount:"",currency:"",date:we(new Date,"yyyy-MM-dd"),paymentMethod:"card",receipt:null,notes:""}),[ue,pe]=e.useState({tripReport:"",totalSpent:0,remainingBalance:0,expenses:[],receipts:[],additionalNotes:"",returnDate:we(new Date,"yyyy-MM-dd"),status:"draft"}),he=ae.filter(e=>{const s=e.employeeName?.toLowerCase().includes(b.toLowerCase())||e.id?.toLowerCase().includes(b.toLowerCase())||e.country?.toLowerCase().includes(b.toLowerCase())||e.city?.toLowerCase().includes(b.toLowerCase()),t="all"===j||e.status===j;return s&&t});e.useEffect(()=>{if(!m&&he.length>0&&(u(he[0]),"completed"===he[0].status)){const e=he[0].expenses.reduce((e,s)=>e+(s.amount||0),0),s=he[0].perDiemAmount-e;pe({tripReport:"",totalSpent:e,remainingBalance:s,expenses:[...he[0].expenses],receipts:he[0].expenses.map(e=>e.receipt),additionalNotes:"",returnDate:we(he[0].returnDate,"yyyy-MM-dd"),status:"draft"})}},[he,m]);const be=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s||"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(e||0),ye=(e=[])=>(e||[]).reduce((e,s)=>e+(s?.amount||0),0);e.useEffect(()=>{(async()=>{re(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${oe}/api/travel-requests/finance/processed`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch completed travel requests");const t=await s.json(),r=t.map(e=>{const s=new Date,t=e.departureDate?new Date(e.departureDate):new Date,r=e.returnDate?new Date(e.returnDate):new Date(t.getTime()+864e5),a=new Date(t);a.setHours(9,0,0),new Date(a).setHours(a.getHours()+2);const n=new Date(r);n.setHours(16,0,0),new Date(n).setHours(n.getHours()+2);const l=r<s,i=s>=t&&s<=r;e.financeStatus;const d=e.reconciled||!1;let c;c=d?"reconciled":l?"completed":i?"active":"upcoming";const o=e.payment?.expenses?.reduce((e,s)=>e+(s.amount||0),0)||0,x=e.payment?.perDiemAmount||("MWK"===e.currency?1e5:1e3);return{id:e._id,employeeName:e.employee?.name||"Unknown Employee",employeeId:e.employee._id,department:e.employee?.department||"Unknown Department",purpose:e.purpose,country:"international"===e.travelType?"International":e.location||"Local",city:e.location||"Local",departureDate:t,returnDate:r,status:c,reconciled:d,perDiemAmount:x,currency:e.currency||"USD",cardDetails:{lastFour:e.payment?.card?.lastFour||"0000",type:e.payment?.card?.type||"VISA",holder:e.employee?.name||"Unknown"},expenses:e.payment?.expenses?.map(s=>({id:s._id,category:s.category||"Miscellaneous",description:s.description||"No description",amount:s.amount||0,currency:e.currency||"USD",date:new Date(s.date||e.departureDate),paymentMethod:"card",receipt:null,status:"recorded"}))||[],travelArrangements:{flight:{outbound:{airline:e.flight?.outbound?.airline||"Unknown",flightNumber:e.flight?.outbound?.flightNumber||"N/A",departureTime:new Date(e.departureDate),arrivalTime:new Date(e.departureDate),from:"Unknown",to:e.location||"Destination"},return:{airline:e.flight?.return?.airline||"Unknown",flightNumber:e.flight?.return?.flightNumber||"N/A",departureTime:new Date(e.returnDate),arrivalTime:new Date(e.returnDate),from:e.location||"Destination",to:"Unknown"}},accommodation:{name:"Unknown",address:"Not specified",checkIn:e.departureDate,checkOut:e.returnDate,confirmationNumber:"N/A"},transportation:{type:"Other",details:e.meansOfTravel||"N/A",provider:"Unknown",confirmationNumber:"N/A"}},emergencyContacts:[{name:"Company HR",phone:"+1234567890",email:"hr@company.com"},{name:"Local Emergency",phone:"+112",email:"emergency@local.com"}],reconciliation:d?{submittedDate:new Date(e.payment?.processedAt||e.updatedAt),approvedDate:d?new Date(e.updatedAt):null,approvedBy:e.finalApprover,totalSpent:o,remainingBalance:x-o,status:d?"approved":"pending",notes:d?"Reconciled automatically":""}:null}});ne(r)}catch(e){W("Failed to fetch completed travel requests"),V("error"),_(!0),setTimeout(()=>{_(!1)},3e3)}finally{re(!1)}})()},[]);const je=he.filter(e=>"reconciled"===i?e.reconciled:e.status===i);return t.jsx("div",{className:"min-h-screen bg-gray-50",children:t.jsxs("main",{className:"p-4 space-y-4 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:t.jsx("div",{className:"flex items-center gap-2 mb-1",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Travel Execution & Reconciliation"})})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("select",{value:j,onChange:e=>f(e.target.value),className:"px-3 py-1.5 border border-gray-200 rounded-2xl text-xs font-medium text-gray-700 bg-white",children:[t.jsx("option",{value:"all",children:"All Trips"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"upcoming",children:"Upcoming"})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsx("div",{className:"lg:col-span-1",children:t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200",children:[t.jsx("div",{className:"p-3 border-b border-gray-100",children:t.jsxs("div",{className:"relative",children:[t.jsx(a,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 w-3 h-3"}),t.jsx("input",{type:"text",placeholder:"Search trips...",value:b,onChange:e=>y(e.target.value),className:"w-full pl-8 pr-3 py-1.5 border border-gray-200 rounded-2xl text-xs focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"})]})}),t.jsx("div",{className:"border-b border-gray-100",children:t.jsx("nav",{className:"flex",children:[{id:"upcoming",label:"Upcoming",count:he.filter(e=>"upcoming"===e.status).length},{id:"active",label:"Active",count:he.filter(e=>"active"===e.status).length},{id:"completed",label:"Completed",count:he.filter(e=>"completed"===e.status).length}].map(e=>t.jsxs("button",{onClick:()=>o(e.id),className:"flex-1 px-2 py-2 text-xs font-medium border-b-2 "+(i===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[e.label,e.count>0&&t.jsx("span",{className:"ml-1 px-1 py-0.5 text-xs rounded-full "+(i===e.id?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"),children:e.count})]},e.id))})}),t.jsx("div",{className:"p-3 space-y-2 max-h-80 overflow-y-auto",children:te?t.jsx("div",{className:"flex justify-center py-6",children:t.jsx(bs,{size:"lg"})}):0===je.length?t.jsxs("div",{className:"text-center py-6 text-gray-500",children:[t.jsx(I,{className:"w-6 h-6 mx-auto mb-2 text-gray-300"}),t.jsxs("p",{className:"text-xs",children:["No ",i," trips found"]})]}):je.map(e=>t.jsx(gs,{trip:e,isSelected:m?.id===e.id,onClick:()=>(e=>{if(u({...e,expenses:e.expenses||[]}),v(!1),S(!1),L(1),"completed"===e.status){const s=e.expenses.reduce((e,s)=>e+(s.amount||0),0),t=e.perDiemAmount-s;pe({tripReport:"",totalSpent:s,remainingBalance:t,expenses:[...e.expenses],receipts:e.expenses.map(e=>e.receipt),additionalNotes:"",returnDate:e.returnDate?we(new Date(e.returnDate),"yyyy-MM-dd"):we(new Date,"yyyy-MM-dd"),status:"draft"})}me({category:"",description:"",amount:"",currency:e?e.currency:"",date:we(new Date,"yyyy-MM-dd"),paymentMethod:"card",receipt:null,notes:""})})(e)},e.id))})]})}),t.jsx("div",{className:"lg:col-span-2",children:m&&m.id?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("div",{children:t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:m.purpose})})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ps,{status:m.status}),t.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 rounded-xl hover:bg-gray-100",children:t.jsx(D,{size:16})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-1",children:"Destination"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(C,{className:"w-3 h-3 text-blue-600"}),t.jsxs("span",{className:"text-gray-900 text-sm",children:[m.city,", ",m.country]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-1",children:"Travel Period"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(w,{className:"w-3 h-3 text-blue-600"}),t.jsxs("span",{className:"text-gray-900 text-sm",children:[us(m.departureDate,"MMM d")," -"," ",us(m.returnDate,"MMM d, yyyy")]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-1",children:"Per Diem Allowance"}),t.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[t.jsx($,{className:"w-3 h-3 text-blue-600"}),t.jsx("span",{className:"text-base font-semibold text-gray-900",children:be(m.perDiemAmount,m.currency)})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-gray-500",children:["Spent:"," ",be(ye(m?.expenses||[]),m.currency)]}),t.jsxs("span",{className:"text-gray-500",children:["Remaining:"," ",be(((e=0,s=[])=>e-ye(s))(m.perDiemAmount,m?.expenses||[]),m.currency)]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:t.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${Math.min(ye(m?.expenses||[])/m.perDiemAmount*100,100)}%`}})})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-1",children:"Payment Card"}),t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-xl",children:[t.jsx("div",{className:"p-1.5 bg-blue-100 rounded-xl",children:t.jsx(F,{className:"w-3 h-3 text-blue-600"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[m.cardDetails?.type??"Unknown"," ****"," ",m.cardDetails?.lastFour??"0000"]}),t.jsx("p",{className:"text-xs text-gray-500",children:m.cardDetails?.holder??"Unknown"})]})]})]}),"reconciled"===m.status&&m.reconciliation&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-1",children:"Reconciliation Status"}),t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-50 rounded-xl",children:[t.jsx("div",{className:"p-1.5 bg-green-100 rounded-xl",children:t.jsx(d,{className:"w-3 h-3 text-green-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"approved"===m.reconciliation.status?"Approved":"Pending Approval"}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Submitted on ",we(m.reconciliation.submittedDate,"MMMM d, yyyy")]})]})]})]})]})]}),t.jsxs("div",{className:"mt-4",children:["active"===m.status&&t.jsx(ys,{type:"success",title:"Active Trip",children:"Your trip is currently active. You can record expenses as they occur and view your travel arrangements."}),"completed"===m.status&&t.jsx(ys,{type:"warning",title:"Trip Completed",children:"Your trip is complete. Please reconcile your expenses and submit your trip report."}),"reconciled"===m.status&&t.jsxs(ys,{type:"info",title:"Trip Reconciled",children:["This trip has been reconciled and"," ","approved"===m.reconciliation.status?"approved":"is pending approval",".",m.reconciliation.remainingBalance>0&&` A remaining balance of ${be(m.reconciliation.remainingBalance,m.currency)} will be returned to the company.`]}),"upcoming"===m.status&&t.jsxs(ys,{type:"info",title:"Upcoming Trip",children:["Your trip is scheduled for ",we(m.departureDate,"MMMM d, yyyy"),". You'll be able to record expenses once the trip begins."]})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-3 border-t border-gray-100",children:["active"===m.status&&t.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white rounded-2xl font-medium hover:bg-blue-700 transition-colors text-xs",children:[t.jsx(O,{size:14}),"Record Expense"]}),"completed"===m.status&&t.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-orange-600 text-white rounded-2xl font-medium hover:bg-orange-700 transition-colors text-xs",children:[t.jsx(T,{size:14}),"Start Reconciliation"]}),"reconciled"===m.status&&t.jsxs("button",{onClick:()=>ve(m),className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white rounded-2xl font-medium hover:bg-green-700 transition-colors text-xs",children:[t.jsx(p,{size:14}),"Download Report"]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200",children:[t.jsx("div",{className:"p-3 border-b border-gray-100"}),t.jsxs("div",{className:"p-3 space-y-3",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Flight Information"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"p-2 bg-gray-50 rounded-xl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[t.jsx("div",{className:"flex items-center gap-1.5",children:t.jsx("span",{className:"font-medium text-sm",children:m.travelArrangements?.flight?.outbound?.airline??"N/A"})}),t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-200 text-gray-700 text-xs rounded",children:m.travelArrangements?.flight?.outbound?.flightNumber??"N/A"})]}),t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:m.travelArrangements?.flight?.outbound?.from??"N/A"}),t.jsx("p",{className:"text-gray-500",children:us(m.travelArrangements?.flight?.outbound?.departureTime,"MMM d, h:mm a")})]}),t.jsx(B,{className:"text-gray-400",size:14}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium",children:m.travelArrangements?.flight?.outbound?.to??"N/A"}),t.jsx("p",{className:"text-gray-500",children:us(m.travelArrangements?.flight?.outbound?.arrivalTime,"MMM d, h:mm a")})]})]})]}),t.jsxs("div",{className:"p-2 bg-gray-50 rounded-xl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[t.jsx("div",{className:"flex items-center gap-1.5",children:t.jsx("span",{className:"font-medium text-sm",children:m.travelArrangements?.flight?.return?.airline??"N/A"})}),t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-200 text-gray-700 text-xs rounded",children:m.travelArrangements?.flight?.return?.flightNumber??"N/A"})]}),t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:m.travelArrangements?.flight?.return?.from??"N/A"}),t.jsx("p",{className:"text-gray-500",children:us(m.travelArrangements?.flight?.return?.departureTime,"MMM d, h:mm a")})]}),t.jsx(B,{className:"text-gray-400",size:14}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium",children:m.travelArrangements?.flight?.return?.to??"N/A"}),t.jsx("p",{className:"text-gray-500",children:us(m.travelArrangements?.flight?.return?.arrivalTime,"MMM d, h:mm a")})]})]})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Accommodation"}),t.jsxs("div",{className:"p-2 bg-gray-50 rounded-xl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"p-1 bg-orange-100 rounded",children:t.jsx(ge,{className:"w-3 h-3 text-orange-600"})}),t.jsx("span",{className:"font-medium text-sm",children:m.travelArrangements?.accommodation?.name??"N/A"})]}),t.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-200 text-gray-700 text-xs rounded",children:["Confirmation #",m.travelArrangements?.accommodation?.confirmationNumber??"N/A"]})]}),t.jsx("p",{className:"text-xs text-gray-600 mb-1.5",children:m.travelArrangements?.accommodation?.address??"N/A"}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:"Check-in"}),t.jsx("p",{className:"font-medium",children:m.travelArrangements?.accommodation?.checkIn??"N/A"})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-gray-500",children:"Check-out"}),t.jsx("p",{className:"font-medium",children:m.travelArrangements?.accommodation?.checkOut??"N/A"})]})]})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200",children:[t.jsxs("div",{className:"p-3 border-b border-gray-100 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(T,{className:"w-4 h-4 text-blue-600"}),t.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:"Expenses"})]}),"active"===m.status&&t.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-1.5 px-2 py-1 bg-blue-600 text-white rounded-2xl text-xs font-medium hover:bg-blue-700",children:[t.jsx(O,{size:12}),"Add Expense"]})]}),0===m?.expenses?.length?t.jsxs("div",{className:"p-6 text-center text-gray-500",children:[t.jsx(T,{className:"w-6 h-6 mx-auto mb-2 text-gray-300"}),t.jsx("p",{className:"text-xs",children:"No expenses recorded yet"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),t.jsx("th",{className:"text-right py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-100",children:[m?.expenses?.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"py-2 px-3 text-xs text-gray-900",children:we(e.date,"MMM d, yyyy")}),t.jsx("td",{className:"py-2 px-3 text-xs text-gray-900",children:e.category}),t.jsx("td",{className:"py-2 px-3 text-xs text-gray-900",children:e.description}),t.jsx("td",{className:"py-2 px-3 text-xs text-gray-900 text-right font-medium",children:be(e.amount,m.currency)}),t.jsx("td",{className:"py-2 px-3",children:t.jsx(ps,{status:e.status,type:"expense"})})]},e.id)),t.jsxs("tr",{className:"bg-gray-50 font-medium",children:[t.jsx("td",{colSpan:3,className:"py-2 px-3 text-xs text-gray-900 text-right",children:"Total"}),t.jsx("td",{className:"py-2 px-3 text-xs text-gray-900 text-right",children:be(ye(m?.expenses||[]),m.currency)}),t.jsx("td",{className:"py-2 px-3"})]})]})]})})]})]}):t.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-8 text-center",children:[t.jsx(I,{className:"w-8 h-8 mx-auto mb-3 text-gray-300"}),t.jsx("h3",{className:"text-base font-medium text-gray-900 mb-1",children:"No Trip Selected"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"Select a trip from the list to view details"})]})})]}),t.jsx(hs,{isOpen:N,onClose:()=>v(!1),title:"Record Expense",size:"lg",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Category"}),t.jsxs("select",{value:xe.category,onChange:e=>me({...xe,category:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"",children:"Select category"}),t.jsx("option",{value:"Meals",children:"Meals"}),t.jsx("option",{value:"Transportation",children:"Transportation"}),t.jsx("option",{value:"Accommodation",children:"Accommodation"}),t.jsx("option",{value:"Entertainment",children:"Entertainment"}),t.jsx("option",{value:"Business Services",children:"Business Services"}),t.jsx("option",{value:"Miscellaneous",children:"Miscellaneous"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Description"}),t.jsx("input",{type:"text",placeholder:"Brief description of the expense",value:xe.description,onChange:e=>me({...xe,description:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Date"}),t.jsx("input",{type:"date",value:xe.date,onChange:e=>me({...xe,date:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Amount"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:m.currency}),t.jsx("input",{type:"number",placeholder:"0.00",value:xe.amount,onChange:e=>me({...xe,amount:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Payment Method"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("div",{className:"p-2 border-2 rounded-2xl cursor-pointer transition-colors "+("card"===xe.paymentMethod?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>me({...xe,paymentMethod:"card"}),children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("input",{type:"radio",checked:"card"===xe.paymentMethod,onChange:()=>me({...xe,paymentMethod:"card"}),className:"text-blue-600"}),t.jsx("span",{className:"text-xs font-medium",children:"Company Card"})]})}),t.jsx("div",{className:"p-2 border-2 rounded-2xl cursor-pointer transition-colors "+("cash"===xe.paymentMethod?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>me({...xe,paymentMethod:"cash"}),children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("input",{type:"radio",checked:"cash"===xe.paymentMethod,onChange:()=>me({...xe,paymentMethod:"cash"}),className:"text-blue-600"}),t.jsx("span",{className:"text-xs font-medium",children:"Cash"})]})})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Receipt"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"file",ref:n,onChange:e=>{const s=e.target.files[0];s&&(E(!0),setTimeout(()=>{me({...xe,receipt:s.name}),E(!1)},1e3))},className:"hidden"}),t.jsx("button",{type:"button",onClick:()=>n.current?.click(),disabled:R,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 border border-gray-200 rounded-2xl hover:bg-gray-50 disabled:opacity-50 text-xs",children:R?t.jsxs(t.Fragment,{children:[t.jsx(bs,{size:"sm"}),"Uploading..."]}):xe.receipt?t.jsxs(t.Fragment,{children:[t.jsx(c,{size:14}),xe.receipt]}):t.jsxs(t.Fragment,{children:[t.jsx(x,{size:14}),"Upload Receipt"]})}),xe.receipt&&t.jsx("button",{type:"button",onClick:()=>me({...xe,receipt:null}),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded-xl hover:bg-gray-100",children:t.jsx(h,{size:14})})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Upload a photo or scan of your receipt (JPG, PNG, or PDF)"})]})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),t.jsx("textarea",{placeholder:"Any additional notes about this expense",value:xe.notes,onChange:e=>me({...xe,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-3 border-t border-gray-100",children:[t.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-3 py-1.5 text-gray-700 border border-gray-200 rounded-2xl hover:bg-gray-50 text-xs font-medium",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{q(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${oe}/api/travel-requests/${m.id}/expenses`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({category:xe.category,amount:xe.amount,description:xe.description})});if(!s.ok)throw new Error("Failed to save expense");const t=await s.json(),r={id:t.payment.expenses[t.payment.expenses.length-1]._id,category:xe.category,description:xe.description,amount:Number.parseFloat(xe.amount),currency:m.currency,date:new Date(xe.date),paymentMethod:xe.paymentMethod,receipt:xe.receipt,status:"recorded"};u(e=>({...e,expenses:[...e.expenses,r]})),ne(e=>e.map(e=>e.id===m.id?{...e,expenses:[...e.expenses,r]}:e)),W("Expense added successfully"),V("success"),_(!0),setTimeout(()=>{_(!1)},3e3),v(!1),me({category:"",description:"",amount:"",currency:m.currency,date:we(new Date,"yyyy-MM-dd"),paymentMethod:"card",receipt:null,notes:""})}catch(e){W("Failed to save expense"),V("error"),_(!0),setTimeout(()=>{_(!1)},3e3)}finally{q(!1)}},disabled:z||!xe.category||!xe.description||!xe.amount,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white rounded-2xl font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-xs",children:z?t.jsxs(t.Fragment,{children:[t.jsx(bs,{size:"sm"}),"Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{size:14}),"Save Expense"]})})]})]})}),t.jsx(hs,{isOpen:k,onClose:()=>S(!1),title:"Trip Reconciliation",size:"sm",children:t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"flex items-center justify-center mb-4",children:t.jsx("div",{className:"flex items-center space-x-2",children:[{step:1,label:"Trip"},{step:2,label:"Expenses"},{step:3,label:"Submit"}].map((e,s)=>t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex items-center justify-center w-5 h-5 rounded-full text-xs font-medium "+(P>=e.step?"bg-blue-600 text-white":"bg-gray-200 text-gray-500"),children:P>e.step?t.jsx(g,{size:10}):e.step}),t.jsx("span",{className:"ml-1 text-xs font-medium "+(P>=e.step?"text-blue-600":"text-gray-500"),children:e.label}),s<2&&t.jsx("div",{className:"w-6 h-0.5 ml-2 "+(P>e.step?"bg-blue-600":"bg-gray-200")})]},e.step))})}),1===P&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Trip Report"}),t.jsx("textarea",{placeholder:"Summary of your trip, meetings, outcomes",value:ue.tripReport,onChange:e=>pe({...ue,tripReport:e.target.value}),rows:4,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Actual Return Date"}),t.jsx("input",{type:"date",value:ue.returnDate,onChange:e=>pe({...ue,returnDate:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),2===P&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Expense Summary"}),t.jsxs("div",{className:"grid grid-cols-1 gap-2 mb-3",children:[t.jsx("div",{className:"bg-blue-50 p-2 rounded-2xl border border-blue-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Per Diem Allowance"}),t.jsx("span",{className:"text-sm font-semibold text-gray-900",children:be(m.perDiemAmount,m.currency)})]})}),t.jsx("div",{className:"bg-orange-50 p-2 rounded-2xl border border-orange-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Total Expenses"}),t.jsx("span",{className:"text-sm font-semibold text-gray-900",children:be(ue.totalSpent,m.currency)})]})}),t.jsx("div",{className:"p-2 rounded-2xl border "+(ue.remainingBalance<0?"bg-red-50 border-red-100":"bg-green-50 border-green-100"),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Remaining Balance"}),t.jsx("span",{className:"text-sm font-semibold "+(ue.remainingBalance<0?"text-red-700":"text-green-700"),children:be(ue.remainingBalance,m.currency)})]})})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2 text-xs",children:"Expense Details"}),t.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-2xl text-xs",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left py-1.5 px-2 font-medium text-gray-500",children:"Date"}),t.jsx("th",{className:"text-left py-1.5 px-2 font-medium text-gray-500",children:"Category"}),t.jsx("th",{className:"text-right py-1.5 px-2 font-medium text-gray-500",children:"Amount"}),t.jsx("th",{className:"text-left py-1.5 px-2 font-medium text-gray-500",children:"Receipt"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-100",children:ue.expenses.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"py-1.5 px-2",children:we(e.date,"MMM d")}),t.jsx("td",{className:"py-1.5 px-2",children:e.category}),t.jsx("td",{className:"py-1.5 px-2 text-right font-medium",children:be(e.amount,m.currency)}),t.jsx("td",{className:"py-1.5 px-2",children:e.receipt?t.jsx("button",{className:"text-blue-600 hover:text-blue-700 text-xs px-1.5 py-0.5 bg-blue-50 rounded-2xl",children:"View"}):t.jsx("span",{className:"px-1.5 py-0.5 bg-red-100 text-red-800 rounded-2xl",children:"Missing"})})]},e.id))})]})})]}),t.jsx("div",{className:"p-2 rounded-2xl "+(ue.remainingBalance<0?"bg-red-50 border border-red-100":"bg-green-50 border border-green-100"),children:t.jsxs("div",{className:"flex items-start gap-1.5",children:[t.jsx("div",{className:"p-1 mt-0.5 rounded-2xl "+(ue.remainingBalance<0?"bg-red-100":"bg-green-100"),children:ue.remainingBalance<0?t.jsx(r,{size:12,className:"text-red-600"}):t.jsx(d,{size:12,className:"text-green-600"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium "+(ue.remainingBalance<0?"text-red-800":"text-green-800"),children:ue.remainingBalance<0?"Overspent Budget":"Within Budget"}),t.jsx("p",{className:"text-xs mt-0.5 "+(ue.remainingBalance<0?"text-red-700":"text-green-700"),children:ue.remainingBalance<0?`Exceeded by ${be(Math.abs(ue.remainingBalance),m.currency)}`:`${be(ue.remainingBalance,m.currency)} remaining`})]})]})})]}),3===P&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Additional Notes"}),t.jsx("textarea",{placeholder:"Additional information or explanation",value:ue.additionalNotes,onChange:e=>pe({...ue,additionalNotes:e.target.value}),rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-2xl focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"bg-gray-50 p-3 rounded-2xl border border-gray-200",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-xs",children:"Reconciliation Summary"}),t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-gray-500",children:"Trip Details"}),t.jsxs("p",{className:"text-gray-700",children:[m.city,", ",m.country," â€¢ ",m.purpose]}),t.jsxs("p",{className:"text-gray-700",children:[we(m.departureDate,"MMM d")," -"," ",ue.returnDate&&!isNaN(new Date(ue.returnDate).getTime())?we(new Date(ue.returnDate),"MMM d"):"N/A"]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-gray-500",children:"Financial Summary"}),t.jsxs("p",{className:"text-gray-700",children:["Allowance: ",be(m.perDiemAmount,m.currency)]}),t.jsxs("p",{className:"text-gray-700",children:["Expenses: ",be(ue.totalSpent,m.currency)]}),t.jsxs("p",{className:"font-medium "+(ue.remainingBalance<0?"text-red-700":"text-green-700"),children:["Balance: ",be(ue.remainingBalance,m.currency)]})]})]}),t.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[t.jsx("h5",{className:"text-xs font-medium text-gray-500 mb-0.5",children:"Next Steps"}),t.jsx("p",{className:"text-xs text-gray-700",children:ue.remainingBalance>0?`Return ${be(ue.remainingBalance,m.currency)} to company`:ue.remainingBalance<0?`Request ${be(Math.abs(ue.remainingBalance),m.currency)} reimbursement`:"No further action required"})]})]}),t.jsx("div",{className:"bg-yellow-50 p-2 rounded-2xl border border-yellow-100",children:t.jsxs("div",{className:"flex items-start gap-1.5",children:[t.jsx("div",{className:"p-1 mt-0.5 bg-yellow-100 rounded-2xl",children:t.jsx(J,{size:12,className:"text-yellow-600"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-medium text-yellow-800",children:"Confirmation"}),t.jsx("p",{className:"text-xs mt-0.5 text-yellow-700",children:"Confirm expenses are accurate and comply with company policy."})]})]})})]}),t.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:()=>{P>1?L(P-1):S(!1)},className:"px-3 py-1.5 text-xs text-gray-700 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-colors font-medium",children:P>1?"Back":"Cancel"}),P<3?t.jsx("button",{type:"button",onClick:()=>L(P+1),disabled:1===P&&!ue.tripReport,className:"px-3 py-1.5 text-xs bg-blue-500 text-white rounded-2xl hover:bg-blue-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}):t.jsx("button",{type:"button",onClick:async()=>{if(!m||!m.id)return ie({type:"error",text:"Please select a valid travel request"}),void ce(!0);const e=ue.returnDate?new Date(ue.returnDate):new Date(m.returnDate);if(isNaN(e.getTime()))return ie({type:"error",text:"Please enter a valid return date"}),void ce(!0);if(isNaN(ue.totalSpent)||ue.totalSpent<0)return ie({type:"error",text:"Please enter a valid total amount spent"}),void ce(!0);M(!0);try{const s=localStorage.getItem("token"),t=await fetch(`${oe}/api/travel-requests/${m.id}/reconcile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({totalSpent:Number.parseFloat(ue.totalSpent),remainingBalance:Number.parseFloat(ue.remainingBalance),additionalNotes:ue.additionalNotes||"",returnDate:e.toISOString(),tripReport:ue.tripReport||"",expenses:ue.expenses||[]})});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to submit reconciliation")}const r=await t.json(),a={...r.travelRequest,status:"pending_reconciliation",returnDate:r.travelRequest.returnDate?new Date(r.travelRequest.returnDate):new Date,reconciliation:{...r.travelRequest.reconciliation,submittedDate:new Date(r.travelRequest.reconciliation.submittedDate),approvedDate:r.travelRequest.reconciliation.approvedDate?new Date(r.travelRequest.reconciliation.approvedDate):null,status:"pending_reconciliation"}};u(a),ne(e=>e.map(e=>e.id===m.id?a:e)),S(!1),L(1),o("reconciled"),W("Reconciliation submitted successfully!"),V("success"),_(!0)}catch(s){W(s.message||"Failed to submit reconciliation"),V("error"),_(!0),setTimeout(()=>{_(!1)},3e3)}finally{M(!1)}},disabled:A,className:"flex items-center gap-1 px-3 py-1.5 bg-orange-500 text-white rounded-2xl font-medium hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-xs",children:A?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Submitting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{size:12}),"Submit"]})})]})]})}),U&&t.jsx("div",{className:"fixed top-4 right-4 z-50",children:t.jsx(ys,{type:H,onClose:()=>_(!1),children:K})})]})})}const fs=Object.freeze(Object.defineProperty({__proto__:null,default:js},Symbol.toStringTag,{value:"Module"}));export{He as F,ns as I,_e as M,rs as T,xs as a,es as b,js as c,ss as d,ms as e,Ve as f,fs as g,ls as i,Ke as m,as as t};
