import{u as e,a as t,r as a,j as s,O as i}from"./react-core-DKrnZdd7.js";import{u as n}from"./context-k3FZ8Vno.js";import{B as r,C as o,A as l,T as c,a as u}from"./mui-material-9NDCc7EL.js";const p=["Software Engineer","Senior Software Engineer","Lead Engineer","Product Manager","Senior Product Manager","Data Scientist","Data Analyst","UI/UX Designer","Senior Designer","DevOps Engineer","Quality Assurance Engineer","Business Analyst","Project Manager","Scrum Master","Sales Representative","Sales Manager","Marketing Specialist","Marketing Manager","HR Specialist","HR Manager","Finance Analyst","Accountant","Administrative Assistant","Office Manager","Customer Support Representative","Customer Success Manager"],d=["Enterprise(CEO, CFO, etc.)","CEO","CFO","CTO","COO","Executive"],h=({children:o})=>{const{user:l,loading:c}=n(),u=e(),h=t(),[g,m]=a.useState(!0),[f,y]=a.useState(!1),[b,S]=a.useState(null),[v,x]=a.useState(!0);a.useEffect(()=>{l&&j()},[l]);const j=async()=>{try{const e=localStorage.getItem("token");if(!e)return void x(!1);const t=await fetch("https://backend.nexusmwi.com/api/billing/subscription",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const e=await t.json();S(e)}}catch(e){}finally{x(!1)}};return a.useEffect(()=>{if(c||v)return;if(!l)return u("/login",{replace:!0,state:{from:h.pathname}}),void m(!1);if("Vendor"===l.role||"Vendor"===l.position?(h.pathname.startsWith("/vendor-dash")||u("/vendor-dash",{replace:!0,state:{from:h.pathname}}),!0):d.some(e=>l.role===e||l.position===e||l.position&&l.position.toLowerCase()===e.toLowerCase())?(h.pathname.startsWith("/dashboard")||u("/dashboard",{replace:!0,state:{from:h.pathname}}),!0):!!p.some(e=>l.role===e||l.position===e||l.position&&l.position.toLowerCase()===e.toLowerCase())&&(h.pathname.startsWith("/employee-dash")||u("/employee-dash",{replace:!0,state:{from:h.pathname}}),!0))return y(!0),void m(!1);const e=(()=>{if(!l||!b)return null;const e=b.subscription,t=b.trial;return e&&["active","trialing"].includes(e.status)&&"trial"!==e.plan?{type:"paid",hasAccess:!0}:t&&t.isActive&&t.remainingDays>0?{type:"trial",hasAccess:!0,remainingDays:t.remainingDays}:!e||"trial"!==e.plan||t&&t.isActive?{type:"free",hasAccess:!1}:{type:"expired",hasAccess:!1}})(),t=e?.hasAccess||!1;y(t),t?t&&h.pathname.startsWith("/billing")&&u("/dashboard",{replace:!0}):h.pathname.startsWith("/billing")||u("/billing",{replace:!0,state:{from:h.pathname,subscriptionExpired:!0}}),m(!1)},[l,c,v,u,h]),c||g||v?s.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"}}):f?s.jsx(i,{}):null},g=()=>s.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",sx:{backgroundColor:"background.default"},children:s.jsx(o,{})}),m=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{user:t}=n(),i=e(),[o,p]=a.useState(0);return a.useEffect(()=>{if(t?.billing?.trialEndDate){const e=new Date(t.billing.trialEndDate)-new Date,a=Math.ceil(e/864e5);p(a)}},[t]),t?.billing?.subscription&&"trial"===t.billing.subscription.plan?s.jsx(r,{sx:{mb:2},children:s.jsx(l,{severity:o<=3?"warning":"info",action:s.jsx(u,{color:"inherit",size:"small",onClick:()=>i("/billing"),children:"Upgrade"}),children:o>0?s.jsxs(c,{variant:"body2",children:["You have ",o," day",1!==o?"s":""," left in your trial"]}):s.jsx(c,{variant:"body2",children:"Your trial has ended. Please upgrade to continue using the service."})})}):null}},Symbol.toStringTag,{value:"Module"}));export{g as L,h as S,m as T};
