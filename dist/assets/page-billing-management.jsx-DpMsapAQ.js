import{r as e,j as t}from"./react-core-DKrnZdd7.js";import{B as r,b as n,d as i,T as s,P as a,L as o,D as l,a as c}from"./mui-material-9NDCc7EL.js";import{R as d,C as x,a as j}from"./mui-icons-Upi8wDss.js";import"./lodash-BC2fgbp_.js";import"./vendor-vite-plugin-node-polyfills-BcdDH6qu.js";import"./vendor-scheduler-6ULW7vKx.js";import"./emotion-CPxGt_VH.js";import"./vendor-stylis-h7b_IEWc.js";import"./vendor-@babel-B7ZdkCnT.js";import"./vendor-clsx-BeLtu-UY.js";import"./vendor-prop-types-C8aDgg8x.js";import"./vendor-fast-equals-CDIYsFId.js";import"./vendor-file-selector-PolBDpjR.js";import"./vendor-tslib-hK--_phs.js";import"./vendor-attr-accept-CiyT7qSw.js";import"./vendor-@mui-DNwc1o4p.js";import"./vendor-@popperjs-B_AfaIMK.js";const p=({user:p})=>{const[m,h]=e.useState(p.billing?.subscription||{}),[u,b]=e.useState(!1),y="https://backend.nexusmwi.com",v=e=>e?new Date(e).toLocaleDateString():"N/A";return t.jsxs(r,{sx:{p:4,maxWidth:800,mx:"auto"},children:[t.jsx(n,{sx:{mb:4},children:t.jsxs(i,{children:[t.jsx(s,{variant:"h5",gutterBottom:!0,children:"Subscription Management"}),t.jsxs(a,{sx:{p:3,mb:3},children:[t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[t.jsxs(s,{variant:"h6",children:["Current Plan: ",m.plan?m.plan.charAt(0).toUpperCase()+m.plan.slice(1):"None"]}),t.jsxs(s,{variant:"body1",color:"text.secondary",children:["Status: ",m.status]})]}),t.jsxs(r,{sx:{mb:2},children:[t.jsx(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Billing Period"}),t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[t.jsx(s,{variant:"body2",children:v(m.currentPeriodStart)}),t.jsx(s,{variant:"body2",children:v(m.currentPeriodEnd)})]}),t.jsx(o,{variant:"determinate",value:(()=>{if(!m.currentPeriodStart||!m.currentPeriodEnd)return 0;const e=new Date(m.currentPeriodStart).getTime(),t=new Date(m.currentPeriodEnd).getTime();return((new Date).getTime()-e)/(t-e)*100})(),sx:{height:8,borderRadius:4}})]}),t.jsx(l,{sx:{my:2}}),"active"===m.status&&t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(s,{variant:"body2",color:"text.secondary",children:m.cancelAtPeriodEnd?"Subscription will cancel at period end":"Subscription is active"}),t.jsx(c,{variant:"outlined",color:m.cancelAtPeriodEnd?"primary":"error",startIcon:m.cancelAtPeriodEnd?t.jsx(d,{}):t.jsx(x,{}),onClick:m.cancelAtPeriodEnd?async()=>{b(!0);try{await(async()=>{const e=localStorage.getItem("token"),t=await fetch(`${y}/api/billing/reactivate`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});return await t.json()})(),h(e=>({...e,status:"active"}))}finally{b(!1)}}:async()=>{b(!0);try{await(async()=>{const e=localStorage.getItem("token"),t=await fetch(`${y}/api/billing/cancel`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});return await t.json()})(),h(e=>({...e,status:"canceled"}))}finally{b(!1)}},disabled:u,children:m.cancelAtPeriodEnd?"Reactivate":"Cancel"})]})]}),t.jsx(c,{variant:"contained",fullWidth:!0,startIcon:t.jsx(j,{}),onClick:()=>window.location.href=`${y}/billing/portal`,children:"Manage Payment Methods"})]})}),t.jsx(n,{children:t.jsxs(i,{children:[t.jsx(s,{variant:"h6",gutterBottom:!0,children:"Billing History"}),p.billing?.invoices?.length>0?t.jsx(r,{children:p.billing.invoices.map((e,n)=>t.jsxs(r,{sx:{mb:2},children:[t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(s,{variant:"body1",children:new Date(e.createdAt).toLocaleDateString()}),t.jsxs(s,{variant:"body1",fontWeight:"medium",children:["$",(e.amount/100).toFixed(2)," ",e.currency.toUpperCase()]})]}),t.jsxs(s,{variant:"body2",color:"text.secondary",children:["Status: ",e.status]}),e.pdfUrl&&t.jsx(c,{size:"small",onClick:()=>window.open(e.pdfUrl,"_blank"),children:"Download Invoice"}),n<p.billing.invoices.length-1&&t.jsx(l,{sx:{my:1}})]},n))}):t.jsx(s,{variant:"body2",color:"text.secondary",children:"No billing history available"})]})})]})};export{p as default};
