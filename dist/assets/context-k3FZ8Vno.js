import{r as e,j as t}from"./react-core-DKrnZdd7.js";const r=e.createContext(void 0),o=({children:o})=>{const[n,s]=e.useState(null),[a,i]=e.useState(null),[c,l]=e.useState(!0),u=(()=>{let e;return e="https://backend.nexusmwi.com",e||(e="https://backend.nexusmwi.com"),e})(),d=e=>{if(!e)return!0;try{const t=e.split(".");if(3!==t.length)return!0;const r=1e3*JSON.parse(atob(t[1])).exp;return Date.now()>=r}catch(t){return!0}};e.useEffect(()=>{(()=>{const e=localStorage.getItem("user"),t=localStorage.getItem("token");e&&t&&(d(t)?(localStorage.removeItem("user"),localStorage.removeItem("token"),s(null),i(null)):(s(JSON.parse(e)),i(t))),l(!1)})()},[]);const g={user:n,token:a,login:async(e,t)=>{try{if(!u||"undefined"===u)throw new Error("Backend URL is not configured properly");const r=await fetch(`${u}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",mode:"cors",body:JSON.stringify({email:e,password:t})}),o=await r.json();if(!r.ok)throw new Error(o.message||"Login failed");return localStorage.setItem("user",JSON.stringify(o.user)),localStorage.setItem("token",o.token),s(o.user),i(o.token),o}catch(r){throw r}},googleLogin:async e=>{try{if(!u||"undefined"===u)throw new Error("Backend URL is not configured properly");const t=await fetch(`${u}/api/auth/google-login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",mode:"cors",body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.message||"Google login failed");return r.exists&&r.user&&r.token?(localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("token",r.token),s(r.user),i(r.token),{success:!0,user:r.user,requiresRegistration:!1}):{success:!0,requiresRegistration:!0,userData:e}}catch(t){return{success:!1,error:t.message}}},register:async(e,t,r,o,n,a,c,l)=>{try{if(!u||"undefined"===u)throw new Error("Backend URL is not configured properly");const d=await fetch(`${u}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",mode:"cors",body:JSON.stringify({firstName:e,lastName:t,email:r,password:o,companyName:n,industry:a,role:c,phoneNumber:l})}),g=await d.json();if(!d.ok)throw new Error(g.message||"Registration failed");return g.token&&(localStorage.setItem("user",JSON.stringify(g.user)),localStorage.setItem("token",g.token),s(g.user),i(g.token)),g}catch(d){throw d}},logout:()=>{s(null),i(null),localStorage.removeItem("user"),localStorage.removeItem("token")},loading:c,isTokenExpired:d,backendUrl:u};return t.jsx(r.Provider,{value:g,children:o})},n=()=>{const t=e.useContext(r);if(void 0===t)throw new Error("useAuth must be used within an AuthProvider");return t};export{o as A,n as u};
