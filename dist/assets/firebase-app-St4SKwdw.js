import{g as e,E as t,d as a,C as r,a as s,L as i,b as n,i as o,v as c,F as h}from"./firebase-other-D8qhOpib.js";import{o as p}from"./vendor-idb-7JQXQzuE.js";class f{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const b="@firebase/app",l="0.14.6",d=new i("@firebase/app"),g="@firebase/app-compat",m="@firebase/analytics-compat",u="@firebase/analytics",w="@firebase/app-check-compat",_="@firebase/app-check",C="@firebase/auth",D="@firebase/auth-compat",v="@firebase/database",y="@firebase/data-connect",E="@firebase/database-compat",S="@firebase/functions",I="@firebase/functions-compat",$="@firebase/installations",P="@firebase/installations-compat",k="@firebase/messaging",N="@firebase/messaging-compat",x="@firebase/performance",A="@firebase/performance-compat",F="@firebase/remote-config",j="@firebase/remote-config-compat",H="@firebase/storage",B="@firebase/storage-compat",O="@firebase/firestore",M="@firebase/ai",U="@firebase/firestore-compat",T="firebase",R="[DEFAULT]",L={[b]:"fire-core",[g]:"fire-core-compat",[u]:"fire-analytics",[m]:"fire-analytics-compat",[_]:"fire-app-check",[w]:"fire-app-check-compat",[C]:"fire-auth",[D]:"fire-auth-compat",[v]:"fire-rtdb",[y]:"fire-data-connect",[E]:"fire-rtdb-compat",[S]:"fire-fn",[I]:"fire-fn-compat",[$]:"fire-iid",[P]:"fire-iid-compat",[k]:"fire-fcm",[N]:"fire-fcm-compat",[x]:"fire-perf",[A]:"fire-perf-compat",[F]:"fire-rc",[j]:"fire-rc-compat",[H]:"fire-gcs",[B]:"fire-gcs-compat",[O]:"fire-fst",[U]:"fire-fst-compat",[M]:"fire-vertex","fire-js":"fire-js",[T]:"fire-js-all"},V=new Map,z=new Map,J=new Map;function q(e,t){try{e.container.addComponent(t)}catch(a){d.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function G(e){const t=e.name;if(J.has(t))return d.debug(`There were multiple attempts to register component ${t}.`),!1;J.set(t,e);for(const a of V.values())q(a,e);for(const a of z.values())q(a,e);return!0}function K(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function Q(e){return null!=e&&void 0!==e.settings}const W=new t("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class X{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new s("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw W.create("app-deleted",{appName:this._name})}}const Y="12.6.0";function Z(t,s={}){let i=t;if("object"!=typeof s){s={name:s}}const n={name:R,automaticDataCollectionEnabled:!0,...s},o=n.name;if("string"!=typeof o||!o)throw W.create("bad-app-name",{appName:String(o)});if(i||(i=e()),!i)throw W.create("no-options");const c=V.get(o);if(c){if(a(i,c.options)&&a(n,c.config))return c;throw W.create("duplicate-app",{appName:o})}const h=new r(o);for(const e of J.values())h.addComponent(e);const p=new X(i,n,h);return V.set(o,p),p}function ee(t=R){const a=V.get(t);if(!a&&t===R&&e())return Z();if(!a)throw W.create("no-app",{appName:t});return a}function te(e,t,a){let r=L[e]??e;a&&(r+=`-${a}`);const i=r.match(/\s|\//),n=t.match(/\s|\//);if(i||n){const e=[`Unable to register library "${r}" with version "${t}":`];return i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&n&&e.push("and"),n&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void d.warn(e.join(" "))}G(new s(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const ae="firebase-heartbeat-store";let re=null;function se(){return re||(re=p("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ae)}catch(a){}}}).catch(e=>{throw W.create("idb-open",{originalErrorMessage:e.message})})),re}async function ie(e,t){try{const a=(await se()).transaction(ae,"readwrite"),r=a.objectStore(ae);await r.put(t,ne(e)),await a.done}catch(a){if(a instanceof h)d.warn(a.message);else{const e=W.create("idb-set",{originalErrorMessage:a?.message});d.warn(e.message)}}}function ne(e){return`${e.name}!${e.options.appId}`}class oe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new he(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=ce();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,a=e[0].date;for(let r=1;r<e.length;r++)e[r].date<a&&(a=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){d.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=ce(),{heartbeatsToSend:t,unsentEntries:a}=function(e,t=1024){const a=[];let r=e.slice();for(const s of e){const e=a.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),pe(a)>t){e.dates.pop();break}}else if(a.push({agent:s.agent,dates:[s.date]}),pe(a)>t){a.pop();break}r=r.slice(1)}return{heartbeatsToSend:a,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=n(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return d.warn(e),""}}}function ce(){return(new Date).toISOString().substring(0,10)}class he{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!o()&&c().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await se()).transaction(ae),a=await t.objectStore(ae).get(ne(e));return await t.done,a}catch(t){if(t instanceof h)d.warn(t.message);else{const e=W.create("idb-get",{originalErrorMessage:t?.message});d.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ie(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ie(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function pe(e){return n(JSON.stringify({version:2,heartbeats:e})).length}var fe;fe="",G(new s("platform-logger",e=>new f(e),"PRIVATE")),G(new s("heartbeat",e=>new oe(e),"PRIVATE")),te(b,l,fe),te(b,l,"esm2020"),te("fire-js","");te("firebase","12.6.0","app");export{Y as S,Q as _,K as a,G as b,ee as g,Z as i,te as r};
