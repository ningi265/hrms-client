import{u as e,r as s,by as t,j as a,aD as r,y as i,h as l,J as n,at as d,aC as o,_ as c,aA as x,am as m,p as u,o as p,aZ as h,X as g,f as b,ah as j,aw as y,a5 as f,ar as v,ap as N,aK as w,ag as C,a1 as S,ax as z,az as k,a7 as D,a4 as q,a8 as T,g as $,bp as A,i as M,l as I,aB as L,av as R,H as P,D as _,ak as O,ac as F,S as E,bz as B,bA as W,aU as U,bB as H,bC as K,an as J,C as V,Z,ae as Y,x as Q,bD as G,aV as X,bE as ee,bF as se,b8 as te,bG as ae,q as re,bq as ie,I as le,aq as ne,U as de,m as oe,be as ce,bH as xe,bI as me,N as ue,bJ as pe,aR as he,t as ge,s as be,aE as je,a9 as ye}from"./react-core-DKrnZdd7.js";import{l as fe}from"./lodash-BC2fgbp_.js";import{m as ve}from"./vendor-framer-motion-DCU7qowG.js";import{u as Ne}from"./context-k3FZ8Vno.js";import{B as we,C as Ce,n as Se,T as ze,r as ke,P as De,t as qe,v as Te,w as $e,x as Ae,y as Me,a as Ie,z as Le,E as Re,G as Pe,o as _e,F as Oe,p as Fe,q as Ee,M as Be,H as We,N as Ue,A as He}from"./mui-material-9NDCc7EL.js";import{g as Ke,h as Je}from"./mui-icons-Upi8wDss.js";const Ve=[{id:1,title:"Item Selection",description:"Choose from catalog or specify custom items",icon:a.jsx(m,{size:16})},{id:2,title:"Request Details",description:"Provide budget, timeline, and justification",icon:a.jsx(C,{size:16})},{id:3,title:"Review & Submit",description:"Verify information and submit for approval",icon:a.jsx(E,{size:16})}],Ze=[{name:"Computing Hardware",icon:a.jsx(B,{size:16}),color:"blue",items:[{name:"Laptop",icon:a.jsx(B,{size:14}),avgCost:"$1,200",leadTime:"3-5 days"},{name:"Desktop Computer",icon:a.jsx(W,{size:14}),avgCost:"$800",leadTime:"2-4 days"},{name:"Tablet",icon:a.jsx(U,{size:14}),avgCost:"$600",leadTime:"1-3 days"},{name:"Monitor",icon:a.jsx(B,{size:14}),avgCost:"$300",leadTime:"1-2 days"},{name:"Keyboard",icon:a.jsx(H,{size:14}),avgCost:"$150",leadTime:"1-2 days"},{name:"Mouse",icon:a.jsx(K,{size:14}),avgCost:"$80",leadTime:"1-2 days"}]},{name:"Office Equipment",icon:a.jsx(C,{size:16}),color:"emerald",items:[{name:"Printer",icon:a.jsx(J,{size:14}),avgCost:"$400",leadTime:"2-3 days"},{name:"Scanner",icon:a.jsx(V,{size:14}),avgCost:"$250",leadTime:"2-3 days"},{name:"Projector",icon:a.jsx(B,{size:14}),avgCost:"$800",leadTime:"3-5 days"},{name:"Whiteboard",icon:a.jsx(C,{size:14}),avgCost:"$200",leadTime:"1-2 days"},{name:"Shredder",icon:a.jsx(C,{size:14}),avgCost:"$150",leadTime:"1-2 days"}]},{name:"Furniture & Workspace",icon:a.jsx(I,{size:16}),color:"purple",items:[{name:"Office Chair",icon:a.jsx(I,{size:14}),avgCost:"$350",leadTime:"5-7 days"},{name:"Standing Desk",icon:a.jsx(I,{size:14}),avgCost:"$600",leadTime:"7-10 days"},{name:"Filing Cabinet",icon:a.jsx(I,{size:14}),avgCost:"$200",leadTime:"3-5 days"},{name:"Bookshelf",icon:a.jsx(I,{size:14}),avgCost:"$180",leadTime:"3-5 days"},{name:"Desk Lamp",icon:a.jsx(Z,{size:14}),avgCost:"$80",leadTime:"1-2 days"}]},{name:"Software & Licenses",icon:a.jsx(Y,{size:16}),color:"amber",items:[{name:"Microsoft Office",icon:a.jsx(C,{size:14}),avgCost:"$150/year",leadTime:"Instant"},{name:"Adobe Creative Suite",icon:a.jsx(Y,{size:14}),avgCost:"$600/year",leadTime:"Instant"},{name:"Project Management Tool",icon:a.jsx(Q,{size:14}),avgCost:"$120/year",leadTime:"Instant"},{name:"Antivirus Software",icon:a.jsx(E,{size:14}),avgCost:"$80/year",leadTime:"Instant"}]},{name:"Network & IT Infrastructure",icon:a.jsx(te,{size:16}),color:"teal",items:[{name:"Network Router",icon:a.jsx(G,{size:14}),avgCost:"$300",leadTime:"2-4 days"},{name:"Ethernet Switch",icon:a.jsx(X,{size:14}),avgCost:"$200",leadTime:"2-4 days"},{name:"External Hard Drive",icon:a.jsx(ee,{size:14}),avgCost:"$120",leadTime:"1-3 days"},{name:"Server Equipment",icon:a.jsx(se,{size:14}),avgCost:"$2,500",leadTime:"7-14 days"}]},{name:"Audio/Visual Equipment",icon:a.jsx(ae,{size:16}),color:"rose",items:[{name:"Headphones",icon:a.jsx(ae,{size:14}),avgCost:"$200",leadTime:"1-3 days"},{name:"Webcam",icon:a.jsx(V,{size:14}),avgCost:"$150",leadTime:"1-3 days"},{name:"Microphone",icon:a.jsx(M,{size:14}),avgCost:"$180",leadTime:"1-3 days"},{name:"Speakers",icon:a.jsx(ae,{size:14}),avgCost:"$250",leadTime:"2-4 days"}]}],Ye=[{name:"New Employee Setup",description:"Complete workstation for new hire",items:["Laptop","Monitor","Office Chair","Keyboard","Mouse"],estimatedCost:"$2,100",category:"Computing Hardware",department:"IT",popular:!0},{name:"Home Office Package",description:"Remote work essentials",items:["Laptop","Webcam","Headphones","Desk Lamp"],estimatedCost:"$1,650",category:"Computing Hardware",department:"HR",popular:!0},{name:"Conference Room Setup",description:"Meeting room equipment",items:["Projector","Webcam","Speakers","Whiteboard"],estimatedCost:"$1,400",category:"Office Equipment",department:"Operations",popular:!1},{name:"Software Developer Kit",description:"Development tools and licenses",items:["Adobe Creative Suite","Project Management Tool","External Hard Drive"],estimatedCost:"$950",category:"Software & Licenses",department:"Engineering",popular:!0}],Qe=[{name:"Standard Requisition Form",category:"General",description:"Standard form for all requisition requests",url:"https://example.com/standard-requisition.pdf",size:"245 KB",downloads:12247,lastUpdated:"Jan 15, 2024",required:!0},{name:"Capital Expenditure Form",category:"Finance",description:"Required for purchases over $5,000",url:"https://example.com/capex-form.pdf",size:"189 KB",downloads:3892,lastUpdated:"Jan 10, 2024",required:!1},{name:"Emergency Purchase Authorization",category:"Urgent",description:"Fast-track approval for critical needs",url:"https://example.com/emergency-form.pdf",size:"156 KB",downloads:1234,lastUpdated:"Jan 8, 2024",required:!1},{name:"IT Security Compliance Form",category:"Security",description:"Security review for IT equipment",url:"https://example.com/security-form.pdf",size:"198 KB",downloads:892,lastUpdated:"Jan 12, 2024",required:!1}];function Ge(){const E=e(),[B,W]=s.useState(0),[U,H]=s.useState(!1),[K,J]=s.useState([]),[V,Z]=s.useState({itemName:"",category:"",selectedItem:"",quantity:"",budgetCode:"",urgency:"",preferredSupplier:"",reason:"",attachment:null,estimatedCost:"",deliveryDate:"",department:"",businessJustification:"",alternativeOptions:"",environmentalImpact:""}),[Y,Q]=s.useState(!1),[G,X]=s.useState(!1),[ee,se]=s.useState(!1),[te,ae]=s.useState(!1),[re,ie]=s.useState(!1),[le,ne]=s.useState(""),[de,oe]=s.useState(Qe),[ce,xe]=s.useState(!1),[me,ue]=s.useState(!1),[pe,he]=s.useState({}),[ge,be]=s.useState(null),[je,ye]=s.useState(!1),[ve,Ne]=s.useState(0),[we,Ce]=s.useState(!1),[Se,ze]=s.useState(null),[ke,De]=s.useState([]),[qe,Te]=s.useState([]),[$e,Ae]=s.useState([]),[Me,Ie]=s.useState(!1),[Le,Re]=s.useState(!1),[Pe,_e]=s.useState(null),Oe="https://backend.nexusmwi.com",Fe=async()=>{try{Ie(!0),_e(null);const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const s=await fetch(`${Oe}/api/departments`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=await s.json(),t=e.data||e;Te(t);const a=t.map(e=>{const s=e.budgetInfo||{};return{code:e.departmentCode||s.code||`${e.name?.replace(/\s+/g,"").toUpperCase()}-Q1-2025`,department:e.name||"Unknown Department",remaining:`MWK ${(s.remaining||(e.budget||0)-(e.actualSpending||0)).toLocaleString()}`,total:`MWK ${(s.total||e.budget||0).toLocaleString()}`,actualSpending:e.actualSpending||0,budget:e.budget||s.total||0,utilizationPercentage:s.utilizationPercentage||0,status:s.status||e.status||"active",allocationStatus:s.allocationStatus||"allocated",period:s.period||`${e.budgetYear||(new Date).getFullYear()}`,departmentId:e._id,departmentHead:e.departmentHead,headEmail:e.headEmail,headPhone:e.headPhone,location:e.location,floor:e.floor,building:e.building,employeeCount:e.employeeCount||0,maxCapacity:e.maxCapacity||0,establishedDate:e.establishedDate}});De(a)}else _e("Failed to fetch departments data")}catch(e){_e(e.message);De([{code:"MAT-827",department:"Mathematics",remaining:"MWK 60,000,000",total:"MWK 60,000,000",actualSpending:0,budget:6e7,utilizationPercentage:0,status:"active",allocationStatus:"allocated",period:"2025"}])}finally{Ie(!1)}},Ee=async()=>{try{Re(!0);const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const s=await fetch(`${Oe}/api/requisitions?limit=10&sort=createdAt&order=desc`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=((await s.json()).data||[]).map((e,s)=>({id:e.requisitionNumber||`REQ-2025-${String(s+1).padStart(3,"0")}`,itemName:e.description||e.itemName||"Unknown Item",quantity:e.quantity||1,status:e.status||"pending",date:e.createdAt?new Date(e.createdAt).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0],budgetCode:e.budgetCode||"N/A",amount:`MWK ${(e.estimatedCost||e.totalCost||0).toLocaleString()}`,urgency:e.urgency||"Medium",department:e.department||"Unknown",approver:e.approver||"Pending Assignment",deliveryDate:e.deliveryDate||null,category:e.category||"General",rejectionReason:e.rejectionReason||null}));Ae(e)}}catch(e){Ae([{id:"REQ-2025-001",itemName:'MacBook Pro 16" M3',quantity:5,status:"approved",date:"2025-01-15",budgetCode:"MAT-827",amount:"MWK 14,995",urgency:"Medium",department:"Mathematics",approver:"Legend",deliveryDate:"2025-01-20",category:"Computing Hardware"}])}finally{Re(!1)}};s.useEffect(()=>{const e=fe.debounce(()=>{localStorage.setItem("requisitionDraft",JSON.stringify(V)),X(!0),setTimeout(()=>X(!1),3e3)},1500);return e(),()=>e.cancel()},[V]),s.useEffect(()=>{const e=localStorage.getItem("requisitionDraft");e&&Z(JSON.parse(e)),Fe(),Ee()},[]),s.useEffect(()=>{if(K.length>0){const e=K.reduce((e,s)=>e+(parseFloat(s.avgCost.replace(/[$,]/g,""))||0)*s.quantity,0);Ne(e)}else V.estimatedCost&&Ne(parseFloat(V.estimatedCost)||0)},[K,V.estimatedCost]);const Be=e=>{const{name:s,value:t}=e.target;Z(e=>({...e,[s]:t})),pe[s]&&he(e=>({...e,[s]:""}))},We=e=>{const s={};return 0===e&&(U?(V.itemName||(s.itemName="Item name is required"),(!V.quantity||V.quantity<=0)&&(s.quantity="Valid quantity is required")):(V.category||(s.category="Category is required"),0===K.length&&(s.selectedItem="At least one item must be selected"))),1===e&&(V.budgetCode||(s.budgetCode="Budget code is required"),V.reason||(s.reason="Business justification is required"),V.department||(s.department="Department is required"),V.reason.length<20&&(s.reason="Please provide a detailed justification (minimum 20 characters)")),he(s),0===Object.keys(s).length},{getRootProps:Ue,getInputProps:He,isDragActive:Ke}=t({onDrop:e=>{Z(s=>({...s,attachment:e[0]}))},accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]},maxSize:10485760}),Je=e=>{be(e),Z(s=>({...s,category:e.category,department:e.department,estimatedCost:e.estimatedCost.replace("$","").replace(",","")})),ie(!1)},Ge=(e,s)=>{const t={...e,category:s.name,categoryColor:s.color,quantity:1,id:Date.now()};Z(e=>({...e,category:s.name})),J(e=>[...e,t])},Xe=e=>{switch(e){case"approved":return"text-emerald-700 bg-emerald-50 border-emerald-200";case"pending":return"text-amber-700 bg-amber-50 border-amber-200";case"rejected":return"text-red-700 bg-red-50 border-red-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}},es=e=>{switch(e){case"approved":return a.jsx(u,{size:12});case"pending":return a.jsx(F,{size:12});case"rejected":return a.jsx(g,{size:12});default:return a.jsx(P,{size:12})}},ss=e=>{const s=ke.find(s=>s.code===e);return s?{...s,remaining:s.budget-s.actualSpending,utilizationPercentage:s.budget>0?s.actualSpending/s.budget*100:0,isHealthy:s.budget>0&&(s.budget-s.actualSpending)/s.budget>.25}:null};return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:a.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>E("/employee-dash"),className:"p-1.5 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors duration-200",children:a.jsx(r,{size:18})}),a.jsx("div",{children:a.jsxs("h1",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx("div",{className:"p-1.5 bg-blue-500 rounded-xl text-white",children:a.jsx(i,{size:20})}),"New Requisition Request"]})})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[G&&a.jsxs("div",{className:"flex items-center text-emerald-600 text-sm bg-emerald-50 px-2 py-1 rounded-xl border border-emerald-200",children:[a.jsx(l,{size:14,className:"mr-1"}),"Draft saved"]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("button",{onClick:()=>ie(!0),className:"px-3 py-1.5 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors duration-200 text-sm font-medium",children:[a.jsx(n,{size:14,className:"mr-1"}),"Templates"]}),a.jsxs("button",{onClick:()=>se(!0),className:"px-3 py-1.5 bg-white text-gray-700 rounded-xl hover:bg-gray-50 transition-colors duration-200 text-sm font-medium border border-gray-200",children:[Le?a.jsx(d,{size:14,className:"mr-1 animate-spin"}):a.jsx(o,{size:14,className:"mr-1"}),"History"]}),a.jsxs("button",{onClick:()=>{Fe()},disabled:Me,className:"px-3 py-1.5 bg-white text-gray-700 rounded-xl hover:bg-gray-50 transition-colors duration-200 text-sm font-medium border border-gray-200",children:[a.jsx(c,{size:14,className:Me?"mr-1 animate-spin":"mr-1"}),"Refresh"]})]})]})]})}),a.jsx("div",{className:"max-w-7xl mx-auto p-3 space-y-3",children:a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-3",children:[a.jsx("div",{className:"xl:col-span-3",children:a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[Ve[B].icon,Ve[B].title]}),ve>0&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl px-2 py-1",children:a.jsxs("span",{className:"text-sm text-blue-600 font-medium",children:["Estimated Total: MWK ",ve.toLocaleString()]})})]})}),a.jsxs("div",{className:"p-4",children:[0===B&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-blue-900 text-sm",children:"Quick Start Templates"}),a.jsx("p",{className:"text-blue-700 text-xs",children:"Pre-configured packages for common requests"})]}),a.jsx("button",{onClick:()=>ie(!0),className:"px-2 py-1 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 text-xs font-medium",children:"View All"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:Ye.filter(e=>e.popular).slice(0,2).map((e,s)=>a.jsxs("button",{onClick:()=>Je(e),className:"p-2 bg-white border border-blue-200 rounded-xl hover:bg-blue-50 transition-colors duration-200 text-left",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("h5",{className:"font-bold text-blue-900 text-xs",children:e.name}),a.jsx(x,{size:12,className:"text-amber-500"})]}),a.jsx("p",{className:"text-xs text-blue-600 mb-1",children:e.description}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("span",{className:"text-xs text-blue-500",children:[e.items.length," items"]}),a.jsx("span",{className:"font-bold text-blue-900 text-xs",children:e.estimatedCost})]})]},s))})]}),a.jsxs("div",{className:"flex items-center p-2 bg-gray-50 rounded-xl border border-gray-200",children:[a.jsx("input",{type:"checkbox",id:"customItem",checked:U,onChange:e=>H(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),a.jsx("label",{htmlFor:"customItem",className:"ml-2 text-sm font-medium text-gray-900",children:"Request custom item not in our catalog"}),a.jsx("div",{className:"ml-auto",children:a.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded border",children:"May require additional approval time"})})]}),U?a.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-3",children:[a.jsxs("h4",{className:"font-bold text-amber-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(m,{size:16}),"Custom Item Request"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Name & Description"}),a.jsx("textarea",{name:"itemName",value:V.itemName,onChange:Be,rows:3,className:"w-full px-3 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none text-sm "+(pe.itemName?"border-red-300":"border-gray-300"),placeholder:"Provide detailed description of the custom item including specifications, model numbers, etc."}),pe.itemName&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:pe.itemName})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estimated Unit Cost (MWK)"}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-3 top-2 text-gray-400 text-sm",children:"MWK"}),a.jsx("input",{type:"number",name:"estimatedCost",value:V.estimatedCost,onChange:Be,className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"0.00"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity Needed"}),a.jsx("input",{type:"number",name:"quantity",value:V.quantity,onChange:Be,min:"1",className:"w-full px-3 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm "+(pe.quantity?"border-red-300":"border-gray-300"),placeholder:"1"}),pe.quantity&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:pe.quantity})]})]})]})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Category"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:Ze.map(e=>a.jsxs("button",{type:"button",onClick:()=>Z(s=>({...s,category:e.name,selectedItem:""})),className:"p-3 border-2 rounded-2xl transition-all duration-200 text-left hover:shadow-sm "+(V.category===e.name?`border-${e.color}-500 bg-${e.color}-50`:"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("div",{className:"p-1.5 rounded-xl "+(V.category===e.name?`bg-${e.color}-100 text-${e.color}-600`:"bg-gray-100 text-gray-600"),children:e.icon}),V.category===e.name&&a.jsx(u,{size:16,className:`text-${e.color}-600`})]}),a.jsx("h3",{className:"font-bold text-gray-900 mb-0.5 text-sm",children:e.name}),a.jsxs("p",{className:"text-xs text-gray-600",children:[e.items.length," items available"]})]},e.name))}),pe.category&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:pe.category})]}),V.category&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Select Items from ",V.category]}),a.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:[K.length," items selected"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-3",children:Ze.find(e=>e.name===V.category)?.items.map((e,s)=>a.jsxs("div",{className:"border border-gray-200 rounded-2xl p-2 hover:shadow-sm transition-shadow duration-200 bg-white",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"p-1.5 bg-gray-100 rounded-xl",children:e.icon}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 text-xs",children:e.name}),a.jsx("p",{className:"text-xs text-gray-500",children:e.avgCost})]})]}),a.jsx("button",{type:"button",onClick:()=>ze(e),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors duration-200",children:a.jsx(p,{size:12})})]}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[a.jsxs("span",{children:["Lead time: ",e.leadTime]}),a.jsx("span",{className:"bg-emerald-100 text-emerald-700 px-1.5 py-0.5 rounded",children:"In Stock"})]}),a.jsx("button",{type:"button",onClick:()=>Ge(e,Ze.find(e=>e.name===V.category)),className:"w-full px-2 py-1.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 text-xs font-medium",children:"Add to Request"})]},s))}),K.length>0&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-3",children:[a.jsxs("h4",{className:"font-bold text-blue-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(h,{size:16}),"Selected Items (",K.length,")"]}),a.jsx("div",{className:"space-y-2",children:K.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-xl border border-blue-200",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:`p-1.5 bg-${e.categoryColor}-100 rounded-xl`,children:e.icon}),a.jsxs("div",{children:[a.jsx("h5",{className:"font-medium text-gray-900 text-xs",children:e.name}),a.jsx("p",{className:"text-xs text-gray-500",children:e.category})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("label",{className:"text-xs text-gray-600",children:"Qty:"}),a.jsx("input",{type:"number",min:"1",value:e.quantity,onChange:s=>{return t=e.id,a=s.target.value,void J(e=>e.map(e=>e.id===t?{...e,quantity:parseInt(a)||1}:e));var t,a},className:"w-10 px-1 py-0.5 border border-gray-300 rounded text-center text-xs"})]}),a.jsxs("span",{className:"font-medium text-gray-900 text-xs",children:["MWK ",(parseFloat(e.avgCost.replace(/[$,]/g,""))*e.quantity).toLocaleString()]}),a.jsx("button",{type:"button",onClick:()=>{return s=e.id,void J(e=>e.filter(e=>e.id!==s));var s},className:"p-1 text-red-400 hover:text-red-600 transition-colors duration-200",children:a.jsx(g,{size:12})})]})]},e.id))}),a.jsx("div",{className:"mt-2 pt-2 border-t border-blue-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-bold text-blue-900 text-sm",children:"Estimated Total:"}),a.jsxs("span",{className:"text-lg font-bold text-blue-900",children:["MWK ",ve.toLocaleString()]})]})})]}),pe.selectedItem&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:pe.selectedItem})]})]})]}),1===B&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Budget Code"}),Me&&a.jsx(d,{size:12,className:"text-blue-500 animate-spin"})]}),a.jsxs("div",{className:"relative",children:[a.jsx(b,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),a.jsxs("select",{name:"budgetCode",value:V.budgetCode,onChange:e=>{Be(e),ye(!0)},disabled:Me,className:`w-full pl-10 pr-3 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm ${pe.budgetCode?"border-red-300":"border-gray-300"} ${Me?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx("option",{value:"",children:"Select Budget Code"}),ke.map(e=>a.jsxs("option",{value:e.code,children:[e.code," - ",e.department]},e.code))]})]}),pe.budgetCode&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:pe.budgetCode}),Pe&&a.jsx("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded-xl",children:a.jsxs("div",{className:"flex items-center gap-1 text-amber-800 text-xs",children:[a.jsx(j,{size:10}),"Budget data connection issue - using cached data"]})}),V.budgetCode&&ss(V.budgetCode)&&a.jsxs("div",{className:"mt-2 p-2 bg-emerald-50 border border-emerald-200 rounded-xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"text-xs font-medium text-emerald-900",children:"Budget Status"}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+("active"===ss(V.budgetCode).status?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-800"),children:ss(V.budgetCode).status?.toUpperCase()||"ACTIVE"}),a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+("allocated"===ss(V.budgetCode).allocationStatus?"bg-blue-100 text-blue-800":"bg-amber-100 text-amber-800"),children:ss(V.budgetCode).allocationStatus?.toUpperCase()||"ALLOCATED"})]})]}),(()=>{const e=ss(V.budgetCode),s=e.remaining,t=e.budget,r=t>0?s/t*100:0;return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsxs("span",{className:"text-emerald-700",children:["Remaining: MWK ",s.toLocaleString()]}),a.jsxs("span",{className:"text-emerald-600",children:["Total: MWK ",t.toLocaleString()]})]}),a.jsx("div",{className:"mt-1 w-full bg-emerald-200 rounded-full h-1.5",children:a.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300 "+(r>50?"bg-emerald-500":r>25?"bg-amber-500":"bg-red-500"),style:{width:`${Math.max(0,Math.min(100,r))}%`}})}),e.period&&a.jsxs("div",{className:"mt-1 text-xs text-emerald-600",children:["Budget Period: ",e.period]})]})})()]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Requesting Department"}),a.jsxs("div",{className:"relative",children:[a.jsx(y,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),a.jsxs("select",{name:"department",value:V.department,onChange:Be,className:"w-full pl-10 pr-3 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm "+(pe.department?"border-red-300":"border-gray-300"),children:[a.jsx("option",{value:"",children:"Select Department"}),ke.map(e=>a.jsx("option",{value:e.department,children:e.department},e.department))]})]}),pe.department&&a.jsx("p",{className:"mt-1 text-xs text-red-600",children:pe.department})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority Level"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{level:"low",label:"Low",color:"emerald",desc:"2-4 weeks"},{level:"medium",label:"Medium",color:"amber",desc:"1-2 weeks"},{level:"high",label:"High",color:"red",desc:"1-3 days"}].map(({level:e,label:s,color:t,desc:r})=>a.jsxs("button",{type:"button",onClick:()=>Z(s=>({...s,urgency:e})),className:"p-2 border-2 rounded-xl transition-all duration-200 text-center "+(V.urgency===e?`border-${t}-500 bg-${t}-50`:"border-gray-300 hover:border-gray-400 hover:bg-gray-50"),children:[a.jsx("div",{className:"font-bold text-sm "+(V.urgency===e?`text-${t}-700`:"text-gray-900"),children:s}),a.jsx("div",{className:"text-xs mt-0.5 "+(V.urgency===e?`text-${t}-600`:"text-gray-500"),children:r})]},e))})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Required Delivery Date"}),a.jsxs("div",{className:"relative",children:[a.jsx(f,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"date",name:"deliveryDate",value:V.deliveryDate,onChange:Be,min:(new Date).toISOString().split("T")[0],className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Leave blank if no specific date required"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Supplier (Optional)"}),a.jsxs("div",{className:"relative",children:[a.jsx(v,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",name:"preferredSupplier",value:V.preferredSupplier,onChange:Be,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"Enter supplier name or 'No preference'"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Environmental Considerations"}),a.jsx("div",{className:"space-y-1",children:["Energy efficient options preferred","Sustainable/recycled materials","Local supplier preference","No specific requirements"].map((e,s)=>a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"environmentalImpact",value:e,checked:V.environmentalImpact===e,onChange:Be,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:e})]},s))})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Justification *"}),a.jsx("textarea",{name:"reason",value:V.reason,onChange:Be,rows:4,className:"w-full px-3 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none text-sm "+(pe.reason?"border-red-300":"border-gray-300"),placeholder:"Explain why this item is needed, how it will be used, and the business impact of not having it. Include any relevant project details or deadlines."}),a.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[pe.reason?a.jsx("p",{className:"text-xs text-red-600",children:pe.reason}):a.jsx("p",{className:"text-xs text-gray-500",children:"Provide detailed justification (minimum 20 characters)"}),a.jsxs("span",{className:"text-xs "+(V.reason.length>=20?"text-emerald-600":"text-gray-400"),children:[V.reason.length,"/20"]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alternative Options Considered (Optional)"}),a.jsx("textarea",{name:"alternativeOptions",value:V.alternativeOptions,onChange:Be,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none text-sm",placeholder:"Describe any alternative solutions you've considered and why this option is preferred."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supporting Documents (Optional)"}),a.jsxs("div",{...Ue(),className:"border-2 border-dashed rounded-xl p-4 text-center cursor-pointer transition-colors duration-200 "+(Ke?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"),children:[a.jsx("input",{...He()}),a.jsx(N,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),a.jsx("p",{className:"text-gray-600 mb-1 font-medium text-sm",children:Ke?"Drop files here...":"Drag and drop files here, or click to browse"}),a.jsx("p",{className:"text-xs text-gray-500",children:"PDF, Word, Excel, or images up to 10MB"})]}),V.attachment&&a.jsx("div",{className:"mt-2 p-2 bg-emerald-50 border border-emerald-200 rounded-xl",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(w,{size:14,className:"text-emerald-600"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-emerald-900",children:V.attachment.name}),a.jsxs("p",{className:"text-xs text-emerald-700",children:[Math.round(V.attachment.size/1024)," KB • Uploaded successfully"]})]})]}),a.jsx("button",{type:"button",onClick:()=>Z(e=>({...e,attachment:null})),className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-100 rounded transition-colors duration-200",children:a.jsx(g,{size:14})})]})})]})]}),2===B&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 border border-blue-200",children:[a.jsxs("h4",{className:"font-bold text-lg text-gray-900 mb-1 flex items-center gap-2",children:[a.jsx(p,{size:18}),"Request Summary"]}),a.jsx("p",{className:"text-gray-600 text-sm",children:"Please review all information carefully before submitting your requisition request."})]}),a.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-3",children:[a.jsxs("h5",{className:"font-bold text-gray-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(m,{size:16}),"Requested Items"]}),U?a.jsx("div",{className:"p-2 bg-amber-50 border border-amber-200 rounded-xl",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h6",{className:"font-medium text-amber-900 text-sm",children:"Custom Item Request"}),a.jsx("p",{className:"text-amber-800 mt-1 text-sm",children:V.itemName}),a.jsxs("div",{className:"mt-1 flex items-center space-x-4 text-xs",children:[a.jsxs("span",{className:"text-amber-700",children:["Quantity: ",V.quantity]}),V.estimatedCost&&a.jsxs("span",{className:"text-amber-700",children:["Est. Cost: MWK ",V.estimatedCost]})]})]}),a.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs font-medium",children:"Custom"})]})}):a.jsxs("div",{className:"space-y-2",children:[K.map((e,s)=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-xl border border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:`p-1.5 bg-${e.categoryColor}-100 rounded-xl`,children:e.icon}),a.jsxs("div",{children:[a.jsx("h6",{className:"font-medium text-gray-900 text-sm",children:e.name}),a.jsx("p",{className:"text-xs text-gray-600",children:e.category})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[e.quantity," × ",e.avgCost]}),a.jsxs("p",{className:"text-xs font-bold text-blue-600",children:["MWK ",(parseFloat(e.avgCost.replace(/[$,]/g,""))*e.quantity).toLocaleString()]})]})]},s)),a.jsx("div",{className:"pt-2 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-bold text-gray-900 text-sm",children:"Total Estimated Cost:"}),a.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["MWK ",ve.toLocaleString()]})]})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-3",children:[a.jsxs("h5",{className:"font-bold text-gray-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(C,{size:16}),"Request Details"]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-gray-100",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Department"}),a.jsx("span",{className:"text-xs font-medium text-gray-900",children:V.department})]}),a.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-gray-100",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Budget Code"}),a.jsxs("div",{className:"text-right",children:[a.jsx("span",{className:"text-xs font-medium text-gray-900",children:V.budgetCode}),a.jsx("button",{onClick:()=>{return e=V.budgetCode,void navigator.clipboard.writeText(e);var e},className:"ml-1 p-0.5 text-gray-400 hover:text-gray-600 transition-colors duration-200",children:a.jsx(S,{size:10})})]})]}),a.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-gray-100",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Priority Level"}),a.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium "+("high"===V.urgency?"bg-red-100 text-red-800":"medium"===V.urgency?"bg-amber-100 text-amber-800":"bg-emerald-100 text-emerald-800"),children:V.urgency?V.urgency.charAt(0).toUpperCase()+V.urgency.slice(1):"Not specified"})]}),V.deliveryDate&&a.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-gray-100",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Required Date"}),a.jsx("span",{className:"text-xs font-medium text-gray-900",children:new Date(V.deliveryDate).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})]}),V.preferredSupplier&&a.jsxs("div",{className:"flex items-center justify-between py-1 border-b border-gray-100",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Preferred Supplier"}),a.jsx("span",{className:"text-xs font-medium text-gray-900",children:V.preferredSupplier})]}),V.environmentalImpact&&a.jsxs("div",{className:"flex items-center justify-between py-1",children:[a.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Environmental Preference"}),a.jsx("span",{className:"text-xs font-medium text-emerald-700 bg-emerald-50 px-1.5 py-0.5 rounded",children:V.environmentalImpact})]})]})]}),a.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-3",children:[a.jsxs("h5",{className:"font-bold text-gray-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(b,{size:16}),"Budget Information"]}),ss(V.budgetCode)&&a.jsx("div",{className:"space-y-2",children:(()=>{const e=ss(V.budgetCode),s=e.remaining,t=e.budget,r=s-ve,i=t>0?s/t*100:0,l=t>0?r/t*100:0;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"p-2 bg-emerald-50 border border-emerald-200 rounded-xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"text-xs font-medium text-emerald-900",children:"Current Budget Status"}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsxs("span",{className:"text-xs bg-emerald-100 text-emerald-800 px-1.5 py-0.5 rounded",children:[i.toFixed(1),"% Available"]}),e.status&&a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+("active"===e.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status.toUpperCase()})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-emerald-700",children:"Available:"}),a.jsxs("span",{className:"ml-1 font-bold",children:["MWK ",s.toLocaleString()]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-emerald-700",children:"Total Budget:"}),a.jsxs("span",{className:"ml-1 font-bold",children:["MWK ",t.toLocaleString()]})]})]}),a.jsx("div",{className:"mt-1 w-full bg-emerald-200 rounded-full h-1.5",children:a.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300 "+(i>50?"bg-emerald-500":i>25?"bg-amber-500":"bg-red-500"),style:{width:`${Math.max(0,Math.min(100,i))}%`}})}),e.period&&a.jsxs("div",{className:"mt-1 text-xs text-emerald-600",children:["Budget Period: ",e.period]})]}),a.jsxs("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded-xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"text-xs font-medium text-blue-900",children:"After This Purchase"}),a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+(l>=0?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"),children:l>=0?`${l.toFixed(1)}% Remaining`:"Over Budget"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-blue-700",children:"Request Cost:"}),a.jsxs("span",{className:"ml-1 font-bold",children:["MWK ",ve.toLocaleString()]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-blue-700",children:"Remaining:"}),a.jsxs("span",{className:"ml-1 font-bold "+(r>=0?"text-blue-900":"text-red-600"),children:["MWK ",r.toLocaleString()]})]})]}),r<0&&a.jsx("div",{className:"mt-1 p-1.5 bg-red-100 border border-red-200 rounded text-xs text-red-800",children:"⚠️ This request exceeds available budget. Additional approval may be required."})]}),(e.departmentHead||e.location)&&a.jsxs("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded-xl",children:[a.jsx("h6",{className:"text-xs font-medium text-gray-900 mb-1",children:"Department Details"}),a.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600",children:[e.departmentHead&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Department Head:"}),a.jsx("span",{className:"font-medium",children:e.departmentHead})]}),e.location&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Location:"}),a.jsx("span",{className:"font-medium",children:e.location})]}),void 0!==e.employeeCount&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Employees:"}),a.jsx("span",{className:"font-medium",children:e.employeeCount})]})]})]})]})})()})]})]}),a.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-3",children:[a.jsxs("h5",{className:"font-bold text-gray-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(z,{size:16}),"Business Justification"]}),a.jsx("div",{className:"p-2 bg-gray-50 rounded-xl border border-gray-200",children:a.jsx("p",{className:"text-gray-800 leading-relaxed text-sm",children:V.reason})}),V.alternativeOptions&&a.jsxs("div",{className:"mt-2",children:[a.jsx("h6",{className:"font-medium text-gray-900 mb-1 text-sm",children:"Alternative Options Considered"}),a.jsx("div",{className:"p-2 bg-gray-50 rounded-xl border border-gray-200",children:a.jsx("p",{className:"text-gray-800 leading-relaxed text-sm",children:V.alternativeOptions})})]})]}),V.attachment&&a.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-3",children:[a.jsxs("h5",{className:"font-bold text-gray-900 mb-2 flex items-center gap-2 text-sm",children:[a.jsx(w,{size:16}),"Supporting Documents"]}),a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-xl border border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(C,{size:14,className:"text-blue-600"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:V.attachment.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:[Math.round(V.attachment.size/1024)," KB • ",V.attachment.type]})]})]}),a.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 transition-colors duration-200",children:a.jsx(k,{size:14})})]})]}),pe.submission&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[a.jsx(j,{size:16}),a.jsx("span",{className:"font-medium text-sm",children:"Submission Error"})]}),a.jsx("p",{className:"text-red-700 mt-1 text-sm",children:pe.submission})]})]})]}),a.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-100 flex justify-between",children:[a.jsxs("button",{type:"button",onClick:()=>{W(e=>e-1)},disabled:0===B,className:"px-3 py-1.5 text-gray-600 border border-gray-300 rounded-xl hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center gap-2 font-medium text-sm",children:[a.jsx(D,{size:14}),"Previous"]}),a.jsx("div",{className:"flex space-x-2",children:B===Ve.length-1?a.jsx("button",{type:"button",onClick:()=>xe(!0),disabled:Y,className:"px-4 py-1.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 transition-colors duration-200 flex items-center gap-2 font-medium text-sm",children:Y?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"}),"Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx(q,{size:14}),"Submit Request"]})}):a.jsxs("button",{type:"button",onClick:()=>{We(B)&&W(e=>e+1)},className:"px-4 py-1.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 flex items-center gap-2 font-medium text-sm",children:["Continue",a.jsx(T,{size:14})]})})]})]})}),a.jsxs("div",{className:"space-y-3",children:[V.budgetCode&&ss(V.budgetCode)&&a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-2 flex items-center gap-2",children:[a.jsx($,{size:16,className:"text-emerald-500"}),"Budget Status"]}),(()=>{const e=ss(V.budgetCode),s=e.remaining,t=e.budget,r=t>0?s/t*100:0;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"p-2 bg-emerald-50 rounded-xl border border-emerald-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"text-xs font-medium text-emerald-900",children:"Budget Health"}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+(r>50?"bg-emerald-100 text-emerald-800":r>25?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800"),children:r>50?"Healthy":r>25?"Moderate":"Critical"}),e.allocationStatus&&a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded "+("allocated"===e.allocationStatus?"bg-blue-100 text-blue-800":"bg-amber-100 text-amber-800"),children:e.allocationStatus.toUpperCase()})]})]}),a.jsx("div",{className:"w-full bg-emerald-200 rounded-full h-1.5 mb-1",children:a.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500 "+(r>50?"bg-emerald-500":r>25?"bg-amber-500":"bg-red-500"),style:{width:`${Math.max(0,Math.min(100,r))}%`}})}),a.jsxs("div",{className:"text-xs text-emerald-700",children:["MWK ",s.toLocaleString()," of MWK ",t.toLocaleString()," remaining"]})]}),a.jsxs("div",{className:"text-xs text-gray-500 space-y-0.5",children:[a.jsxs("p",{children:["• Budget year: ",e.period||(new Date).getFullYear()]}),a.jsxs("p",{children:["• Utilization: ",e.utilizationPercentage?.toFixed(1)||"0.0","%"]}),ve>0&&a.jsxs("p",{children:["• This request uses ",(ve/t*100).toFixed(1),"% of total budget"]}),e.departmentHead&&a.jsxs("p",{children:["• Approver: ",e.departmentHead]})]})]})})()]}),a.jsxs("div",{className:"bg-purple-50 rounded-2xl border border-purple-200 p-3",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1 flex items-center gap-2",children:[a.jsx(A,{size:16,className:"text-purple-500"}),"Need Help?"]}),a.jsx("p",{className:"text-gray-600 text-sm mb-2",children:"Get assistance with your requisition or learn about procurement policies."}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("button",{className:"w-full text-left px-2 py-1.5 text-sm text-purple-700 hover:bg-purple-100 rounded-xl transition-colors duration-200 flex items-center gap-2",children:[a.jsx(A,{size:12}),"Guidelines"]}),a.jsxs("button",{className:"w-full text-left px-2 py-1.5 text-sm text-purple-700 hover:bg-purple-100 rounded-xl transition-colors duration-200 flex items-center gap-2",children:[a.jsx(z,{size:12}),"Live Chat"]}),a.jsxs("button",{className:"w-full text-left px-2 py-1.5 text-sm text-purple-700 hover:bg-purple-100 rounded-xl transition-colors duration-200 flex items-center gap-2",children:[a.jsx(M,{size:12}),"Call Support"]})]})]})]})]})}),re&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-blue-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(n,{size:18,className:"text-amber-500"}),"Quick Start Templates"]}),a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Pre-configured packages for common business needs"})]}),a.jsx("button",{onClick:()=>ie(!1),className:"p-1.5 hover:bg-gray-100 rounded-xl transition-colors duration-200",children:a.jsx(g,{size:18})})]})}),a.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Ye.map((e,s)=>a.jsxs("div",{className:"border border-gray-200 rounded-2xl p-3 hover:shadow-md transition-shadow duration-200 cursor-pointer relative",onClick:()=>Je(e),children:[e.popular&&a.jsx("div",{className:"absolute -top-1 -right-1 bg-amber-500 text-white px-2 py-1 rounded text-xs font-bold",children:"POPULAR"}),a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-bold text-gray-900 mb-1 text-sm",children:e.name}),a.jsx("p",{className:"text-gray-600 text-xs",children:e.description})]}),a.jsxs("div",{className:"ml-3 text-right",children:[a.jsx("div",{className:"text-lg font-bold text-emerald-600",children:e.estimatedCost}),a.jsxs("div",{className:"text-xs text-gray-500",children:[e.items.length," items"]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Includes:"}),a.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[e.items.slice(0,3).map((e,s)=>a.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded text-xs",children:e},s)),e.items.length>3&&a.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded text-xs",children:["+",e.items.length-3," more"]})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[a.jsx(I,{size:10}),a.jsx("span",{children:e.department})]}),a.jsx("button",{className:"px-2 py-1 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 text-xs font-medium",children:"Use Template"})]})]})]},s))})})]})}),ee&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-2xl max-w-6xl w-full max-h-[80vh] overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-emerald-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(o,{size:18,className:"text-blue-500"}),"Requisition History"]}),a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Track all your previous requests and their status"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("button",{onClick:Ee,disabled:Le,className:"px-2 py-1.5 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition-colors duration-200 text-sm font-medium flex items-center gap-1",children:[a.jsx(c,{size:12,className:Le?"animate-spin":""}),"Refresh"]}),a.jsxs("button",{className:"px-2 py-1.5 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition-colors duration-200 text-sm font-medium flex items-center gap-1",children:[a.jsx(L,{size:12}),"Filter"]}),a.jsx("button",{onClick:()=>se(!1),className:"p-1.5 hover:bg-gray-100 rounded-xl transition-colors duration-200",children:a.jsx(g,{size:18})})]})]})}),a.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:Le?a.jsxs("div",{className:"flex items-center justify-center py-8",children:[a.jsx(d,{size:28,className:"animate-spin text-gray-400"}),a.jsx("span",{className:"ml-3 text-gray-600",children:"Loading history..."})]}):a.jsx("div",{className:"space-y-2",children:$e.map(e=>a.jsx("div",{className:"border border-gray-200 rounded-2xl p-3 hover:shadow-sm transition-shadow duration-200 bg-white",children:a.jsx("div",{className:"flex items-start justify-between mb-2",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[a.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:e.itemName}),a.jsxs("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium border ${Xe(e.status)}`,children:[es(e.status),a.jsx("span",{className:"ml-1",children:e.status})]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-2 text-xs mb-2",children:[a.jsxs("div",{className:"bg-blue-50 rounded-xl p-1.5",children:[a.jsx("span",{className:"text-blue-600 font-medium text-xs",children:"Request ID"}),a.jsx("p",{className:"font-bold text-blue-900 text-xs",children:e.id})]}),a.jsxs("div",{className:"bg-gray-50 rounded-xl p-1.5",children:[a.jsx("span",{className:"text-gray-600 font-medium text-xs",children:"Quantity"}),a.jsx("p",{className:"font-bold text-gray-900 text-xs",children:e.quantity})]}),a.jsxs("div",{className:"bg-emerald-50 rounded-xl p-1.5",children:[a.jsx("span",{className:"text-emerald-600 font-medium text-xs",children:"Amount"}),a.jsx("p",{className:"font-bold text-emerald-900 text-xs",children:e.amount})]}),a.jsxs("div",{className:"bg-purple-50 rounded-xl p-1.5",children:[a.jsx("span",{className:"text-purple-600 font-medium text-xs",children:"Department"}),a.jsx("p",{className:"font-bold text-purple-900 text-xs",children:e.department})]}),a.jsxs("div",{className:"bg-amber-50 rounded-xl p-1.5",children:[a.jsx("span",{className:"text-amber-600 font-medium text-xs",children:"Priority"}),a.jsx("p",{className:"font-bold text-amber-900 text-xs",children:e.urgency})]}),a.jsxs("div",{className:"bg-indigo-50 rounded-xl p-1.5",children:[a.jsx("span",{className:"text-indigo-600 font-medium text-xs",children:"Submitted"}),a.jsx("p",{className:"font-bold text-indigo-900 text-xs",children:e.date})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3 text-xs text-gray-600",children:[a.jsxs("span",{children:["Budget: ",e.budgetCode]}),a.jsxs("span",{children:["Approver: ",e.approver]}),e.deliveryDate&&a.jsxs("span",{children:["Expected: ",e.deliveryDate]})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx("button",{className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors duration-200",children:a.jsx(p,{size:12})}),a.jsx("button",{className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors duration-200",children:a.jsx(S,{size:12})}),a.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-xl transition-colors duration-200",children:a.jsx(R,{size:12})})]})]}),e.rejectionReason&&a.jsxs("div",{className:"mt-2 p-1.5 bg-red-50 border border-red-200 rounded-xl",children:[a.jsxs("div",{className:"flex items-center gap-1 text-red-800 text-xs font-medium mb-1",children:[a.jsx(P,{size:10}),"Rejection Reason"]}),a.jsx("p",{className:"text-red-700 text-xs",children:e.rejectionReason})]})]})})},e.id))})})]})}),te&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-2xl max-w-5xl w-full max-h-[80vh] overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-amber-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(_,{size:18,className:"text-amber-500"}),"Download Forms & Documents"]}),a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Access all required forms and supporting documentation"})]}),a.jsx("button",{onClick:()=>ae(!1),className:"p-1.5 hover:bg-gray-100 rounded-xl transition-colors duration-200",children:a.jsx(g,{size:18})})]})}),a.jsxs("div",{className:"p-4",children:[a.jsx("div",{className:"mb-3",children:a.jsxs("div",{className:"relative",children:[a.jsx(O,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search forms and documents...",value:le,onChange:e=>{ne(e.target.value),oe(Qe.filter(s=>s.name.toLowerCase().includes(e.target.value.toLowerCase())||s.category.toLowerCase().includes(e.target.value.toLowerCase())||s.description.toLowerCase().includes(e.target.value.toLowerCase())))},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-[50vh] overflow-y-auto",children:de.map((e,s)=>a.jsxs("div",{className:"border border-gray-200 rounded-2xl p-3 hover:shadow-md transition-shadow duration-200 bg-white",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("div",{className:"p-1.5 bg-blue-100 rounded-xl",children:a.jsx(C,{size:18,className:"text-blue-600"})}),a.jsxs("div",{className:"flex flex-col items-end space-y-1",children:[a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded font-medium "+(e.required?"bg-red-100 text-red-800":"bg-gray-100 text-gray-600"),children:e.category}),e.required&&a.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-1.5 py-0.5 rounded font-medium",children:"Required"})]})]}),a.jsx("h3",{className:"font-bold text-gray-900 mb-1 text-sm",children:e.name}),a.jsx("p",{className:"text-gray-600 text-xs mb-2",children:e.description}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(C,{size:8}),e.size]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(_,{size:8}),e.downloads.toLocaleString()]})]}),a.jsxs("span",{children:["Updated ",e.lastUpdated]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("button",{onClick:()=>window.open(e.url,"_blank"),className:"flex-1 flex items-center justify-center px-2 py-1.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 text-xs font-medium",children:[a.jsx(_,{size:12,className:"mr-1"}),"Download"]}),a.jsx("button",{className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors duration-200",children:a.jsx(k,{size:12})})]})]},s))}),0===de.length&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx(C,{size:36,className:"mx-auto text-gray-300 mb-3"}),a.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"No forms found"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Try adjusting your search terms or browse all categories."})]})]})]})}),ce&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full",children:a.jsxs("div",{className:"p-4 text-center",children:[a.jsx("div",{className:"flex items-center justify-center w-14 h-14 mx-auto bg-blue-500 rounded-2xl mb-3",children:a.jsx(q,{size:20,className:"text-white"})}),a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Submit Requisition Request?"}),a.jsxs("div",{className:"text-gray-600 mb-4 space-y-2",children:[a.jsx("p",{className:"text-sm",children:"You're about to submit a requisition request for:"}),a.jsxs("div",{className:"bg-blue-50 rounded-xl p-2 border border-blue-200",children:[a.jsx("div",{className:"font-bold text-blue-900 text-sm",children:U?V.itemName:K.map(e=>e.name).join(", ")}),a.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Estimated Total: MWK ",ve.toLocaleString()]})]}),a.jsx("p",{className:"text-xs",children:"This action cannot be undone once submitted."})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:()=>xe(!1),className:"flex-1 px-3 py-1.5 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors duration-200 font-medium text-sm",children:"Review Again"}),a.jsx("button",{onClick:async()=>{if(We(2)){Q(!0);try{let e=0;U?V.estimatedCost&&(e=parseFloat(V.estimatedCost.toString().replace(/[$,]/g,""))||0):e=K.reduce((e,s)=>e+(parseFloat(s.avgCost.replace(/[$,]/g,""))||0)*s.quantity,0);const s={itemName:U?V.itemName:K.map(e=>e.name).join(", "),quantity:U?parseInt(V.quantity)||1:K.reduce((e,s)=>e+(s.quantity||1),0),budgetCode:V.budgetCode,urgency:V.urgency||"medium",preferredSupplier:V.preferredSupplier||"No preference",reason:V.reason,category:U?V.category:K.length>0?K[0].category:"",estimatedCost:e,deliveryDate:V.deliveryDate||null,department:V.department,environmentalImpact:V.environmentalImpact||"No specific requirements"};if(!s.itemName)throw new Error("Item name is required");if(!s.budgetCode)throw new Error("Budget code is required");if(!s.reason)throw new Error("Business justification is required");if(!s.department)throw new Error("Department is required");if(s.estimatedCost<=0)throw new Error("Estimated cost must be greater than 0");const t=localStorage.getItem("token");if(!t)throw new Error("No authentication token found. Please log in again.");const a=await fetch(`${Oe}/api/requisitions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!a.ok){const e=await a.json();throw new Error(e.message||`Submission failed with status: ${a.status}`)}await a.json();xe(!1),ue(!0),localStorage.removeItem("requisitionDraft"),Z({itemName:"",category:"",selectedItem:"",quantity:"",budgetCode:"",urgency:"",preferredSupplier:"",reason:"",attachment:null,estimatedCost:"",deliveryDate:"",department:"",businessJustification:"",alternativeOptions:"",environmentalImpact:""}),J([]),W(0),H(!1),Fe(),Ee()}catch(e){he(s=>({...s,submission:e.message||"Failed to submit requisition. Please try again."}))}finally{Q(!1)}}},disabled:Y,className:"flex-1 px-3 py-1.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 transition-colors duration-200 font-medium text-sm",children:Y?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full mr-2"}),"Submitting..."]}):"Confirm & Submit"})]})]})})}),me&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full",children:a.jsxs("div",{className:"p-4 text-center",children:[a.jsx("div",{className:"flex items-center justify-center w-16 h-16 mx-auto bg-emerald-500 rounded-2xl mb-3",children:a.jsx(u,{size:28,className:"text-white"})}),a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Request Submitted Successfully! 🎉"}),a.jsxs("div",{className:"text-gray-600 mb-4 space-y-2",children:[a.jsx("p",{className:"text-sm",children:"Your requisition has been successfully submitted and assigned tracking number:"}),a.jsx("div",{className:"bg-emerald-50 rounded-xl p-2 border border-emerald-200",children:a.jsxs("div",{className:"text-lg font-bold text-emerald-900 font-mono",children:["REQ-",(new Date).getFullYear(),"-",String(Math.floor(1e3*Math.random())).padStart(3,"0")]})}),a.jsxs("div",{className:"text-xs space-y-0.5",children:[a.jsx("p",{children:"✅ Department manager will be notified"}),a.jsx("p",{children:"✅ Procurement team will begin sourcing"}),a.jsx("p",{children:"✅ You'll receive email updates on progress"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("button",{onClick:()=>{ue(!1),E("/employee-dash")},className:"w-full px-3 py-1.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 font-medium text-sm",children:"Return to Dashboard"}),a.jsx("button",{onClick:()=>{ue(!1),Z({itemName:"",category:"",selectedItem:"",quantity:"",budgetCode:"",urgency:"",preferredSupplier:"",reason:"",attachment:null,estimatedCost:"",deliveryDate:"",department:"",businessJustification:"",alternativeOptions:"",environmentalImpact:""}),J([]),W(0),H(!1)},className:"w-full px-3 py-1.5 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors duration-200 font-medium text-sm",children:"Create Another Request"})]})]})})}),Se&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full",children:a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Item Details"}),a.jsx("button",{onClick:()=>ze(null),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-xl transition-colors duration-200",children:a.jsx(g,{size:16})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-14 h-14 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-2",children:Se.icon}),a.jsx("h4",{className:"font-bold text-gray-900",children:Se.name})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{className:"bg-gray-50 rounded-xl p-2",children:[a.jsx("span",{className:"text-gray-600 font-medium text-xs",children:"Average Cost"}),a.jsx("p",{className:"font-bold text-gray-900 text-sm",children:Se.avgCost})]}),a.jsxs("div",{className:"bg-gray-50 rounded-xl p-2",children:[a.jsx("span",{className:"text-gray-600 font-medium text-xs",children:"Lead Time"}),a.jsx("p",{className:"font-bold text-gray-900 text-sm",children:Se.leadTime})]})]}),a.jsxs("div",{className:"bg-blue-50 rounded-xl p-2 border border-blue-200",children:[a.jsx("h5",{className:"font-medium text-blue-900 mb-1 text-sm",children:"Specifications"}),a.jsxs("ul",{className:"text-xs text-blue-800 space-y-0.5",children:[a.jsx("li",{children:"• Standard business quality"}),a.jsx("li",{children:"• Warranty included"}),a.jsx("li",{children:"• Compatible with existing systems"}),a.jsx("li",{children:"• Energy efficient design"})]})]}),a.jsx("button",{onClick:()=>{const e=Ze.find(e=>e.items.some(e=>e.name===Se.name));Ge(Se,e),ze(null)},className:"w-full px-3 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 font-medium text-sm",children:"Add to Request"})]})]})})})]})}const Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"})),es=({isVisible:e,message:s="Processing..."})=>e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-2xl p-6 flex items-center gap-3",children:[a.jsx(d,{className:"animate-spin w-6 h-6 text-blue-500"}),a.jsx("span",{className:"font-medium",children:s})]})}):null,ss=({request:e,onMenuClick:s,showMenuId:t,onAction:r})=>{const i=e=>{switch(e?.toLowerCase()){case"flight":return"bg-blue-100 text-blue-800";case"train":return"bg-green-100 text-green-800";case"car":return"bg-amber-100 text-amber-800";default:return"bg-gray-100 text-gray-800"}},l=e=>{switch(e?.toLowerCase()){case"flight":return a.jsx(ie,{size:12});case"train":return a.jsx(xe,{size:12});case"car":return a.jsx(ce,{size:12});default:return a.jsx(m,{size:12})}},n=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),d=e.employee?.lastName||"N/A",o=((e,s)=>{const t=new Date(e),a=new Date(s),r=Math.abs(a-t);return Math.ceil(r/864e5)})(e.departureDate,e.returnDate);return a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-2 hover:shadow-sm transition-shadow",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("div",{className:"p-1.5 bg-blue-50 rounded-xl",children:a.jsx(de,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-sm text-gray-900",children:d}),a.jsx("p",{className:"text-xs text-gray-500",children:e.location||"N/A"})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full flex items-center gap-1 ${i(e.meansOfTravel)}`,children:[l(e.meansOfTravel),a.jsx("span",{className:"ml-1",children:e.meansOfTravel})]})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-1.5 mb-1.5",children:[a.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded-xl",children:[a.jsxs("div",{className:"text-base font-bold text-gray-900 flex items-center justify-center gap-1",children:[a.jsx(f,{className:"w-3 h-3 text-purple-500"}),o]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Days"})]}),a.jsxs("div",{className:"text-center p-1.5 bg-gray-50 rounded-xl",children:[a.jsxs("div",{className:"text-base font-bold text-gray-900 flex items-center justify-center gap-1",children:[a.jsx(oe,{className:"w-3 h-3 text-red-500"}),e.location?.split(",")[0]||"N/A"]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Destination"})]})]}),a.jsxs("div",{className:"space-y-0.5 mb-1.5",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-gray-600",children:"Departure"}),a.jsx("span",{className:"text-xs font-medium",children:n(e.departureDate)})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-gray-600",children:"Return"}),a.jsx("span",{className:"text-xs font-medium",children:n(e.returnDate)})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-gray-600",children:"Funding Code"}),a.jsx("span",{className:"text-xs font-medium font-mono truncate",children:e.fundingCodes||"N/A"})]})]}),a.jsxs("div",{className:"mb-1.5",children:[a.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Travel Method"}),a.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full flex items-center gap-1 w-fit ${i(e.meansOfTravel)}`,children:[l(e.meansOfTravel),e.meansOfTravel||"Unknown"]})]}),a.jsxs("div",{className:"flex justify-between items-center pt-1.5 border-t border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-50 rounded-full flex items-center justify-center",children:a.jsx(ie,{size:12,className:"text-blue-600"})}),a.jsxs("span",{className:"text-xs text-gray-500",children:[o," day trip"]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("button",{"data-request-id":e._id,onClick:()=>s(e._id),className:"p-1 text-gray-400 hover:text-blue-600 rounded-xl",children:a.jsx(R,{size:14})}),a.jsxs("button",{onClick:()=>r(e._id,"approved"),className:"px-2 py-1 bg-green-500 text-white rounded-lg text-xs font-medium hover:bg-green-600 transition-colors flex items-center gap-1",children:[a.jsx(le,{size:12}),"Approve"]}),a.jsxs("button",{onClick:()=>r(e._id,"rejected"),className:"px-2 py-1 bg-red-500 text-white rounded-lg text-xs font-medium hover:bg-red-600 transition-colors flex items-center gap-1",children:[a.jsx(g,{size:12}),"Reject"]})]})]})]})},ts=[{_id:"1",employee:{_id:"e1",name:"John Smith"},departureDate:"2025-05-15T00:00:00.000Z",returnDate:"2025-05-22T00:00:00.000Z",location:"New York, NY",fundingCodes:"FIN-2025-001",meansOfTravel:"Flight"},{_id:"2",employee:{_id:"e2",name:"Sarah Johnson"},departureDate:"2025-06-01T00:00:00.000Z",returnDate:"2025-06-05T00:00:00.000Z",location:"Chicago, IL",fundingCodes:"FIN-2025-002",meansOfTravel:"Train"},{_id:"3",employee:{_id:"e3",name:"Michael Chen"},departureDate:"2025-05-20T00:00:00.000Z",returnDate:"2025-05-27T00:00:00.000Z",location:"San Francisco, CA",fundingCodes:"FIN-2025-003",meansOfTravel:"Flight"},{_id:"4",employee:{_id:"e4",name:"Emily Davis"},departureDate:"2025-06-10T00:00:00.000Z",returnDate:"2025-06-15T00:00:00.000Z",location:"Austin, TX",fundingCodes:"FIN-2025-004",meansOfTravel:"Car"}],as=()=>{const[t,r]=s.useState([]),[i,l]=s.useState(!0),[n,d]=s.useState(""),[x,m]=s.useState("all"),[u,h]=s.useState(!1),[b,y]=s.useState(""),[f,v]=s.useState("success"),[N,w]=s.useState(!1),[k,D]=s.useState(null),[T,$]=s.useState(null),[A,M]=s.useState(!1),[I,L]=s.useState(null),R=e(),P="https://backend.nexusmwi.com";s.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${P}/api/travel-requests/pending/all`,{headers:{Authorization:`Bearer ${e||"preview-token"}`}});if(!s.ok)throw new Error("Failed to fetch pending travel requests");const t=await s.json();r(t),M(!1)}catch(e){r(ts),M(!0),"undefined"==typeof window||"localhost"===window.location.hostname||window.location.hostname.includes("vercel.app")||E("Failed to fetch pending travel requests","error")}finally{setTimeout(()=>{l(!1)},800)}})()},[P]);const _=t.filter(e=>{const s=e.employee?.name?.toLowerCase().includes(n.toLowerCase())||e.location?.toLowerCase().includes(n.toLowerCase())||e.meansOfTravel?.toLowerCase().includes(n.toLowerCase())||!1,t="all"===x||e.meansOfTravel===x;return s&&t}),F=t?.length||0;t?.filter(e=>"Flight"===e.meansOfTravel),t?.filter(e=>"Train"===e.meansOfTravel),t?.filter(e=>"Car"===e.meansOfTravel);const E=(e,s="success")=>{y(e),v(s),h(!0),setTimeout(()=>h(!1),5e3)},B=(e,s)=>{D(e),$(s),w(!0),L(null)},W=()=>{w(!1),D(null),$(null)},U=()=>{l(!0),setTimeout(()=>l(!1),1e3),window.location.reload()};return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(es,{isVisible:i,message:"Loading travel requests..."}),a.jsxs("main",{className:"p-4 space-y-4 max-w-7xl mx-auto",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(O,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search travel requests...",value:n,onChange:e=>d(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white"})]}),a.jsxs("select",{value:x,onChange:e=>m(e.target.value),className:"px-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white",children:[a.jsx("option",{value:"all",children:"All Travel Types"}),a.jsx("option",{value:"Flight",children:"Flight"}),a.jsx("option",{value:"Train",children:"Train"}),a.jsx("option",{value:"Car",children:"Car"})]}),a.jsx("button",{onClick:U,disabled:i,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-2xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:a.jsx(c,{size:16,className:i?"animate-spin":""})}),a.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-2xl font-medium hover:bg-blue-600 transition-colors",children:[a.jsx(re,{size:16}),"New Request"]})]})}),A&&a.jsx(ve.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-amber-50 border border-amber-200 rounded-2xl p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-amber-100 rounded-xl",children:a.jsx(j,{size:20,className:"text-amber-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-amber-800",children:"Preview Mode Active"}),a.jsx("p",{className:"text-amber-700 text-sm",children:"Using mock data for preview. In production, this would connect to your backend API."})]})]})}),a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ie,{className:"w-5 h-5 text-gray-600"}),a.jsx("h3",{className:"font-semibold text-gray-900",children:"Travel Requests"})]}),a.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:a.jsxs("span",{children:[_.length," of ",F," requests"]})})]}),0===_.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:a.jsx(ie,{size:32,className:"text-gray-400"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:n||"all"!==x?"No travel requests match your filters":"No Pending Travel Requests"}),a.jsx("p",{className:"text-gray-500 mb-4",children:n||"all"!==x?"Try adjusting your search criteria or filters.":"There are currently no travel requests waiting for your approval."}),a.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-2xl font-medium hover:bg-blue-600 mx-auto",children:[a.jsx(c,{size:16}),"Refresh"]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:_.map(e=>a.jsx(ss,{request:e,onMenuClick:L,showMenuId:I,onAction:B},e._id))})]})]}),I&&a.jsxs(a.Fragment,{children:[a.jsx(ve.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] bg-black/5",onClick:()=>L(null),transition:{duration:.1}}),a.jsx(ve.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"fixed z-[101] w-56 bg-white rounded-2xl shadow-xl border border-gray-200",style:{top:(()=>{const e=document.querySelector(`[data-request-id="${I}"]`);if(e){return`${e.getBoundingClientRect().bottom+window.scrollY}px`}return"50px"})(),left:(()=>{const e=document.querySelector(`[data-request-id="${I}"]`);if(e){const s=e.getBoundingClientRect(),t=224;return s.right+window.scrollX+t>window.innerWidth?window.innerWidth-t-8+"px":`${s.right-t+window.scrollX}px`}return"50px"})()},transition:{duration:.1,ease:"easeOut"},children:a.jsx("div",{className:"py-1",children:[{icon:p,label:"View Details",action:()=>{R(`/dashboard/travel-requests/${I}`)}},{icon:le,label:"Approve",action:()=>B(I,"approved"),color:"green"},{icon:g,label:"Reject",action:()=>B(I,"rejected"),color:"red"},{type:"divider"},{icon:ne,label:"Edit Request",action:()=>{}},{icon:q,label:"Send Message",action:()=>{}},{icon:S,label:"Copy Details",action:()=>{}},{icon:C,label:"Download PDF",action:()=>{}},{icon:o,label:"View History",action:()=>{}},{icon:z,label:"Contact Employee",action:()=>{}}].map((e,s)=>"divider"===e.type?a.jsx("div",{className:"border-t border-gray-100 my-1"},`divider-${s}`):a.jsxs("button",{onClick:()=>{e.action(),L(null)},className:"w-full flex items-center gap-3 px-4 py-2 text-left text-sm rounded-xl "+("green"===e.color?"text-green-600 hover:bg-green-50":"red"===e.color?"text-red-600 hover:bg-red-50":"text-gray-700 hover:bg-blue-50 hover:text-blue-600"),children:[a.jsx(e.icon,{size:16,className:"text-gray-500"}),a.jsx("span",{children:e.label})]},e.label))})})]}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full shadow-2xl",children:[a.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:["approved"===T?a.jsx(le,{size:18,className:"text-green-500"}):a.jsx(g,{size:18,className:"text-red-500"}),"Confirm Decision"]}),a.jsx("button",{onClick:W,className:"p-1.5 hover:bg-gray-100 rounded-2xl",children:a.jsx(g,{size:18})})]})}),a.jsxs("div",{className:"p-5",children:[a.jsxs("p",{className:"text-gray-700 mb-4 text-sm",children:["Are you sure you want to mark this travel request as"," ",a.jsx("span",{className:"font-semibold "+("approved"===T?"text-green-600":"text-red-600"),children:T}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:W,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors font-medium text-sm",children:"Cancel"}),a.jsxs("button",{onClick:()=>{(async(e,s)=>{try{if(A)return r(s=>s.filter(s=>s._id!==e)),void E(`Travel request ${s} successfully! (Preview mode)`,"info");const t=localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("user")||'{"_id":"preview-user"}')._id,i=await fetch(`${P}/api/travel-requests/${e}/supervisor-approval`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({supervisorId:a,decision:s})});if(i.ok)r(s=>s.filter(s=>s._id!==e)),E(`Travel request ${s} successfully!`,"success");else{const e=await i.json();E(e.message||"Failed to update travel request","error")}}catch(t){E("An error occurred while updating the travel request","error")}L(null)})(k,T),W()},className:"px-4 py-2 rounded-xl transition-colors font-medium flex items-center gap-2 text-sm "+("approved"===T?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"),children:["approved"===T?a.jsx(le,{size:16}):a.jsx(g,{size:16}),"Confirm"]})]})]})]})}),u&&a.jsx(ve.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:"fixed bottom-4 right-4 z-50",children:a.jsx("div",{className:"px-6 py-4 rounded-xl shadow-2xl border "+("success"===f?"bg-green-50 text-green-800 border-green-200":"error"===f?"bg-red-50 text-red-800 border-red-200":"bg-blue-50 text-blue-800 border-blue-200"),children:a.jsxs("div",{className:"flex items-center gap-3",children:["success"===f?a.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):"error"===f?a.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}):a.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("span",{className:"font-medium",children:b}),a.jsx("button",{onClick:()=>h(!1),className:"ml-4 text-gray-400 hover:text-gray-600",children:a.jsx(g,{size:18})})]})})})]})},rs=Object.freeze(Object.defineProperty({__proto__:null,default:as},Symbol.toStringTag,{value:"Module"})),is=({isVisible:e,message:s="Processing..."})=>e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-2xl p-6 flex items-center gap-3",children:[a.jsx(d,{className:"animate-spin w-6 h-6 text-blue-500"}),a.jsx("span",{className:"font-medium",children:s})]})}):null,ls=({request:e,onMenuClick:s,showMenuId:t,formatDate:r,getTravelMeansText:i,getTravelMeansIcon:l,getTravelMeansColor:n,getEmployeeAvatar:d,getAvatarColor:o})=>a.jsxs("div",{className:"grid grid-cols-6 gap-4 items-center px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:[a.jsx("div",{children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold ${o(e.employee?.name)}`,children:d(e.employee?.name)}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 text-sm",children:e.employee?.lastName||"N/A"}),a.jsx("div",{className:"text-xs text-gray-600 font-mono truncate",children:e.fundingCodes||"N/A"})]})]})}),a.jsx("div",{children:a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:r(e.departureDate)}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[a.jsx(ue,{size:10}),r(e.returnDate)]})]})}),a.jsx("div",{children:a.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",children:e.location||"N/A"})}),a.jsx("div",{className:"space-y-1",children:a.jsx("div",{children:a.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${n(e.meansOfTravel)}`,children:[l(e.meansOfTravel),a.jsx("span",{className:"ml-1",children:i(e.meansOfTravel)})]})})}),a.jsx("div",{children:a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border text-amber-700 bg-amber-50 border-amber-200",children:[a.jsx(me,{size:12}),a.jsx("span",{className:"ml-1",children:"Supervisor Approved"})]})}),a.jsx("div",{className:"text-center",children:a.jsx("button",{"data-request-id":e._id,onClick:()=>s(t===e._id?null:e._id),className:"p-1 text-gray-400 hover:text-blue-600 rounded-xl",children:a.jsx(R,{size:16})})})]}),ns=[{_id:"1",employee:{_id:"e1",name:"John Smith"},departureDate:"2025-05-15T00:00:00.000Z",returnDate:"2025-05-22T00:00:00.000Z",location:"New York, NY",fundingCodes:"FIN-2025-001",meansOfTravel:"own",status:"supervisor_approved"},{_id:"2",employee:{_id:"e2",name:"Sarah Johnson"},departureDate:"2025-06-01T00:00:00.000Z",returnDate:"2025-06-05T00:00:00.000Z",location:"Chicago, IL",fundingCodes:"FIN-2025-002",meansOfTravel:"public_transport",status:"supervisor_approved"},{_id:"3",employee:{_id:"e3",name:"Michael Chen"},departureDate:"2025-05-20T00:00:00.000Z",returnDate:"2025-05-27T00:00:00.000Z",location:"San Francisco, CA",fundingCodes:"FIN-2025-003",meansOfTravel:"rental",status:"supervisor_approved"},{_id:"4",employee:{_id:"e4",name:"Emily Davis"},departureDate:"2025-06-10T00:00:00.000Z",returnDate:"2025-06-15T00:00:00.000Z",location:"Austin, TX",fundingCodes:"FIN-2025-004",meansOfTravel:"company",status:"supervisor_approved"}],ds=()=>{const[e,t]=s.useState([]),[r,i]=s.useState(!0),[l,n]=s.useState(""),[d,o]=s.useState("all"),[x,u]=s.useState(!1),[h,b]=s.useState(""),[y,v]=s.useState("success"),[N,w]=s.useState(!1),[S,z]=s.useState(null),[k,D]=s.useState(null),[q,T]=s.useState(!1),[$,A]=s.useState(!1),[M,I]=s.useState(null),L="https://backend.nexusmwi.com",R=async()=>{A(!0);try{const e=localStorage.getItem("token"),s=await fetch(`${L}/api/travel-requests/supervisor-approved`,{headers:{Authorization:`Bearer ${e||"preview-token"}`}});if(!s.ok)throw new Error("Failed to fetch supervisor-approved travel requests");const a=await s.json();t(a),T(!1)}catch(e){t(ns),T(!0),"undefined"==typeof window||"localhost"===window.location.hostname||window.location.hostname.includes("vercel.app")||E("Failed to fetch supervisor-approved travel requests","error")}finally{setTimeout(()=>{i(!1),A(!1)},800)}};s.useEffect(()=>{R()},[L]);const P=e.filter(e=>{const s=e.employee?.name?.toLowerCase().includes(l.toLowerCase())||e.location?.toLowerCase().includes(l.toLowerCase())||e.meansOfTravel?.toLowerCase().includes(l.toLowerCase())||!1,t="all"===d||e.meansOfTravel===d;return s&&t}),F=e?.length||0;e?.filter(e=>"own"===e.meansOfTravel),e?.filter(e=>"company"===e.meansOfTravel),e?.filter(e=>"public_transport"===e.meansOfTravel);const E=(e,s="success")=>{b(e),v(s),u(!0),setTimeout(()=>u(!1),5e3)},B=(e,s)=>{z(e),D(s),w(!0),I(null)},W=()=>{w(!1),z(null),D(null)},U=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),H=e=>{switch(e){case"own":return"Own Vehicle";case"company":return"Company Vehicle";case"rental":return"Rental Vehicle";case"public_transport":return"Public Transport";default:return e||"N/A"}},K=e=>{switch(e){case"own":case"company":case"rental":return a.jsx(ce,{size:12});case"public_transport":return a.jsx(pe,{size:12});default:return a.jsx(m,{size:12})}},J=e=>{switch(e){case"own":return"text-blue-700 bg-blue-50 border-blue-200";case"company":return"text-purple-700 bg-purple-50 border-purple-200";case"rental":return"text-amber-700 bg-amber-50 border-amber-200";case"public_transport":return"text-green-700 bg-green-50 border-green-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}},V=e=>{if(!e)return"?";return e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)},Z=e=>{if(!e)return"bg-gray-500";const s=["bg-blue-500","bg-purple-500","bg-green-500","bg-amber-500","bg-red-500","bg-indigo-500","bg-cyan-500","bg-lime-500","bg-orange-500","bg-pink-500"];return s[(e.charCodeAt(0)||0)%s.length]};return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(is,{isVisible:r,message:"Loading travel requests..."}),a.jsxs("main",{className:"p-4 space-y-4 max-w-7xl mx-auto",children:[q&&a.jsx(ve.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-amber-50 border border-amber-200 rounded-2xl p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-amber-100 rounded-xl",children:a.jsx(j,{size:20,className:"text-amber-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-amber-800",children:"Preview Mode Active"}),a.jsx("p",{className:"text-amber-700 text-sm",children:"Using mock data for preview. In production, this would connect to your backend API."})]})]})}),a.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center flex-1",children:[a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx(O,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search travel requests...",value:l,onChange:e=>n(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white"})]}),a.jsx("div",{className:"flex items-center space-x-3",children:a.jsxs("select",{value:d,onChange:e=>o(e.target.value),className:"px-4 py-2 border border-gray-200 rounded-2xl text-sm bg-white",children:[a.jsx("option",{value:"all",children:"All Vehicle Types"}),a.jsx("option",{value:"own",children:"Own Vehicle"}),a.jsx("option",{value:"company",children:"Company Vehicle"}),a.jsx("option",{value:"rental",children:"Rental Vehicle"}),a.jsx("option",{value:"public_transport",children:"Public Transport"})]})})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:R,disabled:$,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-2xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:a.jsx(c,{size:16,className:$?"animate-spin":""})}),a.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white text-gray-700 rounded-lg hover:bg-gray-50 border border-gray-200 text-sm",children:[a.jsx(_,{size:16}),"Export"]})]})]})}),a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(me,{className:"w-5 h-5 text-gray-600"}),a.jsx("h3",{className:"font-semibold text-gray-900",children:"Final Approval Required"})]}),a.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:a.jsxs("span",{children:[P.length," of ",F," requests"]})})]}),0===P.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:a.jsx(me,{size:32,className:"text-gray-400"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:l||"all"!==d?"No travel requests match your filters":"No Pending Final Approvals"}),a.jsx("p",{className:"text-gray-500 mb-4",children:l||"all"!==d?"Try adjusting your search criteria or filters to find what you're looking for.":"There are currently no supervisor-approved travel requests waiting for your final approval."}),a.jsxs("button",{onClick:R,disabled:$,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-2xl font-medium hover:bg-blue-600 disabled:opacity-50 mx-auto",children:[a.jsx(c,{size:16,className:$?"animate-spin":""}),"Refresh"]})]}):a.jsxs("div",{className:"overflow-hidden",children:[a.jsxs("div",{className:"grid grid-cols-6 gap-4 items-center px-4 py-3 bg-gray-50 rounded-xl mb-2 font-semibold text-gray-700 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{size:16}),"Employee"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(f,{size:16}),"Travel Period"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(oe,{size:16}),"Location"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ce,{size:16}),"Travel Details"]}),a.jsx("div",{children:"Status"}),a.jsx("div",{className:"text-center",children:"Actions"})]}),a.jsx("div",{className:"space-y-0",children:P.map((e,s)=>a.jsx(ve.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*s},children:a.jsx(ls,{request:e,onMenuClick:I,showMenuId:M,formatDate:U,getTravelMeansText:H,getTravelMeansIcon:K,getTravelMeansColor:J,getEmployeeAvatar:V,getAvatarColor:Z})},e._id))})]})]})]}),M&&a.jsxs(a.Fragment,{children:[a.jsx(ve.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] bg-black/5",onClick:()=>I(null),transition:{duration:.1}}),a.jsx(ve.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"fixed z-[101] w-56 bg-white rounded-2xl shadow-xl border border-gray-200",style:{top:(()=>{const e=document.querySelector(`[data-request-id="${M}"]`);if(e){return`${e.getBoundingClientRect().bottom+window.scrollY}px`}return"50px"})(),left:(()=>{const e=document.querySelector(`[data-request-id="${M}"]`);if(e){const s=e.getBoundingClientRect(),t=224;return s.right+window.scrollX+t>window.innerWidth?window.innerWidth-t-8+"px":`${s.right-t+window.scrollX}px`}return"50px"})()},transition:{duration:.1,ease:"easeOut"},children:a.jsx("div",{className:"py-1",children:[{icon:p,label:"View Details",action:()=>{}},{icon:le,label:"Final Approve",action:()=>B(M,"approve"),color:"green"},{icon:g,label:"Deny",action:()=>B(M,"reject"),color:"red"},{type:"divider"},{icon:C,label:"Download PDF",action:()=>{}}].map((e,s)=>"divider"===e.type?a.jsx("div",{className:"border-t border-gray-100 my-1"},`divider-${s}`):a.jsxs("button",{onClick:()=>{e.action(),I(null)},className:"w-full flex items-center gap-3 px-4 py-2 text-left text-sm rounded-xl "+("green"===e.color?"text-green-600 hover:bg-green-50":"red"===e.color?"text-red-600 hover:bg-red-50":"text-gray-700 hover:bg-blue-50 hover:text-blue-600"),children:[a.jsx(e.icon,{size:16,className:"text-gray-500"}),a.jsx("span",{children:e.label})]},e.label))})})]}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full shadow-2xl",children:[a.jsx("div",{className:"px-5 py-3 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:["approve"===k?a.jsx(le,{size:18,className:"text-green-500"}):a.jsx(g,{size:18,className:"text-red-500"}),"approve"===k?"Confirm Final Approval":"Confirm Denial"]}),a.jsx("button",{onClick:W,className:"p-1.5 hover:bg-gray-100 rounded-2xl",children:a.jsx(g,{size:18})})]})}),a.jsxs("div",{className:"p-5",children:[a.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+("approve"===k?"bg-green-100":"bg-red-100"),children:"approve"===k?a.jsx(le,{size:20,className:"text-green-600"}):a.jsx(g,{size:20,className:"text-red-600"})}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-700 mb-2 text-sm",children:["You are about to"," ",a.jsx("span",{className:"font-semibold "+("approve"===k?"text-green-600":"text-red-600"),children:"approve"===k?"give final approval to":"deny"})," ","this travel request."]}),a.jsx("p",{className:"text-xs text-gray-500",children:"This action cannot be undone. The employee will be notified of your decision."})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:W,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors font-medium text-sm",children:"Cancel"}),a.jsx("button",{onClick:()=>{(async(e,s)=>{try{if(q)return t(s=>s.filter(s=>s._id!==e)),void E(`Travel request ${"approve"===s?"approved":"rejected"} successfully! (Preview mode)`,"info");const a=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")||'{"_id":"preview-user"}')._id,i=await fetch(`${L}/api/travel-requests/${e}/final-approval`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({finalApproverId:r,decision:"approve"===s?"approved":"rejected"})});if(i.ok)t(s=>s.filter(s=>s._id!==e)),E(`Travel request ${"approve"===s?"approved":"rejected"} successfully!`,"success");else{const e=await i.json();E(e.message||"Failed to update travel request","error")}}catch(a){E("An error occurred while updating the travel request","error")}I(null)})(S,k),W()},className:"flex items-center gap-2 px-4 py-2 rounded-xl font-medium text-sm "+("approve"===k?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"),children:"approve"===k?a.jsxs(a.Fragment,{children:[a.jsx(le,{size:16}),"Confirm Final Approval"]}):a.jsxs(a.Fragment,{children:[a.jsx(g,{size:16}),"Confirm Denial"]})})]})]})]})}),x&&a.jsx(ve.div,{initial:{opacity:0,y:50,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.5},className:"fixed bottom-4 right-4 z-50",children:a.jsx("div",{className:"px-6 py-4 rounded-xl shadow-2xl border "+("success"===y?"bg-green-50 text-green-800 border-green-200":"error"===y?"bg-red-50 text-red-800 border-red-200":"bg-blue-50 text-blue-800 border-blue-200"),children:a.jsxs("div",{className:"flex items-center gap-3",children:["success"===y?a.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):"error"===y?a.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}):a.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("span",{className:"font-medium",children:h}),a.jsx("button",{onClick:()=>u(!1),className:"ml-4 text-gray-400 hover:text-gray-600",children:a.jsx(g,{size:18})})]})})})]})},os=Object.freeze(Object.defineProperty({__proto__:null,default:ds},Symbol.toStringTag,{value:"Module"})),cs=({size:e="md"})=>a.jsx("div",{className:`${{sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[e]} animate-spin rounded-full border-2 border-gray-300 border-t-blue-600`}),xs=({type:e="info",title:s,children:t,onClose:r})=>{const i={info:je,success:u,warning:P,error:P}[e];return a.jsx("div",{className:`p-3 rounded-2xl border ${{info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"}[e]} mb-3`,children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(i,{className:`w-4 h-4 mt-0.5 ${{info:"text-blue-500",success:"text-green-500",warning:"text-yellow-500",error:"text-red-500"}[e]}`}),a.jsxs("div",{className:"flex-1",children:[s&&a.jsx("h4",{className:"font-medium mb-1 text-sm",children:s}),a.jsx("div",{className:"text-xs",children:t})]})]})})},ms=({status:e,type:s="default"})=>a.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-2xl ${(e=>{switch(e){case"changes_requested":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e)}`,children:e.replace("_"," ")}),us=({title:e,value:s,icon:t,color:r,subtitle:i,prefix:l="",suffix:n=""})=>a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-3 hover:shadow-md transition-shadow",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx("div",{className:"p-1.5 rounded-xl "+("blue"===r?"bg-blue-50":"green"===r?"bg-emerald-50":"purple"===r?"bg-purple-50":"orange"===r?"bg-orange-50":"red"===r?"bg-red-50":"bg-gray-50"),children:a.jsx(t,{size:16,className:"blue"===r?"text-blue-600":"green"===r?"text-emerald-600":"purple"===r?"text-purple-600":"orange"===r?"text-orange-600":"red"===r?"text-red-600":"text-gray-600"})})}),a.jsxs("div",{className:"text-lg font-bold text-gray-900 mb-1",children:[l,s,n]}),a.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:e}),i&&a.jsx("div",{className:"text-xs text-gray-400",children:i})]});function ps(){const{user:e}=Ne(),[t,r]=s.useState([]),[i,l]=s.useState(null),[n,d]=s.useState([{id:Date.now(),category:"",amount:"",description:"",receipt:null}]),[o,c]=s.useState(""),[x,m]=s.useState(!1),[p,h]=s.useState(!0),[g,j]=s.useState(null),[y,v]=s.useState(!1),[w,S]=s.useState(0),z="https://backend.nexusmwi.com",k=["Transportation","Meals","Lodging","Conference Fees","Supplies","Other"];s.useEffect(()=>{(async()=>{try{if(h(!0),j(null),!e||!e._id)return j("User not authenticated"),void h(!1);const s=localStorage.getItem("token");if(!s)return j("No authentication token found"),void h(!1);const t=await fetch(`${z}/api/travel-requests/employee/processed`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!t.ok){const e=await t.text();throw new Error(`HTTP ${t.status}: ${e}`)}const a=(await t.json()).filter(s=>"processed"===s.financeStatus&&(s.employee?._id===e.id&&(!s.reconciliation||"changes_requested"===s.reconciliation.status)));r(a),a.length>0&&l(a[0])}catch(s){j(s.message)}finally{h(!1)}})()},[e,z]);const D=e=>{S(e)},q=(e,s,t)=>{d(n.map(a=>a.id===e?{...a,[s]:t}:a))},T=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e||0);return p?a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx("div",{className:"flex justify-center items-center min-h-96",children:a.jsxs("div",{className:"text-center",children:[a.jsx(cs,{size:"lg"}),a.jsx("p",{className:"mt-4 text-gray-600 text-sm",children:"Loading travel requests..."})]})})}):a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsxs("main",{className:"p-3 space-y-4 max-w-7xl mx-auto",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("div",{children:a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:"p-2 bg-blue-50 rounded-xl",children:a.jsx(he,{className:"w-5 h-5 text-blue-600"})}),a.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Travel Expense Reconciliation"})]})})}),a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200",children:[a.jsx("div",{className:"border-b border-gray-100",children:a.jsxs("nav",{className:"flex",children:[a.jsxs("button",{onClick:()=>D(0),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 "+(0===w?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[a.jsx(he,{size:14}),"New Reconciliation"]}),a.jsxs("button",{onClick:()=>D(1),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 "+(1===w?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[a.jsx(u,{size:14}),"Reconciliation History"]})]})}),a.jsx("div",{className:"p-4",children:0===w?a.jsxs(a.Fragment,{children:[g&&a.jsx(xs,{type:"error",title:"Error",children:g}),y&&a.jsx(xs,{type:"success",title:"Success",children:"Reconciliation submitted successfully!"}),0===t.length?a.jsx(xs,{type:"info",title:"No Reconciliations Needed",children:"No travel requests requiring reconciliation found. All your trips are up to date!"}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Select Travel Request"}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Travel Request"}),a.jsxs("select",{value:i?._id||"",onChange:e=>{const s=t.find(s=>s._id===e.target.value);l(s)},className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:"",children:"Select a travel request..."}),t.map(e=>a.jsxs("option",{value:e._id,children:[e.purpose," - ",new Date(e.departureDate).toLocaleDateString()," to ",new Date(e.returnDate).toLocaleDateString(),"changes_requested"===e.reconciliation?.status?" (Changes Requested)":""]},e._id))]})]}),i&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[a.jsx(us,{title:"Trip Purpose",value:i.purpose,icon:ie,color:"blue"}),a.jsx(us,{title:"Destination",value:i.location,icon:oe,color:"green"}),a.jsx(us,{title:"Duration",value:`${Math.ceil((new Date(i.returnDate)-new Date(i.departureDate))/864e5)} days`,icon:f,color:"purple"}),a.jsx(us,{title:"Per Diem",value:T(i.perDiemAmount),icon:ge,color:"orange"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Departure Date"}),a.jsx("div",{className:"p-2 bg-gray-50 rounded-xl",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(f,{className:"w-3 h-3 text-gray-500"}),a.jsx("span",{className:"text-gray-900 text-sm",children:new Date(i.departureDate).toLocaleDateString()})]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Payment Method"}),a.jsx("div",{className:"p-2 bg-gray-50 rounded-xl",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(b,{className:"w-3 h-3 text-gray-500"}),a.jsx("span",{className:"text-gray-900 text-sm",children:i.paymentMethod||"None specified"})]})})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Return Date"}),a.jsx("div",{className:"p-2 bg-gray-50 rounded-xl",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(f,{className:"w-3 h-3 text-gray-500"}),a.jsx("span",{className:"text-gray-900 text-sm",children:new Date(i.returnDate).toLocaleDateString()})]})})]}),"changes_requested"===i.reconciliation?.status&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),a.jsx("div",{className:"p-2 bg-yellow-50 rounded-xl",children:a.jsx(ms,{status:"changes_requested"})})]})]})]})]})]}),i&&a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i){m(!0),j(null);try{const e=new FormData;e.append("tripReport",o),n.forEach((s,t)=>{e.append(`expenses[${t}][category]`,s.category),e.append(`expenses[${t}][amount]`,s.amount),e.append(`expenses[${t}][description]`,s.description),s.receipt&&e.append(`expenses[${t}][receipt]`,s.receipt)});const s=localStorage.getItem("token"),a=await fetch(`${z}/api/travel-requests/${i._id}/reconcile`,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:e}),x=await a.json();if(!a.ok)throw new Error(x.message||"Submission failed");v(!0),d([{id:Date.now(),category:"",amount:"",description:"",receipt:null}]),c("");const m=t.filter(e=>e._id!==i._id);r(m),l(m[0]||null)}catch(s){j(s.message)}finally{m(!1)}}else j("No travel request selected")},className:"space-y-4",children:[a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(C,{className:"w-4 h-4 text-blue-600"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trip Report"})]}),a.jsx("textarea",{placeholder:"Provide a detailed summary of your trip, including meetings attended, objectives achieved, and any follow-up actions required...",rows:4,value:o,onChange:e=>c(e.target.value),required:!0,className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(he,{className:"w-4 h-4 text-blue-600"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Expenses"})]}),a.jsxs("button",{type:"button",onClick:()=>{d([...n,{id:Date.now(),category:"",amount:"",description:"",receipt:null}])},className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-2xl text-sm font-medium hover:bg-blue-700 transition-colors",children:[a.jsx(re,{size:14}),"Add Expense"]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),a.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),a.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount ($)"}),a.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receipt"}),a.jsx("th",{className:"text-left py-2 px-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:n.map(e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"py-2 px-3",children:a.jsxs("select",{value:e.category,onChange:s=>q(e.id,"category",s.target.value),required:!0,className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:"",children:"Select category..."}),k.map(e=>a.jsx("option",{value:e,children:e},e))]})}),a.jsx("td",{className:"py-2 px-3",children:a.jsx("input",{type:"text",placeholder:"Expense description",value:e.description,onChange:s=>q(e.id,"description",s.target.value),required:!0,className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),a.jsx("td",{className:"py-2 px-3",children:a.jsx("input",{type:"number",placeholder:"0.00",step:"0.01",min:"0",value:e.amount,onChange:s=>q(e.id,"amount",s.target.value),required:!0,className:"w-full px-2 py-1.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),a.jsx("td",{className:"py-2 px-3",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("input",{accept:"image/*,.pdf",style:{display:"none"},id:`receipt-upload-${e.id}`,type:"file",onChange:s=>((e,s)=>{const t=s.target.files[0];t&&q(e,"receipt",t)})(e.id,s),required:e.amount>=25}),a.jsx("label",{htmlFor:`receipt-upload-${e.id}`,children:a.jsxs("button",{type:"button",className:"flex items-center gap-2 px-2 py-1.5 text-sm border border-gray-200 rounded-xl hover:bg-gray-50 transition-colors w-full",onClick:()=>document.getElementById(`receipt-upload-${e.id}`).click(),children:[a.jsx(N,{size:12}),a.jsx("span",{className:"text-xs",children:e.receipt?e.receipt.name:"Upload Receipt"})]})}),e.amount>=25&&!e.receipt&&a.jsx("p",{className:"text-xs text-red-600",children:"Receipt required for amounts $25+"})]})}),a.jsx("td",{className:"py-2 px-3",children:a.jsx("button",{type:"button",onClick:()=>{return s=e.id,void(n.length>1&&d(n.filter(e=>e.id!==s)));var s},disabled:n.length<=1,className:"p-1.5 rounded-xl transition-colors "+(n.length<=1?"text-gray-400 cursor-not-allowed":"text-red-600 hover:bg-red-50"),children:a.jsx(be,{size:14})})})]},e.id))})]})}),a.jsx("div",{className:"flex justify-end mt-3 pt-3 border-t border-gray-100",children:a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-xs text-gray-500",children:"Total Expenses"}),a.jsx("p",{className:"text-lg font-bold text-gray-900",children:T(n.reduce((e,s)=>e+(parseFloat(s.amount)||0),0).toFixed(2))})]})})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",disabled:x,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-2xl text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:x?a.jsxs(a.Fragment,{children:[a.jsx(cs,{size:"sm"}),"Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx(u,{size:14}),"Submit Reconciliation"]})})})]})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"mx-auto w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center mb-3",children:a.jsx(u,{className:"w-5 h-5 text-gray-400"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Reconciliation History"}),a.jsx("p",{className:"text-gray-500 mb-3 text-sm",children:"View your past reconciliation submissions here"}),a.jsxs("div",{className:"inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-600 rounded-2xl text-sm",children:[a.jsx(F,{size:14,className:"mr-2"}),"Coming Soon"]})]})})]})]})})}const hs=Object.freeze(Object.defineProperty({__proto__:null,default:ps},Symbol.toStringTag,{value:"Module"})),gs=ye.forwardRef(function(e,s){return a.jsx(He,{elevation:6,ref:s,variant:"filled",...e})}),bs=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[e,t]=s.useState([]),[r,i]=s.useState(!0),[l,n]=s.useState(!1),[d,o]=s.useState(""),[c,x]=s.useState("success"),[m,u]=s.useState(!1),[p,h]=s.useState(null),[g,b]=s.useState({perDiemRate:50,advanceAmount:0,paymentMethod:"none",notes:""}),j="https://backend.nexusmwi.com";s.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${j}/api/travel-requests/finance/pending`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw new Error("Failed to fetch approved travel requests");const a=await s.json();t(a)}catch(e){o("Failed to fetch approved travel requests"),x("error"),n(!0)}finally{i(!1)}})()},[]);const y=(e,s)=>{"clickaway"!==s&&n(!1)},f=e=>Math.ceil((new Date(e.returnDate)-new Date(e.departureDate))/864e5)*g.perDiemRate,v=()=>{u(!1)},N=e=>{const{name:s,value:t}=e.target;b(e=>({...e,[s]:"perDiemRate"===s||"advanceAmount"===s?Number(t):t}))};return r?a.jsx(we,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:a.jsx(Ce,{})}):a.jsxs(Se,{children:[a.jsxs(we,{sx:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",borderRadius:2,p:3,mb:4},children:[a.jsx(ze,{variant:"h4",gutterBottom:!0,children:"Finance Processing"}),a.jsx(ze,{variant:"subtitle1",children:"Process payments for approved travel requests"})]}),0===e.length?a.jsx(gs,{severity:"info",children:"No travel requests pending finance processing"}):a.jsx(ke,{component:De,children:a.jsxs(qe,{children:[a.jsx(Te,{children:a.jsxs($e,{children:[a.jsx(Ae,{children:"Employee"}),a.jsx(Ae,{children:"Dates"}),a.jsx(Ae,{children:"Location"}),a.jsx(Ae,{children:"Purpose"}),a.jsx(Ae,{children:"Approval Status"}),a.jsx(Ae,{children:"Actions"})]})}),a.jsx(Me,{children:e.map(e=>a.jsxs($e,{children:[a.jsx(Ae,{children:e.employee?.name||"N/A"}),a.jsxs(Ae,{children:[new Date(e.departureDate).toLocaleDateString()," -"," ",new Date(e.returnDate).toLocaleDateString()]}),a.jsx(Ae,{children:e.location}),a.jsx(Ae,{children:e.purpose}),a.jsx(Ae,{children:"approved"===e.finalApproval&&"Final Approved"}),a.jsx(Ae,{children:a.jsx(Ie,{variant:"contained",color:"primary",startIcon:a.jsx(Ke,{}),onClick:()=>(e=>{h(e),b({perDiemRate:50,advanceAmount:0,paymentMethod:"none",notes:""}),u(!0)})(e),children:"Process Payment"})})]},e._id))})]})}),a.jsxs(Le,{open:m,onClose:v,maxWidth:"md",fullWidth:!0,children:[a.jsx(Re,{children:"Process Travel Payment"}),a.jsx(Pe,{dividers:!0,children:p&&a.jsxs(we,{children:[a.jsx(ze,{variant:"h6",gutterBottom:!0,children:"Request Details"}),a.jsxs(ze,{children:[a.jsx("strong",{children:"Employee:"})," ",p.employee?.name]}),a.jsxs(ze,{children:[a.jsx("strong",{children:"Dates:"})," ",new Date(p.departureDate).toLocaleDateString()," -"," ",new Date(p.returnDate).toLocaleDateString()," (",Math.ceil((new Date(p.returnDate)-new Date(p.departureDate))/864e5)," ","days)"]}),a.jsxs(ze,{children:[a.jsx("strong",{children:"Location:"})," ",p.location]}),a.jsxs(ze,{children:[a.jsx("strong",{children:"Purpose:"})," ",p.purpose]}),a.jsxs(we,{sx:{mt:4},children:[a.jsx(ze,{variant:"h6",gutterBottom:!0,children:"Payment Details"}),a.jsxs(we,{sx:{display:"flex",gap:2,mb:3},children:[a.jsx(_e,{label:"Per Diem Rate ($)",name:"perDiemRate",type:"number",value:g.perDiemRate,onChange:N,sx:{width:150}}),a.jsx(we,{sx:{flexGrow:1},children:a.jsxs(ze,{children:[a.jsx("strong",{children:"Per Diem Calculation:"})," ",Math.ceil((new Date(p.returnDate)-new Date(p.departureDate))/864e5)," ","days × $",g.perDiemRate," = $",f(p)]})})]}),a.jsxs(Oe,{fullWidth:!0,sx:{mb:3},children:[a.jsx(Fe,{children:"Payment Method"}),a.jsxs(Ee,{name:"paymentMethod",value:g.paymentMethod,label:"Payment Method",onChange:N,children:[a.jsx(Be,{value:"none",children:"No Payment Required"}),a.jsx(Be,{value:"advance",children:"Travel Advance"}),a.jsx(Be,{value:"reimbursement",children:"Expense Reimbursement"}),a.jsx(Be,{value:"corporate_card",children:"Corporate Card"})]})]}),"advance"===g.paymentMethod&&a.jsx(_e,{label:"Advance Amount ($)",name:"advanceAmount",type:"number",fullWidth:!0,value:g.advanceAmount,onChange:N,sx:{mb:3}}),a.jsx(_e,{label:"Notes",name:"notes",multiline:!0,rows:3,fullWidth:!0,value:g.notes,onChange:N}),a.jsx(we,{sx:{mt:2},children:a.jsxs(ze,{variant:"h6",children:[a.jsx("strong",{children:"Total Amount:"})," $",f(p)+g.advanceAmount]})})]})]})}),a.jsxs(We,{children:[a.jsx(Ie,{onClick:v,children:"Cancel"}),a.jsx(Ie,{onClick:async()=>{try{const e=localStorage.getItem("token"),s=JSON.parse(localStorage.getItem("user"))._id,a=f(p),r=await fetch(`${j}/api/travel-requests/${p._id}/finance-process`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({perDiemAmount:a,travelAdvanceAmount:g.advanceAmount,paymentMethod:g.paymentMethod,financeOfficer:s,notes:g.notes})});if(r.ok)t(e=>e.filter(e=>e._id!==p._id)),o("Payment processed successfully!"),x("success"),u(!1);else{const e=await r.json();o(e.message||"Failed to process payment"),x("error")}n(!0)}catch(e){o("An error occurred while processing payment"),x("error"),n(!0)}},variant:"contained",color:"success",startIcon:a.jsx(Je,{}),children:"Complete Processing"})]})]}),a.jsx(Ue,{open:l,autoHideDuration:6e3,onClose:y,anchorOrigin:{vertical:"top",horizontal:"right"},children:a.jsx(gs,{onClose:y,severity:c,children:d})})]})}},Symbol.toStringTag,{value:"Module"}));export{ps as E,ds as F,Ge as N,as as S,hs as a,bs as b,os as f,Xe as r,rs as t};
